<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>스프링 레거시(Spring legacy) - 검색기능</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- 웹 폰트 설정 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
    

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- syntax.css -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="프로그래밍 노트" />
    <link rel="shortcut icon" href="https://huimang2.github.io/assets/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://huimang2.github.io/java/spring-legacy-search" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Rubisco's Programming Note" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="스프링 레거시(Spring legacy) - 검색기능" />
    <meta property="og:description" content="이번에는 게시글에 검색기능을 넣어보도록 하겠습니다. 스프링 부트에서는 QueryDSL을 통해 동적으로 쿼리문을 생성할 수 있었는데 레거시에서는 매퍼에서 다양한 태그를 통해 쿼리를 동적으로 작성할 수 있습니다. DTO 작성 우선 검색 기능을 위한 SearchDTO를 작성하도록 하겠습니다. /kro/rubisco/dto/SearchDTO.java package kro.rubisco.dto; import lombok.Getter; import lombok.Setter; @Setter @Getter public class SearchDTO { public static enum Target" />
    <meta property="og:url" content="https://huimang2.github.io/java/spring-legacy-search" />
    <meta property="og:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-10-26T06:00:00+09:00" />
    <meta property="article:modified_time" content="2022-10-26T06:00:00+09:00" />
    <meta property="article:tag" content="Java" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="스프링 레거시(Spring legacy) - 검색기능" />
    <meta name="twitter:description" content="이번에는 게시글에 검색기능을 넣어보도록 하겠습니다. 스프링 부트에서는 QueryDSL을 통해 동적으로 쿼리문을 생성할 수 있었는데 레거시에서는 매퍼에서 다양한 태그를 통해 쿼리를 동적으로 작성할 수 있습니다. DTO 작성 우선 검색 기능을 위한 SearchDTO를 작성하도록 하겠습니다. /kro/rubisco/dto/SearchDTO.java package kro.rubisco.dto; import lombok.Getter; import lombok.Setter; @Setter @Getter public class SearchDTO { public static enum Target" />
    <meta name="twitter:url" content="https://huimang2.github.io/" />
    <meta name="twitter:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rubisco's Programming Note" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Java" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Rubisco's Programming Note",
        "logo": "https://huimang2.github.io/"
    },
    "url": "https://huimang2.github.io/java/spring-legacy-search",
    "image": {
        "@type": "ImageObject",
        "url": "https://huimang2.github.io/assets/images/spring-legacy/logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://huimang2.github.io/java/spring-legacy-search"
    },
    "description": "이번에는 게시글에 검색기능을 넣어보도록 하겠습니다. 스프링 부트에서는 QueryDSL을 통해 동적으로 쿼리문을 생성할 수 있었는데 레거시에서는 매퍼에서 다양한 태그를 통해 쿼리를 동적으로 작성할 수 있습니다. DTO 작성 우선 검색 기능을 위한 SearchDTO를 작성하도록 하겠습니다. /kro/rubisco/dto/SearchDTO.java package kro.rubisco.dto; import lombok.Getter; import lombok.Setter; @Setter @Getter public class SearchDTO { public static enum Target"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="스프링 레거시(Spring legacy) - 검색기능" href="/feed.xml" />


    <!-- MathJax -->
    

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://huimang2.github.io/">Rubisco's Programming Note</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-java" role="menuitem"><a href="/tag/java/">JAVA</a></li>
    <li class="nav-typescript" role="menuitem"><a href="/tag/typescript/">Typescript</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/algorithm/">Algorithm</a></li>
    <li class="nav-python" role="menuitem"><a href="/archive.html">All Posts</a></li>
    <li class="nav-python" role="menuitem"><a href="/author_archive.html">Tag별 Posts</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-java tag-spring post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="26 October 2022">26 October 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                                
                                <a href='/tag/java/'>#JAVA</a>,&nbsp;
                                
                            
                        
                            
                                
                                <a href='/tag/spring/'>#SPRING</a>
                                
                            
                        
                    
                </section>
                <h1 class="post-full-title">스프링 레거시(Spring legacy) - 검색기능</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/images/spring-legacy/logo.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <div id="toc">
                        <ul><li><a href="#dto-작성"><span>DTO 작성</span></a></li><li><a href="#dao-수정"><span>DAO 수정</span></a></li><li><a href="#서비스-수정"><span>서비스 수정</span></a></li><li><a href="#매퍼-수정"><span>매퍼 수정</span></a></li><li><a href="#컨트롤러-수정"><span>컨트롤러 수정</span></a></li><li><a href="#소스코드"><span>소스코드</span></a></li></ul>

                    </div>
                    <p>이번에는 게시글에 검색기능을 넣어보도록 하겠습니다. 스프링 부트에서는 QueryDSL을 통해 동적으로 쿼리문을 생성할 수 있었는데 레거시에서는 매퍼에서 다양한 태그를 통해 쿼리를 동적으로 작성할 수 있습니다.</p>

<h1 id="dto-작성">DTO 작성</h1>

<p>우선 검색 기능을 위한 SearchDTO를 작성하도록 하겠습니다.</p>

<h6 id="krorubiscodtosearchdtojava">/kro/rubisco/dto/SearchDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>

<span class="nd">@Setter</span>
<span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SearchDTO</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">enum</span> <span class="nc">Target</span> <span class="o">{</span>
        <span class="n">titleAndContent</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">content</span><span class="o">,</span> <span class="n">nickName</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="nc">Target</span> <span class="n">target</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">keyword</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>검색 기준이 되는 <code class="language-plaintext highlighter-rouge">target</code>과 검색어인 <code class="language-plaintext highlighter-rouge">keyword</code>로 구성된 객체입니다. target의 경우 enum 객체로 검색범위를 지정했습니다.</p>

<h1 id="dao-수정">DAO 수정</h1>

<p>매개변수가 하나인 경우 매퍼에서 파라미터가 해당 객체의 프로퍼티의 이름으로 자동 매핑되지만, 2개 이상이면 파라미터가 map 타입으로 매핑됩니다. 이 경우 <code class="language-plaintext highlighter-rouge">param1, param2 ...</code> 순서로 객체에 접근할 수 있는데, 아래에 수정한 코드와 같이 <code class="language-plaintext highlighter-rouge">@Param</code> 어노테이션을 사용하면 파라미터에 변수명을 지정하여 해당 변수명으로 접근할 수 있게 해줍니다.</p>

<p>BoardDAO의 <code class="language-plaintext highlighter-rouge">listAll</code> 메소드와 <code class="language-plaintext highlighter-rouge">getCount</code> 메소드가 <code class="language-plaintext highlighter-rouge">SearchDTO</code>를 매개변수로 주입받을 수 있도록 수정해줍시다.</p>

<h6 id="krorubiscodaoboarddaojava">/kro/rubisco/dao/BoardDAO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Param</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dto.BoardDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.PageDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.SearchDTO</span><span class="o">;</span>

<span class="nd">@Mapper</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BoardDAO</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="nc">BoardDTO</span> <span class="n">board</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nc">BoardDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">Long</span> <span class="n">documentId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">BoardDTO</span> <span class="n">board</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">Long</span> <span class="n">documentId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BoardDTO</span><span class="o">&gt;</span> <span class="nf">listAll</span><span class="o">(</span>
        <span class="nd">@Param</span><span class="o">(</span><span class="s">"board"</span><span class="o">)</span> <span class="nc">PageDTO</span><span class="o">&lt;</span><span class="nc">BoardDTO</span><span class="o">&gt;</span> <span class="n">boardPage</span><span class="o">,</span> 
        <span class="nd">@Param</span><span class="o">(</span><span class="s">"search"</span><span class="o">)</span> <span class="nc">SearchDTO</span> <span class="n">search</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getCount</span><span class="o">(</span><span class="nc">SearchDTO</span> <span class="n">search</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="서비스-수정">서비스 수정</h1>

<p>DAO를 수정했으므로, 이를 사용하는 BoardService의 구현체도 수정해야 합니다. <code class="language-plaintext highlighter-rouge">listAll</code> 메소드에 <code class="language-plaintext highlighter-rouge">SearchDTO</code>를 주입받아 BoardDAO의 <code class="language-plaintext highlighter-rouge">listAll</code> 메소드와 <code class="language-plaintext highlighter-rouge">getCount</code> 메소드를 호출합니다.</p>

<h6 id="krorubiscoserviceimplboardserviceimpljava">/kro/rubisco/service/impl/BoardServiceImpl.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dao.BoardDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.BoardDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.PageDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.SearchDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.service.BoardService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardServiceImpl</span> <span class="kd">implements</span> <span class="nc">BoardService</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">BoardDAO</span> <span class="n">boardDAO</span><span class="o">;</span>
    
    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">BoardServiceImpl</span><span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">boardDAO</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">BoardDAO</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">regist</span><span class="o">(</span><span class="nc">BoardDTO</span> <span class="n">board</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">boardDAO</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">BoardDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">Long</span> <span class="n">documentId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">boardDAO</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">documentId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="nc">BoardDTO</span> <span class="n">board</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">boardDAO</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Long</span> <span class="n">documentId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">boardDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">documentId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">PageDTO</span><span class="o">&lt;</span><span class="nc">BoardDTO</span><span class="o">&gt;</span> <span class="nf">listAll</span><span class="o">(</span><span class="nc">PageDTO</span><span class="o">&lt;</span><span class="nc">BoardDTO</span><span class="o">&gt;</span> <span class="n">boardPage</span><span class="o">,</span> <span class="nc">SearchDTO</span> <span class="n">search</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">boardPage</span><span class="o">.</span><span class="na">setContentList</span><span class="o">(</span><span class="n">boardDAO</span><span class="o">.</span><span class="na">listAll</span><span class="o">(</span><span class="n">boardPage</span><span class="o">,</span> <span class="n">search</span><span class="o">));</span>
        <span class="n">boardPage</span><span class="o">.</span><span class="na">setTotalSize</span><span class="o">(</span><span class="n">boardDAO</span><span class="o">.</span><span class="na">getCount</span><span class="o">(</span><span class="n">search</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">boardPage</span><span class="o">;</span>
    <span class="o">}</span>   
<span class="o">}</span>
</code></pre></div></div>

<h1 id="매퍼-수정">매퍼 수정</h1>

<p>boardMapper의 <code class="language-plaintext highlighter-rouge">listAll</code> select문을 다음과 같이 수정합니다.</p>

<h6 id="boardmapperxml">boardMapper.xml</h6>
<div data-lang="XML" class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"listAll"</span> <span class="na">resultMap=</span><span class="s">"getBoardList"</span><span class="nt">&gt;</span>
<span class="cp">&lt;![CDATA[
select * 
from (
    select rownum num, b.*
    from (
        select b.* from board b
        inner join member m on b.member_id = m.member_id
]]&gt;</span>
<span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"search.target neq null and search.keyword neq null"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;where&gt;</span>
        <span class="nt">&lt;choose&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"search.target.toString() eq 'title'"</span><span class="nt">&gt;</span>
                <span class="cp">&lt;![CDATA[ 
                    and b.title like '%'||#{search.keyword}||'%'
                ]]&gt;</span>
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"search.target.toString() eq 'content'"</span><span class="nt">&gt;</span>
                <span class="cp">&lt;![CDATA[ 
                    and b.content like '%'||#{search.keyword}||'%'
                ]]&gt;</span>
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"search.target.toString() eq 'titleAndContent'"</span><span class="nt">&gt;</span>
                <span class="cp">&lt;![CDATA[ 
                    and b.title like '%'||#{search.keyword}||'%'
                    or b.content like '%'||#{search.keyword}||'%'
                ]]&gt;</span>
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"search.target.toString() eq 'nickName'"</span><span class="nt">&gt;</span>
                <span class="cp">&lt;![CDATA[ 
                    and m.nick_name like '%'||#{search.keyword}||'%'
                ]]&gt;</span>
            <span class="nt">&lt;/when&gt;</span>
        <span class="nt">&lt;/choose&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
<span class="nt">&lt;/if&gt;</span>
<span class="cp">&lt;![CDATA[
        order by b.document_id desc
    ) b
    WHERE rownum &lt;= #{board.last}
)
where num &gt;</span>= #{board.first}
]]&gt;
<span class="nt">&lt;/select&gt;</span>
...
</code></pre></div></div>

<p>다양한 태그가 사용되었습니다. 우선 <code class="language-plaintext highlighter-rouge">if</code> 태그를 통해 조건에 따라 쿼리를 추가할 수 있습니다. search 객체에 target과 keyword가 있는 경우에 where 조건문을 추가하도록 작성했습니다.</p>

<p>DAO에서 파라미터를 <code class="language-plaintext highlighter-rouge">board</code>와 <code class="language-plaintext highlighter-rouge">search</code>로 설정했으므로, 해당 파라미터를 통해 BoardDTO 객체와 SearchDTO 객체를 참조할 수 있습니다.</p>

<p>where 조건문은 <code class="language-plaintext highlighter-rouge">where</code> 태그를 통해 작성하면 prefix나 suffix를 where문에 맞도록 수정해줍니다. 예를 들어 <code class="language-plaintext highlighter-rouge">where and b.title ...</code> 형태로 쿼리가 작성되면 오류가 발생하는데, 태그를 통해 작성하면 and 부분을 제거하여 <code class="language-plaintext highlighter-rouge">where b.title ...</code> 형태로 올바른 쿼리를 생성합니다.</p>

<p><code class="language-plaintext highlighter-rouge">choose</code> 태그의 경우 JSTL과 동일합니다. <code class="language-plaintext highlighter-rouge">when</code> 태그와 <code class="language-plaintext highlighter-rouge">otherwise</code> 태그를 하위태그로 추가함으로써 switch문처럼 사용할 수 있습니다.</p>

<p>member 테이블의 nick_name 컬럼도 검색의 대상이 되므로 join문을 통해 쿼리를 작성합니다. like 뒤에 문자열을 더하는 방법은 DB마다 차이가 있는데, 오라클 DB의 경우 <code class="language-plaintext bgcolor yellow highlighter-rouge" style="color: orange">'%'||#{search}||'%'</code> 형태로 작성하여 문자열을 더할 수 있습니다.</p>

<p>조건문에 따라 검색되는 튜플의 수가 달라지므로, 페이지를 올바르게 나타내기 위해서 <code class="language-plaintext highlighter-rouge">getCount</code> select 쿼리도 다음과 같이 수정합니다.</p>

<h1 id="컨트롤러-수정">컨트롤러 수정</h1>

<p>클라이언트가 검색기능을 요청하면 해당 서비스를 호출하도록 BoardController의 <code class="language-plaintext highlighter-rouge">getBoardListView</code> 메소드를 수정해주세요.</p>

<h6 id="krorubiscocontrollerboardcontrollerjava">/kro/rubisco/controller/BoardController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getBoardListView</span><span class="o">(</span>
        <span class="nc">PageDTO</span><span class="o">&lt;</span><span class="nc">BoardDTO</span><span class="o">&gt;</span> <span class="n">boardPage</span><span class="o">,</span> 
        <span class="nc">SearchDTO</span> <span class="n">search</span><span class="o">,</span>
        <span class="nc">Model</span> <span class="n">model</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"pageInfo"</span><span class="o">,</span> <span class="n">boardService</span><span class="o">.</span><span class="na">listAll</span><span class="o">(</span><span class="n">boardPage</span><span class="o">,</span> <span class="n">search</span><span class="o">));</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"boardList"</span><span class="o">,</span> <span class="n">boardPage</span><span class="o">.</span><span class="na">getContentList</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">"board/getBoardList"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">...</span>
</code></pre></div></div>

<p>매개변수로 SearchDTO 객체를 주입받고, 해당 객체를 boardService의 listAll 메소드에 주입하여 호출합니다.</p>

<p align="center"><img src="/assets/images/spring-legacy/img27.png" alt="img27" /></p>

<p>뷰 템플릿의 페이지 네비게션 url를 수정할 필요가 있는데 생략하고 템플릿을 작성할 때 수정하도록 하겠습니다.</p>

<h1 id="소스코드">소스코드</h1>

<blockquote>
  <p><a href="/file/legacy/ex_search.zip" target="_blank">ex_search.zip</a></p>
</blockquote>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Rubisco's Programming Note</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- utterances -->
            <div id="comment">
                <script src="https://utteranc.es/client.js"
                repo="huimang2/huimang2.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async></script>
            </div>
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/M31_starspike.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Rubisco's Programming Note &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/java/">Java</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/maven-project">이클립스 메이븐 프로젝트</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-security">스프링 레거시(Spring legacy) - 시큐리티 적용</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-filter-and-interceptor">스프링 레거시(Spring legacy) - 필터와 인터셉터</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/java/">
                                
                                    See all 18 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/java/spring-legacy-exception">
                <div class="post-card-image" style="background-image: url(/assets/images/spring-legacy/logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/java/spring-legacy-exception">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">스프링 레거시(Spring legacy) - 예외처리</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>이번 글에서는 클라이언트 요청에 대한 예외 처리를 해보겠습니다.

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/java/spring-legacy-paging">
                <div class="post-card-image" style="background-image: url(/assets/images/spring-legacy/logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/java/spring-legacy-paging">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">스프링 레거시(Spring legacy) - 페이징</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>저번 글에 이어서 board 모듈에 페이징 기능을 넣어보겠습니다. 스프링 부트에서는 JPA의 Pageable 인터페이스를 통해 쉽게 구현할 수 있지만 레거시에서는 객체를 만들어야합니다.

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      8 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://huimang2.github.io/">
            
            <span>Rubisco's Programming Note</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">스프링 레거시(Spring legacy) - 검색기능</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%EC%8A%A4%ED%94%84%EB%A7%81+%EB%A0%88%EA%B1%B0%EC%8B%9C%28Spring+legacy%29+-+%EA%B2%80%EC%83%89%EA%B8%B0%EB%8A%A5&amp;url=java/spring-legacy-search"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=java/spring-legacy-search"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://huimang2.github.io/">Rubisco's Programming Note</a> &copy; 2023</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search Rubisco's Programming Note</h1>
            <p class="subscribe-overlay-description">
            lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>


    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    /* toc ---------------------------------------------------------------------*/

    var tocTitle = document.getElementsByClassName("post-full-title")[0];
    var tocTitleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var tocArticle = document.getElementsByClassName("post-full-content")[0];
    var tocArticleY = window.pageYOffset + tocArticle.getBoundingClientRect().top;
  
    var toc = document.getElementById("toc");
    var tocHeaderNodes = getHeaderNodes(tocArticle);
    var tocNodes = getTOCNodes(toc);
  
    var tocBefore = undefined;

    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3" && !elem.classList.contains('no-toc');
        });
        return headerNodes;
    }

    tocNodes.forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    document.querySelector('.post-full-content').querySelectorAll('p a[href^="#"]').forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    /*--------------------------------------------------------------------------*/

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 30;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
            toc.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
            toc.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;

        // toc
        var tocCurrent = tocHeaderNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 90;
        });
  
        if (tocCurrent.length > 0) {
            tocCurrent = tocCurrent[tocCurrent.length-1];
  
            var tocCurrentA = tocNodes.filter(function(tocNode) {
                return tocNode.getElementsByTagName("span")[0].innerHTML == tocCurrent.innerHTML;
            })
            
            tocCurrentA = tocCurrentA[0];

            if (tocCurrentA) {
                if (tocBefore == undefined) tocBefore = tocCurrentA;
    
                if (tocBefore != tocCurrentA) {
                    tocBefore.classList.remove("toc-active");
                    tocBefore = tocCurrentA;
                }
    
                tocCurrentA.classList.add("toc-active");
            }
            else {
                if (tocBefore) 
                    tocBefore.classList.remove("toc-active");
            }
        }
        else {
            if (tocBefore) 
                tocBefore.classList.remove("toc-active");
        }
        
        if(toc && tocArticle.getBoundingClientRect().bottom <= 0) {
            toc.classList.add('toc-hidden');
        } else {
            toc.classList.remove('toc-hidden');
        }
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
