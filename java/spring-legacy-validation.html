<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>스프링 레거시(Spring legacy) - 유효성 검사</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- 웹 폰트 설정 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
    

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- syntax.css -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="프로그래밍 노트" />
    <link rel="shortcut icon" href="https://huimang2.github.io/assets/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://huimang2.github.io/java/spring-legacy-validation" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Rubisco's Programming Note" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="스프링 레거시(Spring legacy) - 유효성 검사" />
    <meta property="og:description" content="이번 글에서는 예외처리에 대한 보충설명과 유효성 검사에 대하여 알아보겠습니다. 에러(error)와 예외(exception) 프로그램의 예외상황은 크게 에러(error)와 예외(exception)로 나눌 수 있습니다. 에러는 시스템 자체에서 비정상적인 상황이 발생하여 프로그램이 계속 실행될 수 없는 경우를 말하며, 예외는 내부적 처리를 통해 프로그램을 계속 실행가능한 상태로 만들 수 있는 경우를 말합니다. 자바에서는 이런 예외상황을 처리하기 위해" />
    <meta property="og:url" content="https://huimang2.github.io/java/spring-legacy-validation" />
    <meta property="og:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-10-30T06:00:00+09:00" />
    <meta property="article:modified_time" content="2022-10-30T06:00:00+09:00" />
    <meta property="article:tag" content="Java" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="스프링 레거시(Spring legacy) - 유효성 검사" />
    <meta name="twitter:description" content="이번 글에서는 예외처리에 대한 보충설명과 유효성 검사에 대하여 알아보겠습니다. 에러(error)와 예외(exception) 프로그램의 예외상황은 크게 에러(error)와 예외(exception)로 나눌 수 있습니다. 에러는 시스템 자체에서 비정상적인 상황이 발생하여 프로그램이 계속 실행될 수 없는 경우를 말하며, 예외는 내부적 처리를 통해 프로그램을 계속 실행가능한 상태로 만들 수 있는 경우를 말합니다. 자바에서는 이런 예외상황을 처리하기 위해" />
    <meta name="twitter:url" content="https://huimang2.github.io/" />
    <meta name="twitter:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rubisco's Programming Note" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Java" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Rubisco's Programming Note",
        "logo": "https://huimang2.github.io/"
    },
    "url": "https://huimang2.github.io/java/spring-legacy-validation",
    "image": {
        "@type": "ImageObject",
        "url": "https://huimang2.github.io/assets/images/spring-legacy/logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://huimang2.github.io/java/spring-legacy-validation"
    },
    "description": "이번 글에서는 예외처리에 대한 보충설명과 유효성 검사에 대하여 알아보겠습니다. 에러(error)와 예외(exception) 프로그램의 예외상황은 크게 에러(error)와 예외(exception)로 나눌 수 있습니다. 에러는 시스템 자체에서 비정상적인 상황이 발생하여 프로그램이 계속 실행될 수 없는 경우를 말하며, 예외는 내부적 처리를 통해 프로그램을 계속 실행가능한 상태로 만들 수 있는 경우를 말합니다. 자바에서는 이런 예외상황을 처리하기 위해"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="스프링 레거시(Spring legacy) - 유효성 검사" href="/feed.xml" />


    <!-- MathJax -->
    

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://huimang2.github.io/">Rubisco's Programming Note</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-java" role="menuitem"><a href="/tag/java/">JAVA</a></li>
    <li class="nav-typescript" role="menuitem"><a href="/tag/typescript/">Typescript</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/algorithm/">Algorithm</a></li>
    <li class="nav-python" role="menuitem"><a href="/archive.html">All Posts</a></li>
    <li class="nav-python" role="menuitem"><a href="/author_archive.html">Tag별 Posts</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-java tag-spring post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="30 October 2022">30 October 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                                
                                <a href='/tag/java/'>#JAVA</a>,&nbsp;
                                
                            
                        
                            
                                
                                <a href='/tag/spring/'>#SPRING</a>
                                
                            
                        
                    
                </section>
                <h1 class="post-full-title">스프링 레거시(Spring legacy) - 유효성 검사</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/images/spring-legacy/logo.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <div id="toc">
                        <ul><li><a href="#에러error와-예외exception"><span>에러(error)와 예외(exception)</span></a><ul><li><a href="#예외exception의-분류"><span>예외(exception)의 분류</span></a></li><li><a href="#예외exception의-처리"><span>예외(exception)의 처리</span></a></li><li><a href="#simplemappingexceptionresolver"><span>SimpleMappingExceptionResolver</span></a></li></ul></li><li><a href="#검증validation"><span>검증(validation)</span></a><ul><li><a href="#fielderror-추가"><span>FieldError 추가</span></a></li><li><a href="#에러코드를-통한-메시지-출력"><span>에러코드를 통한 메시지 출력</span></a></li><li><a href="#rejectvalue-메소드-사용"><span>rejectValue 메소드 사용</span></a></li><li><a href="#objecterror-추가"><span>ObjectError 추가</span></a></li></ul></li></ul>

                    </div>
                    <p>이번 글에서는 예외처리에 대한 보충설명과 유효성 검사에 대하여 알아보겠습니다.</p>

<h1 id="에러error와-예외exception">에러(error)와 예외(exception)</h1>

<p>프로그램의 예외상황은 크게 에러(error)와 예외(exception)로 나눌 수 있습니다. 에러는 시스템 자체에서 비정상적인 상황이 발생하여 프로그램이 계속 실행될 수 없는 경우를 말하며, 예외는 내부적 처리를 통해 프로그램을 계속 실행가능한 상태로 만들 수 있는 경우를 말합니다.</p>

<p>자바에서는 이런 예외상황을 처리하기 위해 <code class="language-plaintext highlighter-rouge">Throwable</code> 인터페이스를 만들어두었습니다. 에러를 처리하는 <code class="language-plaintext highlighter-rouge">Error</code> 클래스와 예외를 처리하는 <code class="language-plaintext highlighter-rouge">Exception</code> 클래스는 Throwable 인터페이스를 상속받습니다.</p>

<p align="center"><img src="/assets/images/spring-legacy/img31.png" alt="img31" /></p>

<p>에러는 대응할 방법이 없기때문에 Error 클래스는 주로 JVM에서 사용하며, 어플리케이션에서 사용하지는 않습니다. 대표적인 에러로는 스택의 공간이 부족한 경우 발생되는 <code class="language-plaintext bgcolor yellow highlighter-rouge" style="color: orange">StackOverflowError</code>가 있습니다.</p>

<h2 id="예외exception의-분류">예외(exception)의 분류</h2>

<p>예외에는 예외 처리가 필요한 <code class="language-plaintext highlighter-rouge">Checked Exception</code>과 예외 처리가 불필요한 <code class="language-plaintext highlighter-rouge">Unchecked Exception</code>이 있습니다.</p>

<p><code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">Checked Exception</code>은 컴파일 시점에서 예외가 발생할 가능성이 있기 때문에 반드시 예외처리를 해야합니다. 대표적으로 파일을 불러올 때 파일이 없을 경인 <code class="language-plaintext bgcolor yellow highlighter-rouge" style="color: orange">FileNotFoundException</code>이 있습니다.</p>

<p><code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">Unchecked Exception</code>은 런타임 시점에서 예외가 발생할 가능성이 있는 경우이며, 예외처리를 하지 않아도 됩니다. <code class="language-plaintext bgcolor orange highlighter-rouge" style="color: orangered">Exception</code> 클래스의 하위 클래스인 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue; font-weight">RuntimeException</code> 클래스를 상속받은 클래스는 Unchecked Exception이 됩니다.</p>

<h2 id="예외exception의-처리">예외(exception)의 처리</h2>

<p>자바에서 예외처리는 <code class="language-plaintext highlighter-rouge">try-catch</code>문을 통해 이루어질 수 있습니다.</p>

<p>throw 키워드를 통해 예외를 던질 수 있으며, throw된 예외는 catch문을 통해 받을 수 있습니다. 즉, Checked Exception이 throw 된다면 해당 메소드를 호출한 곳에서는 try-catch문을 통해 던져진 예외를 처리해야 합니다.</p>

<p>만약 메소드에 <code class="language-plaintext highlighter-rouge">throws</code> 키워드를 붙인다면 throw된 예외를 처리하지 않고 해당 메소드를 호출한 곳으로 다시 예외를 throw 할 수도 있습니다.</p>

<h2 id="simplemappingexceptionresolver">SimpleMappingExceptionResolver</h2>

<p>이제 Exception을 통해 예외가 발생하면 에러 페이지를 response 할 수 있도록 코드를 작성해보겠습니다.</p>

<p>지난번 글에서 설명했듯이 스프링 프레임워크에서는 ExceptionHandlerExceptionResolver를 통해 @ExceptionHandler 어노테이션이 붙은 메소드를 호출하여 예외를 처리하고, ResponseStatusExceptionResolver를 통해 상태코드를 설정하며, ExceptionHandlerExceptionResolver에서 처리되지 않은 예외는 DefaultHandlerExceptionResolver가 처리하게 됩니다.</p>

<p>스프링 프레임워크는 컨테이너에 기본적으로 등록되지는 않지만 간단하게 적용할 수 있는 <code class="language-plaintext highlighter-rouge">SimpleMappingExceptionResolver</code>가 있습니다. 이름 그대로 간단하게 예외를 매핑할 수 있는 ExceptionResolver입니다. 서블릿 컨테이너에서 web.xml에 error-page를 등록하여 에러페이지를 매핑한 것과 같이 SimpleMappingExceptionResolver의 프로퍼티를 설정하여 스프링 컨테이너의 예외를 예외 페이지 뷰와 매핑할 수 있습니다.</p>

<p>빈(bean)을 생성해야 하는데 레거시를 사용하고 있으니 xml 파일을 통해 빈(bean)을 생성하겠습니다. dispatcherServlet의 컨텍스트에 SimpleMappingExceptionResolver 빈을 등록하겠습니다.</p>

<h6 id="srcmainwebappweb-infspringappservletservlet-contextxml">/src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml</h6>
<div data-lang="XML" class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
    <span class="nt">&lt;beans:bean</span> <span class="na">class=</span><span class="s">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">"exceptionMappings"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;beans:props&gt;</span>
                <span class="nt">&lt;beans:prop</span> <span class="na">key=</span><span class="s">"TestException"</span><span class="nt">&gt;</span>error/testException<span class="nt">&lt;/beans:prop&gt;</span>
            <span class="nt">&lt;/beans:props&gt;</span>
        <span class="nt">&lt;/beans:property&gt;</span>
        <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">"defaultErrorView"</span> <span class="na">value=</span><span class="s">"error/error"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/beans:bean&gt;</span>
...
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">SimpleMappingExceptionResolver</code>를 빈으로 등록하고 <code class="language-plaintext highlighter-rouge">exceptionMappings</code>의 프로퍼티를 설정해주면 됩니다. 해당 프로퍼티는 key가 예외객체 이름이고 value가 뷰 이름인 맵으로 되어있습니다. 예외객체 이름은 패키지명을 입력하지 않아도 자동으로 매핑됩니다.</p>

<h1 id="검증validation">검증(validation)</h1>

<p>클라이언트의 요청이 올바르지 않다면 예외처리를 통해 올바른 요청을 하도록 유도해야합니다. 이러한 과정을 <code class="language-plaintext highlighter-rouge">검증(validation)</code>이라고 합니다. 웹 애플리케이션에서 검증은 중요한 과정입니다.</p>

<p>검증과정을 알아보기위해 임시로 count와 price로 구성된 ProductDTO를 작성해보겠습니다.</p>

<h6 id="krorubiscodtoproductdtojava">/kro/rubisco/dto/ProductDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDTO</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">count</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">price</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>검증과 관련된 객체에는 <code class="language-plaintext highlighter-rouge">BindingResult</code>, <code class="language-plaintext highlighter-rouge">FieldError</code>, <code class="language-plaintext highlighter-rouge">ObjectError</code>가 있습니다.</p>

<h2 id="fielderror-추가">FieldError 추가</h2>

<p>BindingResult는 FieldError를 보관하는 객체입니다. FieldError는 필드의 타입에 맞지 않는 경우 스프링 컨테이너에 의하여 자동으로 생성되어 BindingResult에 저장되는데, 필요한 경우 검증을 통해 FieldError를 직접 생성하여 BindingResult에 넣어줄 수 있습니다.</p>

<p>FieldError의 생성자는 2개가 있습니다.</p>

<h6 id="krorubiscodtoproductdtojava-1">/kro/rubisco/dto/ProductDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nf">FieldError</span><span class="o">(</span><span class="nc">String</span> <span class="n">objectName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field</span><span class="o">,</span> <span class="nc">String</span> <span class="n">defaultMessage</span><span class="o">);</span>

<span class="kd">public</span> <span class="nf">FieldError</span><span class="o">(</span><span class="nc">String</span> <span class="n">objectName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Object</span> <span class="n">rejectedValue</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">bindingFailure</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">codes</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">arguments</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">String</span> <span class="n">defaultMessage</span><span class="o">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">objectName</code>은 오류가 발생한 객체의 이름이며, <code class="language-plaintext highlighter-rouge">field</code>는 오류가 발생한 필드의 이름입니다. <code class="language-plaintext highlighter-rouge">rejectedValue</code>는 바인딩에 실패한 오류인지 검증에 실패한 오류인지를 나타내고, <code class="language-plaintext highlighter-rouge">codes</code>는 메시지 코드를, <code class="language-plaintext highlighter-rouge">arguments</code>는 메시지에서 사용할 인자를, <code class="language-plaintext highlighter-rouge">defaultMessage</code>는 기본 오류 메시지를 나타냅니다.</p>

<p>우선 1번째 생성자를 통해 <code class="language-plaintext highlighter-rouge">defaultMessage</code>를 지정하여 예외처리를 해보겠습니다.</p>

<p>컨트롤러를 작성하기 전에 <code class="language-plaintext highlighter-rouge">BindException</code>을 상속받은 <code class="language-plaintext highlighter-rouge">BindExceptionWithViewName</code>을 작성하겠습니다. BindException을 던져줄 때 뷰 이름도 같이 던지기 위함입니다.</p>

<h6 id="krorubiscoconfigbindexceptionwithviewnamejava">/kro/rubisco/config/BindExceptionWithViewName.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BindExceptionWithViewName</span> <span class="kd">extends</span> <span class="nc">BindException</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">viewName</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> <span class="nc">String</span> <span class="n">viewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewName</span> <span class="o">=</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getViewName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>이제 컨트롤러를 작성하세요.</p>

<h6 id="krorubiscocontrollertestcontrollerjava">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.FieldError</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span><span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">addError</span><span class="o">(</span><span class="k">new</span> <span class="nc">FieldError</span><span class="o">(</span><span class="s">"product"</span><span class="o">,</span> <span class="s">"count"</span><span class="o">,</span> <span class="s">"수량은 10 이상 100 이하 입니다."</span><span class="o">));</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">10_000_000</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">addError</span><span class="o">(</span><span class="k">new</span> <span class="nc">FieldError</span><span class="o">(</span><span class="s">"product"</span><span class="o">,</span> <span class="s">"price"</span><span class="o">,</span> <span class="s">"가격은 100원 이상 10,000,000원 이하 입니다."</span><span class="o">));</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">TestController</code>를 만들고 <code class="language-plaintext highlighter-rouge">/test</code>에 매핑합니다. post 요청의 경우 <code class="language-plaintext highlighter-rouge">ProductDTO</code>를 주입받아 처리하도록 합니다. ProductDTO 뒤에 <code class="language-plaintext highlighter-rouge">BindingResult</code>를 주입했는데, 해당 객체가 없는 경우 모델에 대하여 binding이 실패하면 컨트롤러를 호출하지 않고 <code class="language-plaintext highlighter-rouge">BindException</code>을 던져 컨테이너가 자동으로 예외처리를 해버립니다. 하지만 객체 뒤에 BindingResult가 있으면 예외를 던지지 않고 우선 컨트롤러에 진입하게 됩니다.</p>

<p>이제 if문을 통해 검증을 하고, 예외상황인 경우 <code class="language-plaintext highlighter-rouge">FieldError</code>를 만들어서 <code class="language-plaintext highlighter-rouge">bindingResult</code>에 추가해주면 됩니다. 위에 코드에서는 count가 10 미만이거나 100 초과인 경우 count에 대하여 에러를 추가하고, price가 100 미만이거나 10,000,000 초과인 경우 price에 대하여 에러를 추가합니다.</p>

<p>bindingResult에 FieldError가 있는 경우 <code class="language-plaintext highlighter-rouge">BindException</code>을 던져줍니다. BindException은 <code class="language-plaintext highlighter-rouge">bindingResult</code>를 가지고 있으며, 이를 상속받아 작성한 <code class="language-plaintext highlighter-rouge">BindExceptionWithViewName</code>으로 뷰의 이름도 같이 전달해줍시다. 예외가 없다면 컨트롤러 로직을 수행하고 PRG 패턴을 사용하여 get 방식으로 redirect 합니다.</p>

<p>이제 예외컨트롤러를 작성하겠습니다. <code class="language-plaintext highlighter-rouge">@ControllerAdvice</code> 어노테이션을 통해 전역적인 예외처리를 해주는 <code class="language-plaintext highlighter-rouge">ExceptionHandlingController</code>를 작성합니다.</p>

<h6 id="krorubiscocontrollerexceptionhandlingcontrollerjava">/kro/rubisco/controller/ExceptionHandlingController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>

<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExceptionHandlingController</span> <span class="o">{</span>

    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">BindExceptionWithViewName</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">protected</span> <span class="nc">String</span> <span class="nf">handleBadRequest</span><span class="o">(</span><span class="nc">BindExceptionWithViewName</span> <span class="n">e</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"errors"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="na">getViewName</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">@ExceptionHandler</code> 어노테이션을 통해 <code class="language-plaintext highlighter-rouge">BindExceptionWithViewName</code>에 <code class="language-plaintext highlighter-rouge">handleBadRequest</code> 메소드를 매핑시킵니다. 해당 메소드에서는 모델에 Errors 객체를 추가하고, BindExceptionWithViewName을 통해 전달받은 뷰 이름을 반환합니다.</p>

<p>이제 뷰 템플릿을 작성하겠습니다.</p>

<h6 id="srcmainwebappweb-infviewstestjsp">/src/main/webapp/WEB-INF/views/test.jsp</h6>
<div data-lang="JSP" class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na"> pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ taglib </span><span class="na">uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span><span class="na"> prefix=</span><span class="s">"c"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"/test"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;c:forTokens </span><span class="na">var=</span><span class="s">"field"</span><span class="na"> items=</span><span class="s">"count,price"</span><span class="na"> delims=</span><span class="s">","</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label&gt;</span>
            <span class="nt">&lt;c:choose&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">field</span> <span class="n">eq</span> <span class="l">'count'</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>수량<span class="nt">&lt;/c:when&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">field</span> <span class="n">eq</span> <span class="l">'price'</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>가격<span class="nt">&lt;/c:when&gt;</span>
            <span class="nt">&lt;/c:choose&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"${field}"</span> <span class="na">value=</span><span class="s">"${errors.getFieldValue(field)}"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">hasFieldErrors</span><span class="o">(</span><span class="n">field</span><span class="o">)</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;font</span> <span class="na">color=</span><span class="s">"red"</span><span class="nt">&gt;</span>${errors.getFieldError(attr).defaultMessage}<span class="nt">&lt;/font&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
        <span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/c:forTokens&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"제출"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">()</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="p">[...</span><span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">[name]</span><span class="dl">"</span><span class="p">)].</span><span class="nx">filter</span><span class="p">(</span><span class="nx">e</span><span class="o">=&gt;!</span><span class="nx">e</span><span class="p">.</span><span class="nx">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>JSP에서 EL의 경우 해당 변수가 null이라면 출력되지 않게 됩니다. errors 객체에서 getFieldValue 메소드는 해당 프로퍼티에 에러가 있으면 null값이 되어 출력되지 않고 그렇지 않으면 클라이언트에서 전송한 값을 출력합니다. 그러므로 검증을 통과하지 못한 필드는 빈값이 되고 에러 메시지가 출력됩니다.</p>

<p align="center"><img src="/assets/images/spring-legacy/img32.png" alt="img32" /></p>

<h2 id="에러코드를-통한-메시지-출력">에러코드를 통한 메시지 출력</h2>

<p>이번에는 에러코드를 통해 메시지를 출력해보겠습니다. 방금 작성한 코드처럼 하드코딩으로 defaultMessage를 직접 작성해도 되지만, 메시지를 따로 관리하여 메시지를 코드를 통해 간접적으로 메시지를 출력할 수도 있습니다.</p>

<p>우선 메시지를 관리하기위한 <code class="language-plaintext highlighter-rouge">messageSource</code>를 컨테이너에 빈으로 추가합니다. 다국어 처리가 가능한 <code class="language-plaintext highlighter-rouge">ReloadableResourceBundleMessageSource</code>를 메시지 소스로 사용하도록 하겠습니다.</p>

<h6 id="srcmainwebappweb-infspringroot-contextxml">/src/main/webapp/WEB-INF/spring/root-context.xml</h6>
<div data-lang="XML" class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans 
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context 
    http://www.springframework.org/schema/context/spring-context-4.3.xsd"</span><span class="nt">&gt;</span>
    
    <span class="c">&lt;!-- Root Context: defines shared resources visible to all other web components --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">value=</span><span class="s">"oracle.jdbc.driver.OracleDriver"</span> <span class="na">name=</span><span class="s">"driverClassName"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">value=</span><span class="s">"[DB 주소]"</span> <span class="na">name=</span><span class="s">"url"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">value=</span><span class="s">"[DB 아이디]"</span> <span class="na">name=</span><span class="s">"username"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">value=</span><span class="s">"[DB 암호]"</span> <span class="na">name=</span><span class="s">"password"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
         
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"sqlSessionFactory"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.SqlSessionFactoryBean"</span><span class="nt">&gt;</span> 
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"configLocation"</span> <span class="na">value=</span><span class="s">"classpath:/mybatis-config.xml"</span><span class="nt">&gt;&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mapperLocations"</span> <span class="na">value=</span><span class="s">"classpath:mappers/**/*Mapper.xml"</span><span class="nt">&gt;&lt;/property&gt;</span>            
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"sqlSession"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.SqlSessionTemplate"</span> <span class="na">destroy-method=</span><span class="s">"clearCache"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"sqlSessionFactory"</span> <span class="na">ref=</span><span class="s">"sqlSessionFactory"</span><span class="nt">&gt;&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"messageSource"</span> <span class="na">class=</span><span class="s">"org.springframework.context.support.ReloadableResourceBundleMessageSource"</span><span class="nt">&gt;</span>
        
        <span class="c">&lt;!-- Encoding 설정 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"defaultEncoding"</span> <span class="na">value=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
        
        <span class="c">&lt;!-- Reload Cache 설정 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"cacheSeconds"</span> <span class="na">value=</span><span class="s">"5"</span> <span class="nt">/&gt;</span>
        
        <span class="c">&lt;!-- BaseName 설정 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"basenames"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;value&gt;</span>/WEB-INF/message/error<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        
    <span class="nt">&lt;/bean&gt;</span>
    
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"kro.rubisco.service"</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></div>

<p>basenames을 기준으로 <code class="language-plaintext highlighter-rouge">[basenames]_[언어코드]_[국가코드].properties</code> 형식으로 메시지 파일을 작성해야합니다. 예를 들어 한국어 메시지의 경우 <code class="language-plaintext highlighter-rouge">error_ko_KR.properties</code> 파일에, 영어 메시지의 경우 <code class="language-plaintext highlighter-rouge">error_en_US.properties</code> 파일에 작성하면 됩니다. 기본파일은 basename인 <code class="language-plaintext highlighter-rouge">error.properties</code>에 작성합니다.</p>

<h6 id="srcmainwebappweb-infmessageerrorproperties">/src/main/webapp/WEB-INF/message/error.properties</h6>
<div data-lang="PROPERTIES" class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>range.product.count = 제품의 수량은 {0}개 이상 {1}개 이하로 입력할 수 있습니다. 
range.product.price = 제품의 가격은 {0}원 이상 {1}원 이하로 입력할 수 있습니다.
</code></pre></div></div>

<p>{0}, {1}은 DataSource에서 전달되는 인수입니다.</p>

<p>BindExceptionWithViewName이 생성자를 통해 DataSource를 주입받도록 수정하고, 해당 객체를 통해 메시지를 출력할 수 있도록 getMessage 메소드를 추가하겠습니다.</p>

<h6 id="krorubiscoconfigbindexceptionwithviewnamejava-1">/kro/rubisco/config/BindExceptionWithViewName.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BindExceptionWithViewName</span> <span class="kd">extends</span> <span class="nc">BindException</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span>
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">String</span> <span class="n">viewName</span><span class="o">,</span> 
        <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">,</span>
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewName</span> <span class="o">=</span> <span class="n">viewName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">messageSource</span> <span class="o">=</span> <span class="n">messageSource</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">locale</span> <span class="o">=</span> <span class="n">locale</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getViewName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">field</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">getFieldError</span><span class="o">(</span><span class="n">field</span><span class="o">),</span> <span class="n">locale</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<p>TestController도 다음과 같이 <code class="language-plaintext highlighter-rouge">FieldError</code>의 생성자에 인수를 추가하고, <code class="language-plaintext highlighter-rouge">BindExceptionWithViewName</code>에 DataSource와 Locale을 주입해주도록 합시다.</p>

<h6 id="krorubiscocontrollertestcontrollerjava-1">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.FieldError</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span><span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">addError</span><span class="o">(</span>
                <span class="k">new</span> <span class="nf">FieldError</span><span class="o">(</span>
                    <span class="s">"product"</span><span class="o">,</span> <span class="s">"count"</span><span class="o">,</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"range.product.count"</span><span class="o">},</span> 
                    <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">10L</span><span class="o">,</span> <span class="mi">100L</span><span class="o">},</span> <span class="kc">null</span>
                <span class="o">)</span>
            <span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">10_000_000</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">addError</span><span class="o">(</span>
                <span class="k">new</span> <span class="nf">FieldError</span><span class="o">(</span>
                    <span class="s">"product"</span><span class="o">,</span> <span class="s">"price"</span><span class="o">,</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"range.product.price"</span><span class="o">},</span> 
                    <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100L</span><span class="o">,</span> <span class="mi">10_000_000L</span><span class="o">},</span> <span class="kc">null</span>
                <span class="o">)</span>
            <span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">FieldError</code>의 생성자 매개변수가 늘어났습니다. 1번째, 2번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">객체이름</code>, <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">필드이름</code>이고, 3번째 매개변수는 클라이언트가 요청한 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">필드값</code>입니다.</p>

<p>4번째 매개변수는 binding 오류인지 검증 오류인지 판단하기 위한 인수인데, 검증 오류이므로 false를 입력합니다.</p>

<p>5번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">에러코드</code>를 String 배열로 입력합니다. DataSource에 입력돤 key값과 매칭하여 일치하는 코드들 중에 첫번째 코드를 에러코드로 사용하게 됩니다.</p>

<p>6번째 매개변수는 DataSource로 전달될 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">인수</code>를 객체 배열로 생성하여 입력합니다. 인수가 필요없다면 null값을 주어도 됩니다. 범위 오류를 출력하는 경우와 같이 문구가 반복되고 값만 변한다면 동일한 코드에 인수만 전달하여 범용적으로 사용할 수 있습니다.</p>

<p>7번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">오류메시지의 기본값</code>으로, 일치하는 코드가 없다면 해당 값을 오류 메시지로 사용합니다. 위에 코드에서는 null값을 주었습니다.</p>

<hr />

<p>이제 뷰 템플릿을 수정합니다.</p>

<h6 id="srcmainwebappweb-infviewstestjsp-1">/src/main/webapp/WEB-INF/views/test.jsp</h6>
<div data-lang="JSP" class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na"> pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ taglib </span><span class="na">uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span><span class="na"> prefix=</span><span class="s">"c"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"/test"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;c:forTokens </span><span class="na">var=</span><span class="s">"field"</span><span class="na"> items=</span><span class="s">"count,price"</span><span class="na"> delims=</span><span class="s">","</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label&gt;</span>
            <span class="nt">&lt;c:choose&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">field</span> <span class="n">eq</span> <span class="l">'count'</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>수량<span class="nt">&lt;/c:when&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">field</span> <span class="n">eq</span> <span class="l">'price'</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>가격<span class="nt">&lt;/c:when&gt;</span>
            <span class="nt">&lt;/c:choose&gt;</span>
            <span class="nt">&lt;c:choose&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="o">!</span><span class="n">errors</span><span class="o">.</span><span class="na">hasFieldErrors</span><span class="o">(</span><span class="n">field</span><span class="o">)</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;c:set </span><span class="na">var=</span><span class="s">"value"</span><span class="na"> value=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">getFieldValue</span><span class="o">(</span><span class="n">field</span><span class="o">)</span><span class="si">}</span><span class="s">"</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/c:when&gt;</span>
                <span class="nt">&lt;c:otherwise&gt;&lt;c:remove </span><span class="na">var=</span><span class="s">"value"</span> <span class="nt">/&gt;&lt;/c:otherwise&gt;</span>
            <span class="nt">&lt;/c:choose&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"${field}"</span> <span class="na">value=</span><span class="s">"${value}"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">hasFieldErrors</span><span class="o">(</span><span class="n">field</span><span class="o">)</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;font</span> <span class="na">color=</span><span class="s">"red"</span><span class="nt">&gt;</span>${errors.getMessage(field)}<span class="nt">&lt;/font&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
        <span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/c:forTokens&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"제출"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">()</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="p">[...</span><span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">[name]</span><span class="dl">"</span><span class="p">)].</span><span class="nx">filter</span><span class="p">(</span><span class="nx">e</span><span class="o">=&gt;!</span><span class="nx">e</span><span class="p">.</span><span class="nx">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>메시지를 출력하는 부분의 코드를 errors 객체의 getMessage 메소드를 통해 출력하도록 변경했습니다.</p>

<p align="center"><img src="/assets/images/spring-legacy/img33.png" alt="img33" /></p>

<h2 id="rejectvalue-메소드-사용">rejectValue 메소드 사용</h2>

<p>FieldError를 직접 생성할 수도 있지만 BindingResult에서는 FieldError를 간단하게 생성할 수 있는 <code class="language-plaintext highlighter-rouge">rejectValue</code> 메소드가 있습니다. 아래와 같이 TestController를 수정해보세요.</p>

<h6 id="krorubiscocontrollertestcontrollerjava-2">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span>
        <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"product"</span><span class="o">)</span> <span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> 
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">10L</span><span class="o">,</span> <span class="mi">100L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">10_000_000</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"price"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100L</span><span class="o">,</span> <span class="mi">10_000_000L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>FieldError를 직접 생성하는 것이 아니라 rejectValue 메소드를 호출하여 FieldError를 생성했습니다. <code class="language-plaintext highlighter-rouge">BindingResult</code>는 검증할 객체 바로 다음에 주입되는 성질을 이용한 것입니다.</p>

<p>첫번째 변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">필드명</code>, 두번째 변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">에러코드</code> 입니다.</p>

<p>에러코드는 직접 FieldError를 생성할 때랑 차이가 있는데 MessageSource에 입력되는 키값은 <code class="language-plaintext highlighter-rouge">{에러코드}.{오브젝트명}.{필드명}</code> 형식으로 작성하고, 매개변수에는 에러코드 부분만 입력하면 됩니다. 예를 들어 MessageSource에 입력된 메시지 키값이 <code class="language-plaintext highlighter-rouge">range.product.cost</code>라면 <code class="language-plaintext highlighter-rouge">range</code>만 입력합니다.</p>

<p>오브젝트명은 검증할 객체의 타입으로 자동 설정되는데, 오브젝트명을 변경하려면 <code class="language-plaintext highlighter-rouge">@ModelAttribute</code> 어노테이션을 붙여 키값을 설정해주어야 합니다. 위에 예시 코드에서는 검증 객체의 이름이 <code class="language-plaintext highlighter-rouge">productDTO</code>이므로, 
<code class="language-plaintext highlighter-rouge">@ModelAttribute("product")</code> 어노테이션을 붙여 객체이름을 <code class="language-plaintext highlighter-rouge">product</code>로 변경해 주었습니다. 물론 MessageSource에 키값을 <code class="language-plaintext highlighter-rouge">range.productDTO.cost</code>라고 변경해도 됩니다.</p>

<p>이렇게 에러코드를 입력해두면 내부 로직에서는 <code class="language-plaintext highlighter-rouge">MessageCodesResolver</code> 객체를 통해 <code class="language-plaintext bgcolor yellow highlighter-rouge" style="color: orange">"{에러코드}.{오브젝트명}.{필드명}", "{에러코드}.{필드명}", "{에러코드}.{필드타입}", "{에러코드}"</code> 라는 4개의 에러코드를 생성하며, 여기에서 MessageSource에 존재하는 코드 중 첫번째 코드를 에러코드로 사용합니다. 예를 들어 위에 예시코드의 경우 <code class="language-plaintext bgcolor yellow highlighter-rouge" style="color: orange">{"range.product.cost", "range.cost", "range.java.lang.Long", "range"}</code> 순서로 에러코드가 생성되고, MessageSource에 존재하는 <code class="language-plaintext highlighter-rouge">range.product.cost</code>가 에러코드로 적용됩니다.</p>

<p>세번째 변수는 DataSource로 전달될 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">인수의 배열</code>이고, 네번째 변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">오류메시지 기본값</code>으로 null을 입력했습니다.</p>

<h2 id="objecterror-추가">ObjectError 추가</h2>

<p>FieldError 객체가 필드값의 오류를 나타낸다면 ObjectError는 객체의 오류를 나타냅니다. 예를 들어 총액이 100,000,000원 이하가 되도록 범위를 정하려면 FieldError 만으로는 오류를 나타낼 수 없고 ObjectError를 통해 객체 자체에 오류가 있음을 나타내야 합니다.</p>

<h6 id="krorubiscocontrollertestcontrollerjava-3">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.ObjectError</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span>
        <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"product"</span><span class="o">)</span> <span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> 
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">10L</span><span class="o">,</span> <span class="mi">100L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">10_000_000</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"price"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100L</span><span class="o">,</span> <span class="mi">10_000_000L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            
            <span class="nc">Long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">*</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
            
            <span class="k">if</span><span class="o">(</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">100_000_000</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">bindingResult</span><span class="o">.</span><span class="na">addError</span><span class="o">(</span>
                    <span class="k">new</span> <span class="nf">ObjectError</span><span class="o">(</span><span class="s">"product"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"totalPriceMax"</span><span class="o">},</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100_000_000L</span><span class="o">,</span> <span class="n">total</span><span class="o">},</span> <span class="kc">null</span><span class="o">)</span>
                <span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ObjectError</code>의 생성자는 4개의 매개변수가 필요합니다. 첫번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">객체이름</code>, 두번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">에러코드</code>, 세번째 매개변수는 DataSource로 전달될 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">인수의 배열</code>, 네번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">오류메시지 기본값</code> 입니다.</p>

<hr />

<p><code class="language-plaintext highlighter-rouge">BindExceptionWithViewName</code> 클래스에 글로벌 오류에 대한 메시지를 받을 <code class="language-plaintext highlighter-rouge">getGlobalMessage</code> 메소드를 추가합니다.</p>

<h6 id="krorubiscoconfigbindexceptionwithviewnamejava-2">/kro/rubisco/config/BindExceptionWithViewName.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BindExceptionWithViewName</span> <span class="kd">extends</span> <span class="nc">BindException</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span>
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">String</span> <span class="n">viewName</span><span class="o">,</span> 
        <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">,</span>
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewName</span> <span class="o">=</span> <span class="n">viewName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">messageSource</span> <span class="o">=</span> <span class="n">messageSource</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">locale</span> <span class="o">=</span> <span class="n">locale</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getViewName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">field</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">getFieldError</span><span class="o">(</span><span class="n">field</span><span class="o">),</span> <span class="n">locale</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getGlobalMessage</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">getGlobalError</span><span class="o">(),</span> <span class="n">locale</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>메시지도 다음과 같이 추가해줍니다.</p>

<h6 id="srcmainwebappweb-infmessageerrorproperties-1">/src/main/webapp/WEB-INF/message/error.properties</h6>
<div data-lang="PROPERTIES" class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>range.product.count = 제품의 수량은 {0}개 이상 {1}개 이하로 입력할 수 있습니다. 
range.product.price = 제품의 가격은 {0}원 이상 {1}원 이하로 입력할 수 있습니다.
totalPriceMax = 최대 예산은 {0}원 입니다. (현재 총액: {1}원)
</code></pre></div></div>

<p>뷰 템플릿을 다음과 같이 수정합니다.</p>

<h6 id="srcmainwebappweb-infviewstestjsp-2">/src/main/webapp/WEB-INF/views/test.jsp</h6>
<div data-lang="JSP" class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na"> pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ taglib </span><span class="na">uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span><span class="na"> prefix=</span><span class="s">"c"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"/test"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;c:forTokens </span><span class="na">var=</span><span class="s">"field"</span><span class="na"> items=</span><span class="s">"count,price"</span><span class="na"> delims=</span><span class="s">","</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label&gt;</span>
            <span class="nt">&lt;c:choose&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">field</span> <span class="n">eq</span> <span class="l">'count'</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>수량<span class="nt">&lt;/c:when&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">field</span> <span class="n">eq</span> <span class="l">'price'</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>가격<span class="nt">&lt;/c:when&gt;</span>
            <span class="nt">&lt;/c:choose&gt;</span>
            <span class="nt">&lt;c:choose&gt;</span>
                <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="o">!</span><span class="n">errors</span><span class="o">.</span><span class="na">hasFieldErrors</span><span class="o">(</span><span class="n">field</span><span class="o">)</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;c:set </span><span class="na">var=</span><span class="s">"value"</span><span class="na"> value=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">getFieldValue</span><span class="o">(</span><span class="n">field</span><span class="o">)</span><span class="si">}</span><span class="s">"</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/c:when&gt;</span>
                <span class="nt">&lt;c:otherwise&gt;&lt;c:remove </span><span class="na">var=</span><span class="s">"value"</span> <span class="nt">/&gt;&lt;/c:otherwise&gt;</span>
            <span class="nt">&lt;/c:choose&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"${field}"</span> <span class="na">value=</span><span class="s">"${value}"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">hasFieldErrors</span><span class="o">(</span><span class="n">field</span><span class="o">)</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;font</span> <span class="na">color=</span><span class="s">"red"</span><span class="nt">&gt;</span>${errors.getMessage(field)}<span class="nt">&lt;/font&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
        <span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/c:forTokens&gt;</span>
    <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="o">!</span><span class="n">error</span><span class="o">.</span><span class="na">hasFieldErrors</span><span class="o">()</span> <span class="n">and</span> <span class="n">errors</span><span class="o">.</span><span class="na">hasGlobalErrors</span><span class="o">()</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;&lt;font</span> <span class="na">color=</span><span class="s">"red"</span><span class="nt">&gt;</span>${errors.globalMessage}<span class="nt">&lt;/font&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/c:if&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"제출"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">()</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="p">[...</span><span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">[name]</span><span class="dl">"</span><span class="p">)].</span><span class="nx">filter</span><span class="p">(</span><span class="nx">e</span><span class="o">=&gt;!</span><span class="nx">e</span><span class="p">.</span><span class="nx">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>FieldError와 마찬가지로 BindingResult의 <code class="language-plaintext highlighter-rouge">reject</code> 메소드를 통해서 간편하게 생성할 수 있습니다.</p>

<h6 id="krorubiscocontrollertestcontrollerjava-4">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span>
        <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"product"</span><span class="o">)</span> <span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> 
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">10L</span><span class="o">,</span> <span class="mi">100L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">10_000_000</span><span class="o">){</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"price"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100L</span><span class="o">,</span> <span class="mi">10_000_000L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            
            <span class="nc">Long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">*</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
            
            <span class="k">if</span><span class="o">(</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">100_000_000</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">bindingResult</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="s">"totalPriceMax"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100_000_000L</span><span class="o">,</span> <span class="n">total</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>reject 메소드의 1번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">에러코드</code>, 두번째 매개변수는 DataSource로 전달될 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">인수의 배열</code>, 세번째 매개변수는 <code class="language-plaintext bgcolor blue highlighter-rouge" style="color: royalblue">오류메시지 기본값</code> 입니다.</p>


                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Rubisco's Programming Note</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- utterances -->
            <div id="comment">
                <script src="https://utteranc.es/client.js"
                repo="huimang2/huimang2.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async></script>
            </div>
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/M31_starspike.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Rubisco's Programming Note &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/java/">Java</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/maven-project">이클립스 메이븐 프로젝트</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-security">스프링 레거시(Spring legacy) - 시큐리티 적용</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-filter-and-interceptor">스프링 레거시(Spring legacy) - 필터와 인터셉터</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/java/">
                                
                                    See all 18 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/java/spring-legacy-bean-validation">
                <div class="post-card-image" style="background-image: url(/assets/images/spring-legacy/logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/java/spring-legacy-bean-validation">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">스프링 레거시(Spring legacy) - Bean Validation</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>Validator

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      6 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/java/spring-legacy-exception">
                <div class="post-card-image" style="background-image: url(/assets/images/spring-legacy/logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/java/spring-legacy-exception">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">스프링 레거시(Spring legacy) - 예외처리</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>이번 글에서는 클라이언트 요청에 대한 예외 처리를 해보겠습니다.

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://huimang2.github.io/">
            
            <span>Rubisco's Programming Note</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">스프링 레거시(Spring legacy) - 유효성 검사</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%EC%8A%A4%ED%94%84%EB%A7%81+%EB%A0%88%EA%B1%B0%EC%8B%9C%28Spring+legacy%29+-+%EC%9C%A0%ED%9A%A8%EC%84%B1+%EA%B2%80%EC%82%AC&amp;url=java/spring-legacy-validation"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=java/spring-legacy-validation"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://huimang2.github.io/">Rubisco's Programming Note</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search Rubisco's Programming Note</h1>
            <p class="subscribe-overlay-description">
            lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>


    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    /* toc ---------------------------------------------------------------------*/

    var tocTitle = document.getElementsByClassName("post-full-title")[0];
    var tocTitleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var tocArticle = document.getElementsByClassName("post-full-content")[0];
    var tocArticleY = window.pageYOffset + tocArticle.getBoundingClientRect().top;
  
    var toc = document.getElementById("toc");
    var tocHeaderNodes = getHeaderNodes(tocArticle);
    var tocNodes = getTOCNodes(toc);
  
    var tocBefore = undefined;

    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3" && !elem.classList.contains('no-toc');
        });
        return headerNodes;
    }

    tocNodes.forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    document.querySelector('.post-full-content').querySelectorAll('p a[href^="#"]').forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    /*--------------------------------------------------------------------------*/

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 30;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
            toc.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
            toc.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;

        // toc
        var tocCurrent = tocHeaderNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 90;
        });
  
        if (tocCurrent.length > 0) {
            tocCurrent = tocCurrent[tocCurrent.length-1];
  
            var tocCurrentA = tocNodes.filter(function(tocNode) {
                return tocNode.getElementsByTagName("span")[0].innerHTML == tocCurrent.innerHTML;
            })
            
            tocCurrentA = tocCurrentA[0];

            if (tocCurrentA) {
                if (tocBefore == undefined) tocBefore = tocCurrentA;
    
                if (tocBefore != tocCurrentA) {
                    tocBefore.classList.remove("toc-active");
                    tocBefore = tocCurrentA;
                }
    
                tocCurrentA.classList.add("toc-active");
            }
            else {
                if (tocBefore) 
                    tocBefore.classList.remove("toc-active");
            }
        }
        else {
            if (tocBefore) 
                tocBefore.classList.remove("toc-active");
        }
        
        if(toc && tocArticle.getBoundingClientRect().bottom <= 0) {
            toc.classList.add('toc-hidden');
        } else {
            toc.classList.remove('toc-hidden');
        }
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
