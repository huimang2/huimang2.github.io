<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>스프링 레거시(Spring legacy) - Bean Validation</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- 웹 폰트 설정 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
    

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- syntax.css -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="프로그래밍 노트" />
    <link rel="shortcut icon" href="https://huimang2.github.io/assets/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://huimang2.github.io/java/spring-legacy-bean-validation" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Rubisco's Programming Note" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="스프링 레거시(Spring legacy) - Bean Validation" />
    <meta property="og:description" content="Validator 지난번 글에서는 컨트롤러에서 BindingResult 객체를 통해 검증하고 오류가 있으면 예외를 던져 메시지 출력 처리를 했습니다. 하지만 조금더 객체지향적인 프로그래밍을 하기 위해서는 컨트롤러에서 검증 로직을 분리하여 별도의 클래스로 관리하는 것이 코드를 유지보수하기에 좋을 수 있습니다. 스프링에서는 검증 로직을 위한 Validator 검증기 인터페이스를 지원합니다. validator 패키지 폴더를 생성하고 그 아래에 검증기" />
    <meta property="og:url" content="https://huimang2.github.io/java/spring-legacy-bean-validation" />
    <meta property="og:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-10-31T01:00:00+09:00" />
    <meta property="article:modified_time" content="2022-10-31T01:00:00+09:00" />
    <meta property="article:tag" content="Java" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="스프링 레거시(Spring legacy) - Bean Validation" />
    <meta name="twitter:description" content="Validator 지난번 글에서는 컨트롤러에서 BindingResult 객체를 통해 검증하고 오류가 있으면 예외를 던져 메시지 출력 처리를 했습니다. 하지만 조금더 객체지향적인 프로그래밍을 하기 위해서는 컨트롤러에서 검증 로직을 분리하여 별도의 클래스로 관리하는 것이 코드를 유지보수하기에 좋을 수 있습니다. 스프링에서는 검증 로직을 위한 Validator 검증기 인터페이스를 지원합니다. validator 패키지 폴더를 생성하고 그 아래에 검증기" />
    <meta name="twitter:url" content="https://huimang2.github.io/" />
    <meta name="twitter:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rubisco's Programming Note" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Java" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Rubisco's Programming Note",
        "logo": "https://huimang2.github.io/"
    },
    "url": "https://huimang2.github.io/java/spring-legacy-bean-validation",
    "image": {
        "@type": "ImageObject",
        "url": "https://huimang2.github.io/assets/images/spring-legacy/logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://huimang2.github.io/java/spring-legacy-bean-validation"
    },
    "description": "Validator 지난번 글에서는 컨트롤러에서 BindingResult 객체를 통해 검증하고 오류가 있으면 예외를 던져 메시지 출력 처리를 했습니다. 하지만 조금더 객체지향적인 프로그래밍을 하기 위해서는 컨트롤러에서 검증 로직을 분리하여 별도의 클래스로 관리하는 것이 코드를 유지보수하기에 좋을 수 있습니다. 스프링에서는 검증 로직을 위한 Validator 검증기 인터페이스를 지원합니다. validator 패키지 폴더를 생성하고 그 아래에 검증기"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="스프링 레거시(Spring legacy) - Bean Validation" href="/feed.xml" />


    <!-- MathJax -->
    

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://huimang2.github.io/">Rubisco's Programming Note</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-java" role="menuitem"><a href="/tag/java/">JAVA</a></li>
    <li class="nav-typescript" role="menuitem"><a href="/tag/typescript/">Typescript</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/algorithm/">Algorithm</a></li>
    <li class="nav-python" role="menuitem"><a href="/archive.html">All Posts</a></li>
    <li class="nav-python" role="menuitem"><a href="/author_archive.html">Tag별 Posts</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-java tag-spring post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="31 October 2022">31 October 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                                
                                <a href='/tag/java/'>#JAVA</a>,&nbsp;
                                
                            
                        
                            
                                
                                <a href='/tag/spring/'>#SPRING</a>
                                
                            
                        
                    
                </section>
                <h1 class="post-full-title">스프링 레거시(Spring legacy) - Bean Validation</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/images/spring-legacy/logo.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <div id="toc">
                        <ul><li><a href="#validator"><span>Validator</span></a></li><li><a href="#bean-validation"><span>Bean Validation</span></a><ul><li><a href="#에러-코드"><span>에러 코드</span></a></li><li><a href="#객체-검사"><span>객체 검사</span></a></li><li><a href="#groups-기능"><span>groups 기능</span></a></li></ul></li></ul>

                    </div>
                    <h1 id="validator">Validator</h1>

<p>지난번 글에서는 컨트롤러에서 BindingResult 객체를 통해 검증하고 오류가 있으면 예외를 던져 메시지 출력 처리를 했습니다. 하지만 조금더 객체지향적인 프로그래밍을 하기 위해서는 컨트롤러에서 검증 로직을 분리하여 별도의 클래스로 관리하는 것이 코드를 유지보수하기에 좋을 수 있습니다.</p>

<p>스프링에서는 검증 로직을 위한 Validator 검증기 인터페이스를 지원합니다. validator 패키지 폴더를 생성하고 그 아래에 검증기 클래스를 작성하도록 하겠습니다. 검증기를 빈으로 등록하기 위해 우선 어플리케이션 컨텍스트에 validator 폴더를 스캔할 수 있도록 <code class="language-plaintext highlighter-rouge">component-scan</code>을 추가합니다.</p>

<h6 id="srcmainwebappweb-infspringroot-contextxml">/src/main/webapp/WEB-INF/spring/root-context.xml</h6>
<div data-lang="XML" class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"kro.rubisco.validator"</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
...
</code></pre></div></div>

<p>validator 패키지 아래에 <code class="language-plaintext highlighter-rouge">ProductValidator</code> 클래스를 작성해주세요.</p>

<h6 id="krorubiscovalidatorproductvalidatorjava">/kro/rubisco/validator/ProductValidator.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.validator</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.Validator</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductValidator</span> <span class="kd">implements</span> <span class="nc">Validator</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supports</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">ProductDTO</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="nc">Object</span> <span class="n">target</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
        
        <span class="nc">ProductDTO</span> <span class="n">product</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ProductDTO</span><span class="o">)</span> <span class="n">target</span><span class="o">;</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">){</span>
            <span class="n">errors</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">10L</span><span class="o">,</span> <span class="mi">100L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">||</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">10_000_000</span><span class="o">){</span>
            <span class="n">errors</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"price"</span><span class="o">,</span> <span class="s">"range"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100L</span><span class="o">,</span> <span class="mi">10_000_000L</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            
            <span class="nc">Long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">*</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
            
            <span class="k">if</span><span class="o">(</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">100_000_000</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">errors</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="s">"totalPriceMax"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span><span class="mi">100_000_000L</span><span class="o">,</span> <span class="n">total</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">@Component</code> 어노테이션을 통해 컨테이너에 빈으로 등록하고, <code class="language-plaintext highlighter-rouge">Validator</code> 인터페이스를 상속받아 <code class="language-plaintext highlighter-rouge">supports</code> 메소드와 <code class="language-plaintext highlighter-rouge">validate</code> 메소드를 구현해야합니다.</p>

<p><code class="language-plaintext highlighter-rouge">supports</code>는 해당 검증기가 검증하려는 객체를 지원하는지 확인하기 위한 메소드이고, <code class="language-plaintext highlighter-rouge">validate</code>는 검증을 수행하는 메소드 입니다.</p>

<p><code class="language-plaintext highlighter-rouge">supports</code>에는 매개변수로 클래스가 주입되므로, 검증 객체의 타입인 ProductDTO와 동일한 클래스인지 확인하면 됩니다.</p>

<p><code class="language-plaintext highlighter-rouge">validate</code>에는 컨트롤러에서 작성한 검증 로직을 그대로 가져오면 됩니다. 참고로 <code class="language-plaintext highlighter-rouge">Errors</code>는 <code class="language-plaintext highlighter-rouge">BindingResult</code>의 상위 인터페이스입니다.</p>

<p>이제 컨트롤러를 다음과 같이 수정해주세요.</p>

<h6 id="krorubiscocontrollertestcontrollerjava">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.WebDataBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.InitBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.validator.ProductValidator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ProductValidator</span> <span class="n">productValidator</span><span class="o">;</span>
    
    <span class="nd">@InitBinder</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">WebDataBinder</span> <span class="n">dataBinder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">dataBinder</span><span class="o">.</span><span class="na">addValidators</span><span class="o">(</span><span class="n">productValidator</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span>
        <span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"product"</span><span class="o">)</span> <span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> 
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ProductValidator</code>를 생성자로 주입하고, <code class="language-plaintext highlighter-rouge">@InitBinder</code> 어노테이션을 통해 <code class="language-plaintext highlighter-rouge">WebDataBinder</code>를 초기화 해줍니다. WebDataBinder는 사용자의 요청을 객체에 바인딩 해주는 역할을 하며, 검증 기능도 내부에 포함되어 있습니다. addValidators를 통해 주입받은 ProductValidator를 추가합니다.</p>

<p><code class="language-plaintext highlighter-rouge">getTestView</code> 메소드에는 <code class="language-plaintext highlighter-rouge">ProductDTO</code> 앞에 <code class="language-plaintext highlighter-rouge">@Validated</code> 어노테이션이 추가되었습니다. 해당 어노테이션이 추가되면 webDateBinder에 등록한 검증기를 찾아서 <code class="language-plaintext highlighter-rouge">validate</code> 메소드를 호출합니다. 이때 어떤 검증기가 호출될지는 <code class="language-plaintext highlighter-rouge">supports</code> 메소드를 통해 확인됩니다.</p>

<p><code class="language-plaintext highlighter-rouge">ProductDTO.class</code>를 매개변수로 주고, <code class="language-plaintext highlighter-rouge">true</code>가 리턴되는 검증기에서 <code class="language-plaintext highlighter-rouge">validate</code> 를 호출합니다. 이때 <code class="language-plaintext highlighter-rouge">ProductDTO</code>와 <code class="language-plaintext highlighter-rouge">BindingResult</code>가 주입되어 검증을 수행합니다. 즉, 컨트롤러에서 수행한 검증 로직을 검증기에서 하게 된 것입니다.</p>

<p>컨트롤러에서는 BindingResult에 오류가 있는지 확인 후 오류가 있다면 예외를 던져줍니다.</p>

<h1 id="bean-validation">Bean Validation</h1>

<p>이번에는 <code class="language-plaintext highlighter-rouge">Bean Validation</code>에 대해 알아보겠습니다. Bean Validation은 특정 구현체가 아닌 <code class="language-plaintext highlighter-rouge">Bean VAlidation 2.0(JSR-380)</code>이라는 검증에 대한 표준을 정의한 인터페이스 모음입니다. 해당 인터페이스를 구현한 대표적인 구현체로 <code class="language-plaintext highlighter-rouge">hibernate-validator</code>가 있습니다.</p>

<p>Bean Validation을 사용하면 어노테이션을 통해 간단하게 검증을 수행할 수 있습니다. 우선 pom.xml에 maven repository를 참고하여 사용률이 높은 의존성을 추가해주도록 하겠습니다. 스프링 버전도 높이겠습니다.</p>

<h6 id="pomxml">pom.xml</h6>
<div data-lang="XML" class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java-version&gt;</span>1.8<span class="nt">&lt;/java-version&gt;</span>
        <span class="nt">&lt;org.springframework-version&gt;</span>5.3.23<span class="nt">&lt;/org.springframework-version&gt;</span>
        <span class="nt">&lt;org.aspectj-version&gt;</span>1.6.10<span class="nt">&lt;/org.aspectj-version&gt;</span>
        <span class="nt">&lt;org.slf4j-version&gt;</span>1.6.6<span class="nt">&lt;/org.slf4j-version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
...
    <span class="nt">&lt;dependencies&gt;</span>
    ...
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/javax.validation/validation-api --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.validation<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>validation-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.0.1.Final<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.hibernate.validator<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hibernate-validator<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>6.2.0.Final<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    ...
    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h2 id="에러-코드">에러 코드</h2>

<p>아래는 에러코드에 대응되는 어노테이션을 나타냅니다.</p>

<table>
  <thead>
    <tr>
      <th>어노테이션</th>
      <th>내용</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>@AssertTrue<br />@AssertFalse</td>
      <td>값이 true 또는 false인지 검사</td>
    </tr>
    <tr>
      <td>@DecimalMax<br />@DecimalMin</td>
      <td>지정값보다 크거나 같은지 또는 작거나 같은지 검사</td>
    </tr>
    <tr>
      <td>@Max<br />@Min</td>
      <td>지정값보다 크거나 같은지 또는 작거나 같은지 검사</td>
    </tr>
    <tr>
      <td>@Digits</td>
      <td>자리수 검사</td>
    </tr>
    <tr>
      <td>@Size</td>
      <td>배열이나 컬렉션의 크기가 범위내에 있는지 검사</td>
    </tr>
    <tr>
      <td>@range</td>
      <td>범위 내에 값이 존재하는지 검사</td>
    </tr>
    <tr>
      <td>@Null<br />@NotNull</td>
      <td>null인지 또는 null이 아닌지 검사</td>
    </tr>
    <tr>
      <td>@Positive<br />@PositiveOrZero</td>
      <td>양수인지 검사</td>
    </tr>
    <tr>
      <td>@Negative<br />@NegativeOrZero</td>
      <td>음수인지 검사</td>
    </tr>
    <tr>
      <td>@Email</td>
      <td>이메일 형식에 맞는지 검사</td>
    </tr>
    <tr>
      <td>@Future<br />@FutureOrPresent</td>
      <td>미래의 시간인지 검사</td>
    </tr>
    <tr>
      <td>@Past<br />@PastOrPresent</td>
      <td>과거의 시간인지 검사</td>
    </tr>
    <tr>
      <td>@Pattern</td>
      <td>정규식 검사</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">ProductDTO</code>를 수정하겠습니다.</p>

<h6 id="krorubiscodtoproductdtojava">/kro/rubisco/dto/ProductDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Range</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDTO</span> <span class="o">{</span>
    
    <span class="nd">@NotNull</span> <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">count</span><span class="o">;</span>
    
    <span class="nd">@NotNull</span> <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">10_000_000</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">price</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>확인을 위해 <code class="language-plaintext highlighter-rouge">error.properties</code> 파일에 메시지를 지우고 컨트롤러를 다음과 같이 수정합니다.</p>

<h6 id="krorubiscocontrollertestcontrollerjava-1">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span>
        <span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"product"</span><span class="o">)</span> <span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> 
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>검증기를 지웠습니다. 유효성 검사를 위해서는 ProductDTO 앞에 <code class="language-plaintext highlighter-rouge">@Validated</code> 또는 <code class="language-plaintext highlighter-rouge">@Valid</code> 어노테이션을 붙이면 ProductDTO의 어노테이션을 기준으로 검증이 수행됩니다.</p>

<p>@Validated와 @Valid는 기능이 동일하며, @Valid는 자바 표준, @Validated는 스프링 표준입니다. @Validated의 경우 그룹 기능을 사용할 수 있습니다.</p>

<hr />

<p>Bean Validation을 사용하면 메시지 기본값이 자동으로 설정되며, message 인수를 통해 지정해 줄수도 있습니다.</p>

<h6 id="krorubiscodtoproductdtojava-1">/kro/rubisco/dto/ProductDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Range</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDTO</span> <span class="o">{</span>
    
    <span class="nd">@NotNull</span> <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"제품의 수량은 10개 이상 100개 이하로 입력할 수 있습니다."</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">count</span><span class="o">;</span>
    
    <span class="nd">@NotNull</span> <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">10_000_000</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"제품의 가격은 100원 이상 10,000,000원 이하로 입력할 수 있습니다"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">price</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>다국어 지원을 위해서는 <code class="language-plaintext highlighter-rouge">dataSource</code>에 입력하는 것을 권장합니다. 인수의 경우, {0}은 필드명이고, {1} 부터는 인수의 이름을 오름차순한 순서로 주입됩니다. 에러코드는 어노테이션 이름과 동일합니다. 메시지를 다음과 같이 작성해주세요.</p>

<h6 id="srcmainwebappweb-infmessageerrorproperties">/src/main/webapp/WEB-INF/message/error.properties</h6>
<div data-lang="PROPERTIES" class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Range.product.count = 제품의 수량은 {2}개 이상 {1}개 이하로 입력할 수 있습니다. 
Range.product.price = 제품의 가격은 {2}원 이상 {1}원 이하로 입력할 수 있습니다.
totalPriceMax = 최대 예산은 {0}원 입니다. (현재 총액: {1}원)
</code></pre></div></div>

<p>max가 min보다 알파벳 순서상 앞서므로, max = {1}, min = {2}가 됩니다.</p>

<h2 id="객체-검사">객체 검사</h2>

<p>객체 검사의 경우 <code class="language-plaintext highlighter-rouge">@ScriptAssert</code> 어노테이션을 사용하면 됩니다.</p>

<h6 id="krorubiscodtoproductdtojava-2">/kro/rubisco/dto/ProductDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Range</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.ScriptAssert</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="nd">@ScriptAssert</span><span class="o">(</span><span class="n">lang</span><span class="o">=</span><span class="s">"javascript"</span><span class="o">,</span> <span class="n">script</span> <span class="o">=</span> <span class="s">"_this.count * _this.price &lt; 100000000"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDTO</span> <span class="o">{</span>
    
    <span class="nd">@NotNull</span> 
    <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">count</span><span class="o">;</span>
    
    <span class="nd">@NotNull</span> <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">10_000_000</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">price</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>에러코드는 <code class="language-plaintext highlighter-rouge">ScriptAssert.product</code> 또는 <code class="language-plaintext highlighter-rouge">ScriptAssert</code>가 됩니다. 그러나 제약사항이 많고 복잡하므로, 객체 검사의 경우 검증기를 사용할 것을 권장합니다.</p>

<h2 id="groups-기능">groups 기능</h2>

<p>객체의 필드를 메소드마다 다르게 검사해야할 경우가 있습니다. 예를 들어 게시글을 입력할때는 documentId가 필수적이지 않지만, 게시글을 수정하거나 삭제할때는 documentId가 필수값이 됩니다. 이러한 이유들로 DB의 결과 데이터를 담을 Entity와 사용자의 요청을 담을 DTO를 구분합니다. Entity는 변화가 거의 없고, DTO는 변화가 빈번하기 때문입니다.</p>

<p>DTO를 따로 작성하지 않더라도 필드 검증을 다르게 적용할 수 있는데, 바로 <code class="language-plaintext highlighter-rouge">groups</code> 기능입니다. 이 기능은 <code class="language-plaintext highlighter-rouge">@Validated</code> 어노테이션에서 사용가능합니다. 앞서 설명했듯이 이 어노테이션은 클래스를 비교하여 검증기를 선택할 수 있도록 합니다.</p>

<hr />

<p>count는 update에만, price는 update와 insert를 할 때 검증이 된다고 가정합시다. 아래와 같이 DTO를 수정해주세요.</p>

<h6 id="krorubiscodtoproductdtojava-3">/kro/rubisco/dto/ProductDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Range</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.validator.ProductInsertValidator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.validator.ProductUpdateValidator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDTO</span> <span class="o">{</span>
    
    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="nc">ProductUpdateValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="nc">ProductUpdateValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">count</span><span class="o">;</span>
    
    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span><span class="nc">ProductUpdateValidator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ProductInsertValidator</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
    <span class="nd">@Range</span><span class="o">(</span>
        <span class="n">min</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">10_000_000</span><span class="o">,</span> 
        <span class="n">groups</span> <span class="o">=</span> <span class="o">{</span><span class="nc">ProductUpdateValidator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ProductInsertValidator</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">price</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ProductUpdateValidator</code>와 <code class="language-plaintext highlighter-rouge">ProductInsertValidator</code>는 비어있는 인터페이스로, 단지 구분을 위해 껍데기를 생성해주었을 뿐입니다.</p>

<hr />

<p>컨트롤러의 <code class="language-plaintext highlighter-rouge">@Validated</code> 어노테이션에는 다음과 같이 <code class="language-plaintext highlighter-rouge">ProductInsertValidator.class</code>를 입력해주세요.</p>

<h6 id="krorubiscocontrollertestcontrollerjava-2">/kro/rubisco/controller/TestController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.WebDataBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.InitBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.ProductDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.validator.ProductInsertValidator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.validator.ProductValidator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ProductValidator</span> <span class="n">productValidator</span><span class="o">;</span>
    
    <span class="nd">@InitBinder</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">WebDataBinder</span> <span class="n">dataBinder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">dataBinder</span><span class="o">.</span><span class="na">addValidators</span><span class="o">(</span><span class="n">productValidator</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTestView</span><span class="o">()</span> <span class="o">{}</span>
    
    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTestView</span><span class="o">(</span>
        <span class="nd">@Validated</span><span class="o">(</span><span class="nc">ProductInsertValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"product"</span><span class="o">)</span> <span class="nc">ProductDTO</span> <span class="n">product</span><span class="o">,</span> 
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> 
        <span class="nc">Locale</span> <span class="n">locale</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">BindException</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"/test"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"redirect:/test"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>실행시켜보면 count는 검증하지 않고 price 필드만 검증하는 것을 볼 수 있습니다. 하지만 메소드가 많을수록 코드가 복잡해지므로 Entity와 DTO를 분리하여 작성하는 것을 권장합니다.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Rubisco's Programming Note</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- utterances -->
            <div id="comment">
                <script src="https://utteranc.es/client.js"
                repo="huimang2/huimang2.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async></script>
            </div>
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/M31_starspike.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Rubisco's Programming Note &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/java/">Java</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/maven-project">이클립스 메이븐 프로젝트</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-security">스프링 레거시(Spring legacy) - 시큐리티 적용</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-filter-and-interceptor">스프링 레거시(Spring legacy) - 필터와 인터셉터</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/java/">
                                
                                    See all 18 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/java/spring-legacy-sign-up">
                <div class="post-card-image" style="background-image: url(/assets/images/spring-legacy/logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/java/spring-legacy-sign-up">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">스프링 레거시(Spring legacy) - 회원가입</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>이번 글에서는 bean validation을 통해 회원가입을 구현하겠습니다.

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/java/spring-legacy-validation">
                <div class="post-card-image" style="background-image: url(/assets/images/spring-legacy/logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/java/spring-legacy-validation">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">스프링 레거시(Spring legacy) - 유효성 검사</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>이번 글에서는 예외처리에 대한 보충설명과 유효성 검사에 대하여 알아보겠습니다.

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      11 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://huimang2.github.io/">
            
            <span>Rubisco's Programming Note</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">스프링 레거시(Spring legacy) - Bean Validation</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%EC%8A%A4%ED%94%84%EB%A7%81+%EB%A0%88%EA%B1%B0%EC%8B%9C%28Spring+legacy%29+-+Bean+Validation&amp;url=java/spring-legacy-bean-validation"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=java/spring-legacy-bean-validation"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://huimang2.github.io/">Rubisco's Programming Note</a> &copy; 2023</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search Rubisco's Programming Note</h1>
            <p class="subscribe-overlay-description">
            lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>


    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    /* toc ---------------------------------------------------------------------*/

    var tocTitle = document.getElementsByClassName("post-full-title")[0];
    var tocTitleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var tocArticle = document.getElementsByClassName("post-full-content")[0];
    var tocArticleY = window.pageYOffset + tocArticle.getBoundingClientRect().top;
  
    var toc = document.getElementById("toc");
    var tocHeaderNodes = getHeaderNodes(tocArticle);
    var tocNodes = getTOCNodes(toc);
  
    var tocBefore = undefined;

    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3" && !elem.classList.contains('no-toc');
        });
        return headerNodes;
    }

    tocNodes.forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    document.querySelector('.post-full-content').querySelectorAll('p a[href^="#"]').forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    /*--------------------------------------------------------------------------*/

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 30;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
            toc.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
            toc.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;

        // toc
        var tocCurrent = tocHeaderNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 90;
        });
  
        if (tocCurrent.length > 0) {
            tocCurrent = tocCurrent[tocCurrent.length-1];
  
            var tocCurrentA = tocNodes.filter(function(tocNode) {
                return tocNode.getElementsByTagName("span")[0].innerHTML == tocCurrent.innerHTML;
            })
            
            tocCurrentA = tocCurrentA[0];

            if (tocCurrentA) {
                if (tocBefore == undefined) tocBefore = tocCurrentA;
    
                if (tocBefore != tocCurrentA) {
                    tocBefore.classList.remove("toc-active");
                    tocBefore = tocCurrentA;
                }
    
                tocCurrentA.classList.add("toc-active");
            }
            else {
                if (tocBefore) 
                    tocBefore.classList.remove("toc-active");
            }
        }
        else {
            if (tocBefore) 
                tocBefore.classList.remove("toc-active");
        }
        
        if(toc && tocArticle.getBoundingClientRect().bottom <= 0) {
            toc.classList.add('toc-hidden');
        } else {
            toc.classList.remove('toc-hidden');
        }
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
