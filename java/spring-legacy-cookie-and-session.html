<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>스프링 레거시(Spring legacy) - 쿠키와 세션</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- 웹 폰트 설정 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
    

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- syntax.css -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="프로그래밍 노트" />
    <link rel="shortcut icon" href="https://huimang2.github.io/assets/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://huimang2.github.io/java/spring-legacy-cookie-and-session" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Rubisco's Programming Note" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="스프링 레거시(Spring legacy) - 쿠키와 세션" />
    <meta property="og:description" content="이번 글에서는 로그인 기능을 구현하기에 앞서 쿠키와 세션에 대하여 알아보겠습니다. HTTP 특징 HTTP 프로토콜의 경우 서버가 클라이언트의 요청(request)을 받으면 클라이언트로 응답(response)를 보낸 후 연결을 끊어버립니다. 이러한 비연결지향적 특성으로 인하여 서버는 클라이언트의 이전 요청을 알지 못하며, 클라이언트의 상태정보를 유지하기 위해서는 요청을 보낼때마다 인증과정을 거쳐야합니다. 쿠키와 세션은 이러한 단점을 보완하여 클라이언트의 상태를" />
    <meta property="og:url" content="https://huimang2.github.io/java/spring-legacy-cookie-and-session" />
    <meta property="og:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-11-08T01:00:00+09:00" />
    <meta property="article:modified_time" content="2022-11-08T01:00:00+09:00" />
    <meta property="article:tag" content="Java" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="스프링 레거시(Spring legacy) - 쿠키와 세션" />
    <meta name="twitter:description" content="이번 글에서는 로그인 기능을 구현하기에 앞서 쿠키와 세션에 대하여 알아보겠습니다. HTTP 특징 HTTP 프로토콜의 경우 서버가 클라이언트의 요청(request)을 받으면 클라이언트로 응답(response)를 보낸 후 연결을 끊어버립니다. 이러한 비연결지향적 특성으로 인하여 서버는 클라이언트의 이전 요청을 알지 못하며, 클라이언트의 상태정보를 유지하기 위해서는 요청을 보낼때마다 인증과정을 거쳐야합니다. 쿠키와 세션은 이러한 단점을 보완하여 클라이언트의 상태를" />
    <meta name="twitter:url" content="https://huimang2.github.io/" />
    <meta name="twitter:image" content="https://huimang2.github.io/assets/images/spring-legacy/logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rubisco's Programming Note" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Java" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Rubisco's Programming Note",
        "logo": "https://huimang2.github.io/"
    },
    "url": "https://huimang2.github.io/java/spring-legacy-cookie-and-session",
    "image": {
        "@type": "ImageObject",
        "url": "https://huimang2.github.io/assets/images/spring-legacy/logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://huimang2.github.io/java/spring-legacy-cookie-and-session"
    },
    "description": "이번 글에서는 로그인 기능을 구현하기에 앞서 쿠키와 세션에 대하여 알아보겠습니다. HTTP 특징 HTTP 프로토콜의 경우 서버가 클라이언트의 요청(request)을 받으면 클라이언트로 응답(response)를 보낸 후 연결을 끊어버립니다. 이러한 비연결지향적 특성으로 인하여 서버는 클라이언트의 이전 요청을 알지 못하며, 클라이언트의 상태정보를 유지하기 위해서는 요청을 보낼때마다 인증과정을 거쳐야합니다. 쿠키와 세션은 이러한 단점을 보완하여 클라이언트의 상태를"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="스프링 레거시(Spring legacy) - 쿠키와 세션" href="/feed.xml" />


    <!-- MathJax -->
    

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://huimang2.github.io/">Rubisco's Programming Note</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-java" role="menuitem"><a href="/tag/java/">JAVA</a></li>
    <li class="nav-typescript" role="menuitem"><a href="/tag/typescript/">Typescript</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/algorithm/">Algorithm</a></li>
    <li class="nav-python" role="menuitem"><a href="/archive.html">All Posts</a></li>
    <li class="nav-python" role="menuitem"><a href="/author_archive.html">Tag별 Posts</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-java tag-spring post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 8 November 2022"> 8 November 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                                
                                <a href='/tag/java/'>#JAVA</a>,&nbsp;
                                
                            
                        
                            
                                
                                <a href='/tag/spring/'>#SPRING</a>
                                
                            
                        
                    
                </section>
                <h1 class="post-full-title">스프링 레거시(Spring legacy) - 쿠키와 세션</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/images/spring-legacy/logo.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <div id="toc">
                        <ul><li><a href="#http-특징"><span>HTTP 특징</span></a></li><li><a href="#쿠키cookie"><span>쿠키(Cookie)</span></a><ul><li><a href="#쿠키의-종류"><span>쿠키의 종류</span></a></li><li><a href="#쿠키의-생성과-조회"><span>쿠키의 생성과 조회</span></a></li></ul></li><li><a href="#세션session"><span>세션(Session)</span></a><ul><li><a href="#세션-메소드"><span>세션 메소드</span></a></li><li><a href="#세션의-생성과-조회"><span>세션의 생성과 조회</span></a></li></ul></li></ul>

                    </div>
                    <p>이번 글에서는 로그인 기능을 구현하기에 앞서 쿠키와 세션에 대하여 알아보겠습니다.</p>

<h1 id="http-특징">HTTP 특징</h1>

<p>HTTP 프로토콜의 경우 서버가 클라이언트의 요청(request)을 받으면
클라이언트로 응답(response)를 보낸 후 연결을 끊어버립니다.</p>

<p>이러한 비연결지향적 특성으로 인하여 서버는 클라이언트의 이전 요청을 알지 못하며, 클라이언트의 상태정보를 유지하기 위해서는 요청을 보낼때마다 인증과정을 거쳐야합니다.</p>

<p>쿠키와 세션은 이러한 단점을 보완하여 클라이언트의 상태를 유지하기위해 사용됩니다.</p>

<h1 id="쿠키cookie">쿠키(Cookie)</h1>

<p>쿠키는 클라이언트의 로컬에 저장되는 key와 value로 이루어진 작은 데이터 파일입니다. 서버가 <code class="language-plaintext highlighter-rouge">Set-Cookie</code> 응답 헤더를 통해 클라이언트의 쿠키 저장소에 쿠키를 저장하고, 클라이언트는 해당 서버에 요청을 보낼때 쿠키 저장소에서 쿠키를 조회하여 <code class="language-plaintext highlighter-rouge">Cookie</code> 요청 헤더를 통해 서버에 쿠키 데이터를 전달합니다.</p>

<h2 id="쿠키의-종류">쿠키의 종류</h2>

<p>쿠키에는 <code class="language-plaintext highlighter-rouge">영속 쿠키</code>와 <code class="language-plaintext highlighter-rouge">세션 쿠키</code>가 있습니다.</p>

<p>영속 쿠키의 경우 만료 날짜를 입력하여 해당 날짜까지 쿠키를 유지하고, 세션 쿠키의 경우 만료 날짜를 생략하여 브라우저 종료시까지만 쿠키를 유지합니다.</p>

<h2 id="쿠키의-생성과-조회">쿠키의 생성과 조회</h2>

<p>로그인시 서버에서 닉네임 쿠키를 생성해보도록 하겠습니다.</p>

<p>우선 로그인 기능을 위해 memberMapper에 login 쿼리를 추가합니다. 이메일과 패스워드가 동일한 튜플을 가져옵니다.</p>

<h6 id="membermapperxml">memberMapper.xml</h6>
<div data-lang="XML" class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"kro.rubisco.dao.MemberDAO"</span><span class="nt">&gt;</span>

<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">"getMember"</span> <span class="na">type=</span><span class="s">"MemberDTO"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">"group"</span> <span class="na">column=</span><span class="s">"group_id"</span> <span class="na">select=</span><span class="s">"getGroup"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"create"</span><span class="nt">&gt;</span>
insert into member (password, email, name, nick_name, group_id)
values (#{password}, #{email}, #{name}, #{nickName}, #{groupId})
<span class="nt">&lt;/insert&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"read"</span> <span class="na">resultMap=</span><span class="s">"getMember"</span><span class="nt">&gt;</span>
select * from member where member_id = #{memberId}
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"getMemberByEmail"</span> <span class="na">resultMap=</span><span class="s">"getMember"</span><span class="nt">&gt;</span>
select * from member where email = #{email}
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"getGroup"</span> <span class="na">resultType=</span><span class="s">"GroupDTO"</span><span class="nt">&gt;</span>
select * from member_group where group_id=#{groupId}
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">"update"</span><span class="nt">&gt;</span>
update member 
set password=#{password},
    email=#{email}, 
    name=#{name}, 
    nick_name= #{nickName},
where member_id = #{memberId}
<span class="nt">&lt;/update&gt;</span>

<span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">"delete"</span><span class="nt">&gt;</span> delete from member where member_id = #{memberId} <span class="nt">&lt;/delete&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"listAll"</span> <span class="na">resultMap=</span><span class="s">"getMember"</span><span class="nt">&gt;</span>
<span class="cp">&lt;![CDATA[ select * from member where m.member_id &gt; 0 order by m.member_id desc ]]&gt;</span>
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"login"</span> <span class="na">resultMap=</span><span class="s">"getMember"</span><span class="nt">&gt;</span>
select * from member where email = #{email} and password = #{password}
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div></div>

<p>memberDAO에 <code class="language-plaintext highlighter-rouge">login</code> 메소드를 추가합니다.</p>

<h6 id="krorubiscodaomemberdaojava">/kro/rubisco/dao/MemberDAO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dto.LoginDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>

<span class="nd">@Mapper</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberDAO</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="nc">MemberDTO</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">Long</span> <span class="n">memberId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">getMemberByEmail</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">MemberDTO</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">Long</span> <span class="n">memberId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MemberDTO</span><span class="o">&gt;</span> <span class="nf">listAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">login</span><span class="o">(</span><span class="nc">LoginDTO</span> <span class="n">loginForm</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>서비스에 <code class="language-plaintext highlighter-rouge">login</code> 메소드를 추가하고 구현합니다.</p>

<h6 id="krorubiscoservicememberservicejava">/kro/rubisco/service/MemberService.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dto.LoginDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberService</span> <span class="o">{</span>
    
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">regist</span><span class="o">(</span><span class="nc">MemberDTO</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

      <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">Long</span> <span class="n">memberId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
      
      <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="nc">MemberDTO</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Long</span> <span class="n">memberId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

      <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MemberDTO</span><span class="o">&gt;</span> <span class="nf">listAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
      
      <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">login</span><span class="o">(</span><span class="nc">LoginDTO</span> <span class="n">loginForm</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="krorubiscoserviceimplmemberserviceimpljava">/kro/rubisco/service/impl/MemberServiceImpl.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dao.MemberDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.LoginDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.service.MemberService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberDAO</span> <span class="n">memberDAO</span><span class="o">;</span>
    
    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">MemberServiceImpl</span><span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">memberDAO</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">MemberDAO</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">regist</span><span class="o">(</span><span class="nc">MemberDTO</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">memberDAO</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">Long</span> <span class="n">memberId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberDAO</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">memberId</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberDAO</span><span class="o">.</span><span class="na">getMemberByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="nc">MemberDTO</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">memberDAO</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Long</span> <span class="n">memberId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">memberDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">memberId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MemberDTO</span><span class="o">&gt;</span> <span class="nf">listAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberDAO</span><span class="o">.</span><span class="na">listAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">MemberDTO</span> <span class="nf">login</span><span class="o">(</span><span class="nc">LoginDTO</span> <span class="n">loginForm</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberDAO</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">loginForm</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>로그인 정보를 전달하기위한 <code class="language-plaintext highlighter-rouge">LoginDTO</code>를 작성합니다.</p>

<h6 id="krorubiscodtologindtojava">/kro/rubisco/dto/LoginDTO.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotBlank</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginDTO</span> <span class="o">{</span>

    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"이메일을 입력하세요."</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
    
    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"패스워드를 입력하세요."</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>로그인 요청을 매핑하기위한 LoginController를 작성합니다.</p>

<h6 id="krorubiscocontrollerlogincontrollerjava">/kro/rubisco/controller/LoginController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.Cookie</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.LoginDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.service.MemberService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>
    
    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getLoginView</span><span class="o">()</span> <span class="o">{}</span>

    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">login</span><span class="o">(</span>
        <span class="nd">@Valid</span> <span class="nd">@ModelAttribute</span> <span class="nc">LoginDTO</span> <span class="n">loginForm</span><span class="o">,</span>
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span>
        <span class="nc">Locale</span> <span class="n">locale</span><span class="o">,</span>
        <span class="nc">HttpServletResponse</span> <span class="n">response</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        
        <span class="nc">MemberDTO</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">loginForm</span><span class="o">);</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="s">"loginFail"</span><span class="o">,</span> <span class="s">"아이디 또는 비밀번호가 일치하지 않습니다."</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"login"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Cookie</span> <span class="n">nickNameCookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNickName</span><span class="o">());</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">nickNameCookie</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>검증에 대한 설명은 지난번 글을 참고하고, 검증을 통과하면 <code class="language-plaintext highlighter-rouge">Cookie</code> 객체를 생성하여 <code class="language-plaintext highlighter-rouge">HttpServletResponse</code> 객체의 <code class="language-plaintext highlighter-rouge">addCookie</code> 메소드를 통해 응답 헤더에 <code class="language-plaintext highlighter-rouge">Set-Cookie</code>를 추가해줍니다.</p>

<p>이제 로그인폼 템플릿을 추가해주세요.</p>

<h6 id="srcmainwebappweb-infviewsloginjsp">/src/main/webapp/WEB-INF/views/login.jsp</h6>
<div data-lang="JSP" class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na"> pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ taglib </span><span class="na">uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span><span class="na"> prefix=</span><span class="s">"c"</span> <span class="nt">%&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;title&gt;</span>게시글 목록<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;main&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"flex min-h-full items-center justify-center py-12 px-4 sm:px-6 lg:px-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"w-full max-w-md space-y-8"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"mx-auto h-12 w-auto"</span> <span class="na">src=</span><span class="s">"https://tailwindui.com/img/logos/mark.svg?color=indigo&amp;shade=600"</span> <span class="na">alt=</span><span class="s">"Your Company"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900"</span><span class="nt">&gt;</span>로그인<span class="nt">&lt;/h2&gt;</span>
                  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"mt-2 text-center text-sm text-gray-600 text-rose-500"</span><span class="nt">&gt;</span>
                    ${errors.globalMessage}
                  <span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"mt-8 space-y-6"</span> <span class="na">action=</span><span class="s">"#"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"remember"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"-space-y-px rounded-md shadow-sm"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"email"</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>Email address<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">autocomplete=</span><span class="s">"email"</span> <span class="na">required</span> <span class="na">class=</span><span class="s">"relative block w-full appearance-none rounded-none rounded-t-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500 focus:z-10 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"</span> <span class="na">placeholder=</span><span class="s">"Email"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">autocomplete=</span><span class="s">"current-password"</span> <span class="na">required</span> <span class="na">class=</span><span class="s">"relative block w-full appearance-none rounded-none rounded-b-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500 focus:z-10 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"</span> <span class="na">placeholder=</span><span class="s">"Password"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
    
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"flex items-center justify-between"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"flex items-center"</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"remember-me"</span> <span class="na">name=</span><span class="s">"remember-me"</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">class=</span><span class="s">"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"remember-me"</span> <span class="na">class=</span><span class="s">"ml-2 block text-sm text-gray-900"</span><span class="nt">&gt;</span>Remember me<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
    
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-sm"</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"font-medium text-indigo-600 hover:text-indigo-500"</span><span class="nt">&gt;</span>Forgot your password?<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
    
                  <span class="nt">&lt;div&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"group relative flex w-full justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"absolute inset-y-0 left-0 flex items-center pl-3"</span><span class="nt">&gt;</span>
                            <span class="c">&lt;!-- Heroicon name: mini/lock-closed --&gt;</span>
                            <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">"h-5 w-5 text-indigo-500 group-hover:text-indigo-400"</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/2000/svg"</span> <span class="na">viewBox=</span><span class="s">"0 0 20 20"</span> <span class="na">fill=</span><span class="s">"currentColor"</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span>
                                  <span class="nt">&lt;path</span> <span class="na">fill-rule=</span><span class="s">"evenodd"</span> <span class="na">d=</span><span class="s">"M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z"</span> <span class="na">clip-rule=</span><span class="s">"evenodd"</span> <span class="nt">/&gt;</span>
                            <span class="nt">&lt;/svg&gt;</span>
                          <span class="nt">&lt;/span&gt;</span>
                          로그인
                    <span class="nt">&lt;/button&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/main&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>이제 쿠키 정보를 조회하기위해 <code class="language-plaintext highlighter-rouge">HomeController</code>를 추가해주세요. <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> 객체의 <code class="language-plaintext highlighter-rouge">getCookies</code> 메소드를 통해 쿠키를 조회할 수도 있지만, <code class="language-plaintext highlighter-rouge">@CookieValue</code> 어노테이션을 통해 간단하게 쿠키를 조회할 수 있습니다.</p>

<h6 id="krorubiscocontrollerhomecontrollerjava">/kro/rubisco/controller/HomeController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.CookieValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">home</span><span class="o">(</span><span class="nd">@CookieValue</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"nickName"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="n">nickName</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"home"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>쿠키를 조회할 템플릿을 작성합니다.</p>

<h6 id="srcmainwebappweb-infviewshomejsp">/src/main/webapp/WEB-INF/views/home.jsp</h6>
<div data-lang="JSP" class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na"> pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ taglib </span><span class="na">uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span><span class="na"> prefix=</span><span class="s">"c"</span> <span class="nt">%&gt;</span>

<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>
    Hello world!  
<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;P&gt;&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">nickName</span> <span class="n">ne</span> <span class="kc">null</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>${nickName}님, 환영합니다.<span class="nt">&lt;/c:if&gt;&lt;/P&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>localhost:8080/login 으로 이동하면 로그인폼이 출력되고, 정상적으로 로그인되면 메인페이지로 리다이렉트되어 닉네임이 출력되는 것을 확인할 수 있습니다.</p>

<p align="center"><img src="/assets/images/spring-legacy/img35.png" alt="img35" /></p>

<p>이 경우 만료 날짜를 입력하지 않았으므로 세션 쿠키가 되므로, 브라우저를 닫았다가 다시 열게 되면 쿠기가 존재하지 않습니다. 영속 쿠키로 만들기 위해서는 쿠키에 <code class="language-plaintext highlighter-rouge">setMaxAge</code> 메소드를 통해 만료 날짜를 입력해줍니다. 매개변수는 초단위를 기준으로 입력합니다. 예를 들어 아래 코드의 경우 일주일간 쿠키를 유지합니다.</p>

<h6 id="krorubiscocontrollerlogincontrollerjava-1">/kro/rubisco/controller/LoginController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.Cookie</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.LoginDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.service.MemberService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>
    
    <span class="nd">@GetMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getLoginView</span><span class="o">()</span> <span class="o">{}</span>

    <span class="nd">@PostMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">login</span><span class="o">(</span>
        <span class="nd">@Valid</span> <span class="nd">@ModelAttribute</span> <span class="nc">LoginDTO</span> <span class="n">loginForm</span><span class="o">,</span>
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span>
        <span class="nc">Locale</span> <span class="n">locale</span><span class="o">,</span>
        <span class="nc">HttpServletResponse</span> <span class="n">response</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        
        <span class="nc">MemberDTO</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">loginForm</span><span class="o">);</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="s">"loginFail"</span><span class="o">,</span> <span class="s">"아이디 또는 비밀번호가 일치하지 않습니다."</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"login"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Cookie</span> <span class="n">nickNameCookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNickName</span><span class="o">());</span>
            <span class="n">nickNameCookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">7</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">nickNameCookie</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>브라우저를 껏다가 다시 켜도 쿠키가 유지됨을 확인할 수 있습니다. 쿠키를 삭제하려면 만료 날짜를 0으로 설정하여 응답 헤더에 추가하게 되면 쿠키를 바로 만료시켜 삭제할 수 있게 됩니다.</p>

<p>우선 LoginController에 <code class="language-plaintext highlighter-rouge">logout</code> 메소드를 추가합니다.</p>

<h6 id="krorubiscocontrollerlogincontrollerjava-2">/kro/rubisco/controller/LoginController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.Cookie</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.LoginDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.service.MemberService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>
    
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getLoginView</span><span class="o">()</span> <span class="o">{}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">login</span><span class="o">(</span>
        <span class="nd">@Valid</span> <span class="nd">@ModelAttribute</span> <span class="nc">LoginDTO</span> <span class="n">loginForm</span><span class="o">,</span>
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span>
        <span class="nc">Locale</span> <span class="n">locale</span><span class="o">,</span>
        <span class="nc">HttpServletResponse</span> <span class="n">response</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        
        <span class="nc">MemberDTO</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">loginForm</span><span class="o">);</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="s">"loginFail"</span><span class="o">,</span> <span class="s">"아이디 또는 비밀번호가 일치하지 않습니다."</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"login"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Cookie</span> <span class="n">nickNameCookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNickName</span><span class="o">());</span>
            <span class="n">nickNameCookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">7</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">nickNameCookie</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">logout</span><span class="o">(</span><span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Cookie</span> <span class="n">nickNameCookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">nickNameCookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">nickNameCookie</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>메인 템플릿도 다음과 같이 수정합니다.</p>

<h6 id="srcmainwebappweb-infviewshomejsp-1">/src/main/webapp/WEB-INF/views/home.jsp</h6>
<div data-lang="JSP" class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na"> pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ taglib </span><span class="na">uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span><span class="na"> prefix=</span><span class="s">"c"</span> <span class="nt">%&gt;</span>

<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>
    Hello world!  
<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">nickName</span> <span class="n">ne</span> <span class="kc">null</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;P&gt;</span>${nickName}님, 환영합니다.<span class="nt">&lt;/P&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/logout"</span><span class="nt">&gt;</span>로그아웃<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>로그아웃 링크를 클릭하면 쿠키가 삭제되어 닉네임이 출력되지 않는 것을 확인할 수 있습니다.</p>

<h1 id="세션session">세션(Session)</h1>

<p>쿠키의 경우 클라이언트에서 값을 임의로 변경할 수 있고, 쿠키에 보관된 정보를 타인이 훔쳐갈 수 있기때문에 보안상 문제가 있습니다. 이런 문제점을 해결하기 위해서는 정보를 클라이언트가 아니라 서버에서 관리하고 외부로 노출되지 않도록 해야합니다.</p>

<p>세션은 서버가 임의의 토큰값을 쿠키에 저장하고 해당 토큰값을 매핑하여 클라이언트의 상태를 유지할 수 있습니다.</p>

<p>즉, 세션을 사용하면 클라이언트에서 정보를 저장하지 않고 쿠키를 통해 추정 불가능한 세션 아이디를 주고 받기 때문에 보안상 안전해집니다.</p>

<p>세션을 관리하기 위한 매니저 객체를 만들어야 하지만, 스프링에서는 세션을 관리하는 <code class="language-plaintext highlighter-rouge">HttpSession</code> 객체를 제공합니다. <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> 객체의 <code class="language-plaintext highlighter-rouge">getSession</code> 메소드를 통해 세션을 가져올 수 있습니다.</p>

<h2 id="세션-메소드">세션 메소드</h2>

<p>스프링에서 제공하는 세션 객체의 메소드는 다음과 같습니다.</p>

<table>
  <thead>
    <tr>
      <th>리턴타입</th>
      <th>메소드</th>
      <th>기능</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>long</td>
      <td>getCreationTime()</td>
      <td>세션이 지속된 시간을 ms 단위로 반환</td>
    </tr>
    <tr>
      <td>int</td>
      <td>getMaxInactiveInterval()</td>
      <td>세션의 유지시간을 초단위로 반환</td>
    </tr>
    <tr>
      <td>String</td>
      <td>getId()</td>
      <td>세션의 식별자 ID를 반환</td>
    </tr>
    <tr>
      <td>void</td>
      <td>setAttribute(String name, Object value)</td>
      <td>세션에 객체 저장</td>
    </tr>
    <tr>
      <td>Object</td>
      <td>getAttribute(String name)</td>
      <td>키값에 해당하는 객체 반환</td>
    </tr>
    <tr>
      <td>void</td>
      <td>removeAttribute(String name)</td>
      <td>키값에 해당하는 객체 삭제</td>
    </tr>
    <tr>
      <td>void</td>
      <td>setMaxInteractiveInterval()</td>
      <td>세션의 유지시간 설정</td>
    </tr>
    <tr>
      <td>boolean</td>
      <td>isNew()</td>
      <td>새로 생성된 세션인지 확인</td>
    </tr>
    <tr>
      <td>void</td>
      <td>invalidate()</td>
      <td>세션 제거</td>
    </tr>
  </tbody>
</table>

<h2 id="세션의-생성과-조회">세션의 생성과 조회</h2>

<p><code class="language-plaintext highlighter-rouge">LoginController</code>의 <code class="language-plaintext highlighter-rouge">login</code> 메소드를 수정하겠습니다.</p>

<h6 id="krorubiscocontrollerlogincontrollerjava-3">/kro/rubisco/controller/LoginController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.config.BindExceptionWithViewName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.LoginDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kro.rubisco.service.MemberService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>
    
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getLoginView</span><span class="o">()</span> <span class="o">{}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">login</span><span class="o">(</span>
        <span class="nd">@Valid</span> <span class="nd">@ModelAttribute</span> <span class="nc">LoginDTO</span> <span class="n">loginForm</span><span class="o">,</span>
        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span>
        <span class="nc">Locale</span> <span class="n">locale</span><span class="o">,</span>
        <span class="nc">HttpServletRequest</span> <span class="n">request</span>
    <span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        
        <span class="nc">MemberDTO</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">loginForm</span><span class="o">);</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bindingResult</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="s">"loginFail"</span><span class="o">,</span> <span class="s">"아이디 또는 비밀번호가 일치하지 않습니다."</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindExceptionWithViewName</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">,</span> <span class="s">"login"</span><span class="o">,</span> <span class="n">messageSource</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"member"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">logout</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">invalidate</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>로그인에 성공하면 세션을 가져오고, 해당 세션에 member 정보를 저장합니다.</p>

<p><code class="language-plaintext highlighter-rouge">HttpServletRequest</code> 객체의 <code class="language-plaintext highlighter-rouge">getSession</code> 메소드에 매개변수로 <code class="language-plaintext highlighter-rouge">false</code>를 준다면 세션이 있는 경우 세션을 반환, 세션이 없는 경우 null을 반환합니다. 기본값은 <code class="language-plaintext highlighter-rouge">true</code>로 세션이 없으면 새로운 세션을 생성하여 반환합니다.</p>

<p>로그아웃시 세션의 <code class="language-plaintext highlighter-rouge">invalidate</code> 메소드를 통해 세션의 연결을 끊어주면 됩니다.</p>

<p>세션이 저장되었는지 확인하기 위해 <code class="language-plaintext highlighter-rouge">HomeController</code>를 수정합니다. 세션에 저장된 데이터는 세션의 <code class="language-plaintext highlighter-rouge">getAttribute</code> 메소드를 통해 가져올 수 있습니다.</p>

<h6 id="krorubiscocontrollerhomecontrollerjava-1">/kro/rubisco/controller/HomeController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">()</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">home</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        
        <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        
        <span class="k">if</span><span class="o">(</span><span class="n">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">MemberDTO</span> <span class="n">member</span> <span class="o">=(</span><span class="nc">MemberDTO</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"member"</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNickName</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"home"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">@SessionAttribute</code> 어노테이션을 통해서도 간단하게 세션 데이터를 가져올 수 있습니다.</p>

<h6 id="krorubiscocontrollerhomecontrollerjava-2">/kro/rubisco/controller/HomeController.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">kro.rubisco.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.SessionAttribute</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kro.rubisco.dto.MemberDTO</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>

	<span class="nd">@RequestMapping</span><span class="o">()</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">home</span><span class="o">(</span>
	    <span class="nd">@SessionAttribute</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"member"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="nc">MemberDTO</span> <span class="n">member</span><span class="o">,</span> 
	    <span class="nc">Model</span> <span class="n">model</span>
	<span class="o">)</span> <span class="o">{</span>
	    <span class="k">if</span><span class="o">(</span><span class="n">member</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
	        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNickName</span><span class="o">());</span>
	    <span class="o">}</span>

		<span class="k">return</span> <span class="s">"home"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Rubisco's Programming Note</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- utterances -->
            <div id="comment">
                <script src="https://utteranc.es/client.js"
                repo="huimang2/huimang2.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async></script>
            </div>
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/M31_starspike.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Rubisco's Programming Note &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/java/">Java</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/maven-project">이클립스 메이븐 프로젝트</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-security">스프링 레거시(Spring legacy) - 시큐리티 적용</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring-legacy-filter-and-interceptor">스프링 레거시(Spring legacy) - 필터와 인터셉터</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/java/">
                                
                                    See all 18 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/programmers/programmers-133499">
                <div class="post-card-image" style="background-image: url(/assets/images/programmers-logo.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/programmers/programmers-133499">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">[1단계][133499] 옹알이(2)</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>문제

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/java/spring-legacy-sign-up">
                <div class="post-card-image" style="background-image: url(/assets/images/spring-legacy/logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/java/spring-legacy-sign-up">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">스프링 레거시(Spring legacy) - 회원가입</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>이번 글에서는 bean validation을 통해 회원가입을 구현하겠습니다.

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      4 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://huimang2.github.io/">
            
            <span>Rubisco's Programming Note</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">스프링 레거시(Spring legacy) - 쿠키와 세션</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%EC%8A%A4%ED%94%84%EB%A7%81+%EB%A0%88%EA%B1%B0%EC%8B%9C%28Spring+legacy%29+-+%EC%BF%A0%ED%82%A4%EC%99%80+%EC%84%B8%EC%85%98&amp;url=java/spring-legacy-cookie-and-session"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=java/spring-legacy-cookie-and-session"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://huimang2.github.io/">Rubisco's Programming Note</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search Rubisco's Programming Note</h1>
            <p class="subscribe-overlay-description">
            lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>


    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    /* toc ---------------------------------------------------------------------*/

    var tocTitle = document.getElementsByClassName("post-full-title")[0];
    var tocTitleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var tocArticle = document.getElementsByClassName("post-full-content")[0];
    var tocArticleY = window.pageYOffset + tocArticle.getBoundingClientRect().top;
  
    var toc = document.getElementById("toc");
    var tocHeaderNodes = getHeaderNodes(tocArticle);
    var tocNodes = getTOCNodes(toc);
  
    var tocBefore = undefined;

    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3" && !elem.classList.contains('no-toc');
        });
        return headerNodes;
    }

    tocNodes.forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    document.querySelector('.post-full-content').querySelectorAll('p a[href^="#"]').forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    /*--------------------------------------------------------------------------*/

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 30;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
            toc.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
            toc.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;

        // toc
        var tocCurrent = tocHeaderNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 90;
        });
  
        if (tocCurrent.length > 0) {
            tocCurrent = tocCurrent[tocCurrent.length-1];
  
            var tocCurrentA = tocNodes.filter(function(tocNode) {
                return tocNode.getElementsByTagName("span")[0].innerHTML == tocCurrent.innerHTML;
            })
            
            tocCurrentA = tocCurrentA[0];

            if (tocCurrentA) {
                if (tocBefore == undefined) tocBefore = tocCurrentA;
    
                if (tocBefore != tocCurrentA) {
                    tocBefore.classList.remove("toc-active");
                    tocBefore = tocCurrentA;
                }
    
                tocCurrentA.classList.add("toc-active");
            }
            else {
                if (tocBefore) 
                    tocBefore.classList.remove("toc-active");
            }
        }
        else {
            if (tocBefore) 
                tocBefore.classList.remove("toc-active");
        }
        
        if(toc && tocArticle.getBoundingClientRect().bottom <= 0) {
            toc.classList.add('toc-hidden');
        } else {
            toc.classList.remove('toc-hidden');
        }
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
