<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>JPA(Java Persistence API)</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- 웹 폰트 설정 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
    

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- syntax.css -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="프로그래밍 노트" />
    <link rel="shortcut icon" href="https://huimang2.github.io/assets/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://huimang2.github.io/java/jpa" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Rubisco's Programming Note" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="JPA(Java Persistence API)" />
    <meta property="og:description" content="JPA란? JPA(Java Persistence API)는 자바 진영의 ORM 기술 표준으로, ORM 프레임워크를 쉽게 사용하기 위한 인터페이스의 모음입니다. 데이터베이스 연동에 사용되는 기술은 JDBC에서부터 Spring DAO, MyBatis, Hibernate 등 다양합니다. 이 중에서 Hibernate 같은 ORM 프레임워크는 SQL까지 프레임워크에서 제공하여 개발자들이 처리해야 할 업무가 상당히 감소했습니다. 이전에는 데이터베이스에 연동하기 위해 SQL Query를 직접 작성하여" />
    <meta property="og:url" content="https://huimang2.github.io/java/jpa" />
    <meta property="og:image" content="https://huimang2.github.io/assets/images/jpa/jpa-img-02.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-08-04T07:00:00+09:00" />
    <meta property="article:modified_time" content="2022-08-04T07:00:00+09:00" />
    <meta property="article:tag" content="Java" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="JPA(Java Persistence API)" />
    <meta name="twitter:description" content="JPA란? JPA(Java Persistence API)는 자바 진영의 ORM 기술 표준으로, ORM 프레임워크를 쉽게 사용하기 위한 인터페이스의 모음입니다. 데이터베이스 연동에 사용되는 기술은 JDBC에서부터 Spring DAO, MyBatis, Hibernate 등 다양합니다. 이 중에서 Hibernate 같은 ORM 프레임워크는 SQL까지 프레임워크에서 제공하여 개발자들이 처리해야 할 업무가 상당히 감소했습니다. 이전에는 데이터베이스에 연동하기 위해 SQL Query를 직접 작성하여" />
    <meta name="twitter:url" content="https://huimang2.github.io/" />
    <meta name="twitter:image" content="https://huimang2.github.io/assets/images/jpa/jpa-img-02.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rubisco's Programming Note" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Java" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Rubisco's Programming Note",
        "logo": "https://huimang2.github.io/"
    },
    "url": "https://huimang2.github.io/java/jpa",
    "image": {
        "@type": "ImageObject",
        "url": "https://huimang2.github.io/assets/images/jpa/jpa-img-02.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://huimang2.github.io/java/jpa"
    },
    "description": "JPA란? JPA(Java Persistence API)는 자바 진영의 ORM 기술 표준으로, ORM 프레임워크를 쉽게 사용하기 위한 인터페이스의 모음입니다. 데이터베이스 연동에 사용되는 기술은 JDBC에서부터 Spring DAO, MyBatis, Hibernate 등 다양합니다. 이 중에서 Hibernate 같은 ORM 프레임워크는 SQL까지 프레임워크에서 제공하여 개발자들이 처리해야 할 업무가 상당히 감소했습니다. 이전에는 데이터베이스에 연동하기 위해 SQL Query를 직접 작성하여"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="JPA(Java Persistence API)" href="/feed.xml" />


    <!-- MathJax -->
    

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://huimang2.github.io/">Rubisco's Programming Note</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-java" role="menuitem"><a href="/tag/java/">JAVA</a></li>
    <li class="nav-typescript" role="menuitem"><a href="/tag/typescript/">Typescript</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/algorithm/">Algorithm</a></li>
    <li class="nav-python" role="menuitem"><a href="/archive.html">All Posts</a></li>
    <li class="nav-python" role="menuitem"><a href="/author_archive.html">Tag별 Posts</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-java tag-spring tag-jpa post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 4 August 2022"> 4 August 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                                
                                <a href='/tag/java/'>#JAVA</a>,&nbsp;
                                
                            
                        
                            
                                
                                <a href='/tag/spring/'>#SPRING</a>,&nbsp;
                                
                            
                        
                            
                                
                                <a href='/tag/jpa/'>#JPA</a>
                                
                            
                        
                    
                </section>
                <h1 class="post-full-title">JPA(Java Persistence API)</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/images/jpa/jpa-img-02.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <div id="toc">
                        <ul><li><a href="#jpa란"><span>JPA란?</span></a><ul><li><a href="#예제-파일"><span>예제 파일</span></a></li></ul></li><li><a href="#jpa-관련-용어"><span>JPA 관련 용어</span></a><ul><li><a href="#객체-관계-매핑object-relational-mapping-orm"><span>객체-관계 매핑(Object Relational Mapping, ORM)</span></a></li><li><a href="#hibernate"><span>Hibernate</span></a></li><li><a href="#5-레이어-아키텍처5-layer-architecture"><span>5 레이어 아키텍처(5 Layer Architecture)</span></a></li></ul></li><li><a href="#jpa-설정"><span>JPA 설정</span></a><ul><li><a href="#의존성dependency-설정"><span>의존성(dependency) 설정</span></a></li><li><a href="#영속성-컨텍스트persistence-context-설정"><span>영속성 컨텍스트(Persistence Context) 설정</span></a></li><li><a href="#entity-매핑-설정"><span>Entity 매핑 설정</span></a></li></ul></li><li><a href="#jpa-이해"><span>JPA 이해</span></a><ul><li><a href="#영속성-컨텍스트persistence-context"><span>영속성 컨텍스트(Persistence Context)</span></a></li><li><a href="#entity-생명주기lifecycle"><span>Entity 생명주기(Lifecycle)</span></a></li><li><a href="#jpqljava-persistence-query-language"><span>JPQL(Java Persistence Query Language)</span></a></li></ul></li><li><a href="#spring-data-jpa"><span>Spring Data JPA</span></a><ul><li><a href="#repository-인터페이스-작성"><span>Repository 인터페이스 작성</span></a></li><li><a href="#crud-기능-테스트"><span>CRUD 기능 테스트</span></a></li></ul></li></ul>

                    </div>
                    <h1 id="jpa란">JPA란?</h1>

<p><code class="language-plaintext highlighter-rouge">JPA(Java Persistence API)</code>는 자바 진영의 ORM 기술 표준으로, ORM 프레임워크를 쉽게 사용하기 위한 <code class="language-plaintext highlighter-rouge">인터페이스의 모음</code>입니다.</p>

<p>데이터베이스 연동에 사용되는 기술은 JDBC에서부터 Spring DAO, MyBatis, Hibernate 등 다양합니다. 이 중에서 <code class="language-plaintext highlighter-rouge">Hibernate</code> 같은 ORM 프레임워크는 SQL까지 프레임워크에서 제공하여 개발자들이 처리해야 할 업무가 상당히 감소했습니다.</p>

<p>이전에는 데이터베이스에 연동하기 위해 <code class="language-plaintext bgcolor orange highlighter-rouge" style="color:orangered">SQL Query를 직접 작성</code>하여 영속 데이터를 가져왔습니다. 이 경우 여러 문제점이 있는데 데이터베이스의 테이블이 변경되더라도 SQL Query는 String 형식으로 되어있어서 컴파일 에러가 나오지 않습니다. 또한 Query문을 잘못 작성하더라도 컴파일시 확인할 수 없어서 런타임에서 에러를 발생시킵니다. 이러한 이유로 개발자들은 순수 객체지향 프로그래밍에 집중하지 못하고 Query문 작성에 많은 비용을 지불해야만 했습니다.</p>

<p>하지만 Hibernate의 등장으로 이런 문제들이 해소되어 이후 많은 ORM 프레임워크가 등장했으며, 이런 ORM을 보다 쉽게 사용할 수 있도록 표준화 시킨 것이 JPA(Java Persistence API) 입니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-02.png" alt="img02" /></p>

<p>JPA는 애플리케이션과 JDBC 사이에서 동작합니다. 기존 마이바티스 같은 프레임워크는 SQL을 개발자가 직접 XML 파일에 등록하여 사용했지만, JPA를 사용하면 JPA 내부에서 JDBC API를 통해 SQL을 호출하여 DB와 통신하게 됩니다. 즉, 개발자가 직접 JDBC API를 사용하지 않습니다.</p>

<p>JPA의 장점은 CRUD SQL을 작성할 필요가 없고 조회된 결과를 객체로 매핑하는 작업을 자동으로 처리하기 때문에 데이터 저장 계층에서 작성해야할 코드가 대폭적으로 줄어듭니다. 또한 SQL이 아닌 객체 중심으로 개발하여 생산성과 유지보수가 좋아집니다.</p>

<p>그러나 배우기가 어렵고 잘 이해하지 않으면 데이터 손실이 있을 수 있으며, 복잡한 작업에 대해서는 성능상 문제가 있을 수 있습니다.</p>

<h2 id="예제-파일">예제 파일</h2>

<p><a href="/file/jpa_board.zip" target="_blank">JPA 예제 파일</a></p>

<h1 id="jpa-관련-용어">JPA 관련 용어</h1>

<h2 id="객체-관계-매핑object-relational-mapping-orm">객체-관계 매핑(Object Relational Mapping, ORM)</h2>

<p>ORM이란 객체와 관계형 데이터베이스의 데이터를 자동으로 매핑해주는 기술을 말합니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-01.png" alt="img01" /></p>

<p>기본적으로 객체 지향 프로그래밍은 클래스를 사용하고, 관계형 데이터베이스는 테이블을 사용하기 때문에 객체 모델과 관계형 모델 간에 불일치가 존재합니다. ORM은 객체 간의 관계를 바탕으로 SQL을 자동으로 생성함으로써 이런 패러다임의 불일치 문제를 해결해줍니다.</p>

<h2 id="hibernate">Hibernate</h2>

<p align="center"><img src="/assets/images/jpa/jpa-img-06.png" alt="img06" /></p>

<p>JPA가 제공하는 인터페이스를 이용하여 데이터베이스를 처리하면 실제로는 Hibernate 같은 구현체(Implimentations)가 동작합니다. 그렇기 때문에 Hibernate를 통해 개발하더라도 실제 서비스에서는 다른 ORM 기술인 EclipseLink로 변경하더라도 동일한 서비스를 제공할 수 있습니다.</p>

<h2 id="5-레이어-아키텍처5-layer-architecture">5 레이어 아키텍처(5 Layer Architecture)</h2>

<p>스프링 프레임워크는 MVC 패턴을 좀더 세분화 하여 <code class="language-plaintext highlighter-rouge">5 레이어 아키텍처(5 Layer Architecture)</code>로 나타낼 수 있습니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-04.png" alt="img04" /></p>

<p><code class="language-plaintext highlighter-rouge">모델(Model)</code>은 <code class="language-plaintext highlighter-rouge">비즈니스 로직 계층(Business Logic Layer)</code>과 <code class="language-plaintext highlighter-rouge">영구 계층(Persistence Layer)</code>, <code class="language-plaintext highlighter-rouge">도메인 모델 계층(Domain Model Layer)</code>에 해당합니다.</p>

<p>여기에서 <code class="language-plaintext highlighter-rouge">비즈니스 로직 계층(Business Logic Layer)</code>은 주로 상태 변화를 처리하는 역할을 하며, 컨트롤러와 JPA를 연결해주는 <code class="language-plaintext highlighter-rouge">서비스(Service)</code>와 객체를 연관 테이블과 매핑해주는 <code class="language-plaintext highlighter-rouge">도메인(Domain)</code>으로 나눌 수 있습니다.</p>

<p>기존에는 비즈니스 로직과 ORM 기능을 모두 이 계층에서 수행했지만 이를 분리하여 비즈니스 로직은 서비스에서, ORM 기능은 도메인에서 수행합니다.</p>

<p>5 레이어 아키텍처는 <code class="language-plaintext highlighter-rouge">도메인 주도 설계(Domain Driven Design, DDD)</code>와 관련있는데, 아직 이에 대한 이해도가 부족하여 생략하겠습니다.</p>

<p>아래에는 비즈니스 로직 계층과 관련된 객체들에 대한 설명입니다.</p>

<h3 class="no-toc">DAO(Data Access Object)</h3>

<p><code class="language-plaintext highlighter-rouge">DAO(Data Access Object)</code>는 DB에 접근하여 CRUD를 할 수 있는 객체입니다. 서비스와 DB를 연결해주며, 구현체에 CRUD 기능을 구현하고 이를 의존성 주입(DI)해주는 방식으로 사용됩니다. 스프링에서는 <code class="language-plaintext highlighter-rouge">Repository</code>가 DAO 역할을 하는데, DB 접근 방식에 약간의 차이가 있다고 합니다.</p>

<h3 class="no-toc">DTO(Data Transfer Object)</h3>

<p><code class="language-plaintext highlighter-rouge">DTO(Data Transfer Object)</code>는 계층 간 데이터 교환을 하기 위해 사용하는 객체입니다. 로직을 가지지 않는 순수한 데이터 객체로서, getter나 setter 정도의 메소드를 가질 수 있습니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-05.png" alt="img05" /></p>

<p>이와 비슷한 <code class="language-plaintext highlighter-rouge">VO(value Object)</code> 객체는 오직 읽기만 가능한 read-Only 특징을 가지며, getter 메소드만 가지고 있습니다.</p>

<h6 id="boardjava">Board.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">seq</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">writer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">cnt</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 class="no-toc">Domain(=Entity)</h3>

<p>도메인은 DB 테이블과 매핑되는 객체입니다. 변경사항이 생기면 여러 다른 클래스에 영향을 주기때문에 변경사항이 많은 DTO와 분리하여 사용됩니다.</p>

<p>도메인의 생성에는 @Entity, @Column, @Id 등과 같은 어노테이션(annotation)이 사용됩니다.</p>

<h6 id="boardjava-1">Board.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">seq</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">writer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">DATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">cnt</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="jpa-설정">JPA 설정</h1>

<p>Hibernate를 사용하여 JPA를 구현해보도록 하겠습니다. 빌드는 gradle을 사용하며, Oracle DB에 연결하겠습니다.</p>

<h2 id="의존성dependency-설정">의존성(dependency) 설정</h2>

<p>gradle에 의존성 패키지로 <code class="language-plaintext highlighter-rouge">hibernate-entitymanager</code>를 추가합니다.</p>

<div data-lang="GRADLE" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>implementation <span class="s1">'org.hibernate:hibernate-entitymanager'</span>
</code></pre></div></div>

<p>Entity 작성을 편하게 하기 위해 Lombok 패키지도 의존성에 추가하고, 암호키로 오라클DB에 접근하기 위해 ojdbc와 security 패키지도 추가합니다.</p>

<div data-lang="GRADLE" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>compileOnly <span class="s1">'org.projectlombok:lombok'</span>
annotationProcessor <span class="s1">'org.projectlombok:lombok'</span>

runtimeOnly <span class="s1">'com.oracle.database.jdbc:ojdbc8'</span>
implementation <span class="s1">'com.oracle.database.security:oraclepki'</span>
implementation <span class="s1">'com.oracle.database.security:osdt_core'</span>
implementation <span class="s1">'com.oracle.database.security:osdt_cert'</span>
</code></pre></div></div>

<p>전체 코드입니다.</p>

<h6 id="buildgradle">build.gradle</h6>
<div data-lang="GRADLE" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plugins <span class="o">{</span>
	<span class="nb">id</span> <span class="s1">'org.springframework.boot'</span> version <span class="s1">'2.7.2'</span>
	<span class="nb">id</span> <span class="s1">'io.spring.dependency-management'</span> version <span class="s1">'1.0.12.RELEASE'</span>
	<span class="nb">id</span> <span class="s1">'java'</span>
<span class="o">}</span>

group <span class="o">=</span> <span class="s1">'com.example'</span>
version <span class="o">=</span> <span class="s1">'0.0.1-SNAPSHOT'</span>
sourceCompatibility <span class="o">=</span> <span class="s1">'17'</span>

configurations <span class="o">{</span>
	compileOnly <span class="o">{</span>
		extendsFrom annotationProcessor
	<span class="o">}</span>
<span class="o">}</span>

repositories <span class="o">{</span>
	mavenCentral<span class="o">()</span>
<span class="o">}</span>

dependencies <span class="o">{</span>

	implementation <span class="s1">'org.springframework.boot:spring-boot-starter'</span>
	testImplementation <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>

	compileOnly <span class="s1">'org.projectlombok:lombok'</span>
	annotationProcessor <span class="s1">'org.projectlombok:lombok'</span>

	implementation <span class="s1">'org.hibernate:hibernate-entitymanager'</span>

	runtimeOnly <span class="s1">'com.oracle.database.jdbc:ojdbc8'</span>
	implementation <span class="s1">'com.oracle.database.security:oraclepki'</span>
	implementation <span class="s1">'com.oracle.database.security:osdt_core'</span>
	implementation <span class="s1">'com.oracle.database.security:osdt_cert'</span>
<span class="o">}</span>

tasks.named<span class="o">(</span><span class="s1">'test'</span><span class="o">)</span> <span class="o">{</span>
	useJUnitPlatform<span class="o">()</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="영속성-컨텍스트persistence-context-설정">영속성 컨텍스트(Persistence Context) 설정</h2>

<p><code class="language-plaintext highlighter-rouge">영속성(Persistence)</code>이란 데이터를 생성한 프로그램이 종료되더라도 사라지지 않는 데이터의 특성을 말합니다. 영속성이 없는 데이터는 메모리에서만 존재하기 때문에 프로그램을 종료하면 사라져 버립니다. 데이터가 영속성을 가지기 위해서는 파일 시스템이나 데이터베이스 등을 통해 영속성을 부여해야만 합니다.</p>

<p>JPA는 영속성이 없는 데이터에 영속성을 부여하는 역할을 하며, 이렇게 영속성이 부여되는 환경을 <code class="language-plaintext highlighter-rouge">영속성 컨텍스트(Persistence Context)</code>라고 합니다. 프로그램이 종료되기 전까지 Entity가 영구적으로 저장되는 환경입니다.</p>

<p>영속성 컨텍스트는 기본적으로는 <code class="language-plaintext highlighter-rouge">persistence.xml</code> 파일을 통해 설정됩니다.</p>

<h6 id="resourcesmeta-infpersistencexml">/resources/META-INF/persistence.xml</h6>
<div data-lang="XML" class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="nt">&lt;persistence</span> <span class="na">xmlns=</span><span class="s">"http://xmlns.jcp.org/xml/ns/persistence"</span> <span class="na">version=</span><span class="s">"2.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;persistence-unit</span> <span class="na">name=</span><span class="s">"practice"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;class&gt;</span>com.example.demo.Board<span class="nt">&lt;/class&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.driver"</span> <span class="na">value=</span><span class="s">"oracle.jdbc.OracleDriver"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.user"</span> <span class="na">value=</span><span class="s">"아이디"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.password"</span> <span class="na">value=</span><span class="s">"암호"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.url"</span> <span class="na">value=</span><span class="s">"주소"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.dialect"</span> <span class="na">value=</span><span class="s">"org.hibernate.dialect.Oracle12cDialect"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.show_sql"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.format_sql"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.use_sql_comments"</span> <span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.id.new_generator_mappings"</span> <span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.hbm2ddl.auto"</span> <span class="na">value=</span><span class="s">"create"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/persistence-unit&gt;</span>
<span class="nt">&lt;/persistence&gt;</span>
</code></pre></div></div>

<h3 class="no-toc">영속성 유닛(persistence-unit) 설정</h3>

<p>persistence.xml 파일의 루트는 <code class="language-plaintext highlighter-rouge">&lt;persistence&gt;</code>이며, 영속성 유닛인 <code class="language-plaintext highlighter-rouge">&lt;persistence-unit&gt;</code>을 엘리먼트로 가집니다.</p>

<p>영속성 유닛은 데이터베이스당 하나씩 설정할 수 있습니다. 즉, 데이터베이스가 하나 이상이면 영속성 유닛 또한 여러 개 이므로 이를 구분하기 위해 유일한 이름(name)을 지정해야 합니다. 위의 코드에서는 <code class="language-plaintext highlighter-rouge">practice</code>라는 이름으로 영속성 유닛을 하나 생성합니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-07.png" alt="img07" /></p>

<p>영속성 유닛은 <code class="language-plaintext highlighter-rouge">EntityManagerFactory</code>를 생성할 수 있습니다. JPA를 사용하려면 <code class="language-plaintext highlighter-rouge">EntityManager</code> 객체가 필요한데, EntityManager는 EntityManagerFactory로부터 생성됩니다. 생성 비용이 크기때문에 싱글톤으로 만들어 사용하며, Thread-safe 입니다.</p>

<p><code class="language-plaintext highlighter-rouge">EntityManager</code>는 CRUD를 처리합니다. Thread-unsafe 이기 때문에 Thread 환경에서는 주의해야 합니다. 각각 영속성 컨텍스트를 가지고 있으며, 데이터를 변경하려면 <code class="language-plaintext highlighter-rouge">트랜잭션(transaction)</code>이 이루어져야 합니다.</p>

<h6 id="entitymanager-생성">EntityManager 생성</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"practice"</span><span class="o">);</span>
<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
</code></pre></div></div>

<h3 class="no-toc">Entity 클래스 등록</h3>

<p>Entity 클래스 목록은 영속성 유닛 설정에서 가장 먼저 등록되는 정보입니다. 순수 JPA만 사용한다면 Entity 클래스를 영속성 유닛에 명시적으로 등록해야만 합니다. Entity 작성은 아래 <a href="#entity-매핑-설정"><code class="language-plaintext bgcolor blue highlighter-rouge" style="color:royalblue">Entity 매핑 설정</code></a>항목을 참조하세요.</p>

<h3 class="no-toc">프로퍼티(property) 설정</h3>

<p>이제 각종 프로퍼티를 설정해줍니다.</p>

<p>우선 <code class="language-plaintext highlighter-rouge">데이터소스(Datasource)</code>를 설정합니다. JPA 구현체는 데이터소스를 참조하여 특정 데이터베이스와 연결할 수 있습니다. 데이터소스의 설정은 프로퍼티 이름만으로 어느정도 의미를 알 수 있습니다.</p>

<h6 id="데이터-소스datasource-프로퍼티">데이터 소스(Datasource) 프로퍼티</h6>

<table>
  <thead>
    <tr>
      <th>프로퍼티</th>
      <th>의미</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>javax.persistence.jdbc.driver</td>
      <td>JDBC 드라이버</td>
    </tr>
    <tr>
      <td>javax.persistence.jdbc.user</td>
      <td>DB 아이디</td>
    </tr>
    <tr>
      <td>javax.persistence.jdbc.password</td>
      <td>DB 암호</td>
    </tr>
    <tr>
      <td>javax.persistence.jdbc.url</td>
      <td>DB 주소</td>
    </tr>
  </tbody>
</table>

<hr />

<p>다음으로 <code class="language-plaintext highlighter-rouge">Dialect</code>를 설정합니다. Dialect는 번역하면 <code class="language-plaintext highlighter-rouge">방언</code> 입니다. JPA의 큰 장점 중 하나가 SQL을 자동으로 생성한다는 점인데 데이터베이스마다 SQL이 조금씩 차이가 있습니다. 그러므로 Dialect를 설정하여 특정 데이터베이스에 최적화된 SQL이 생성되도록 합니다.</p>

<p><code class="language-plaintext highlighter-rouge">hibernate-core</code> 패키지에는 대부분의 데이터베이스에 해당하는 Dialect가 포함되어 있습니다.</p>

<table>
  <thead>
    <tr>
      <th>데이터베이스</th>
      <th>Dialect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DB2</td>
      <td>org.hibernate.dialect.DB2Dialect</td>
    </tr>
    <tr>
      <td>PostgreSQL</td>
      <td>org.hibernate.dialect.PostgreDialect</td>
    </tr>
    <tr>
      <td>MySQL</td>
      <td>org.hibernate.dialect.MySQLDialect</td>
    </tr>
    <tr>
      <td>Oracle</td>
      <td>org.hibernate.dialect.OracleDialect</td>
    </tr>
    <tr>
      <td>Sybase</td>
      <td>org.hibernate.dialect.SybaseDialect</td>
    </tr>
    <tr>
      <td>Microsoft SQL Server</td>
      <td>org.hibernate.dialect.SQLServerDialect</td>
    </tr>
    <tr>
      <td>SAP DB</td>
      <td>org.hibernate.dialect.SAPDBDialect</td>
    </tr>
    <tr>
      <td>H2</td>
      <td>org.hibernate.dialect.H2Dialect</td>
    </tr>
  </tbody>
</table>

<p>Hibernate에서 지원하는 Dialect의 종류는 <a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/dialect/package-summary.html" target="_blank">공식문서</a>를 참조하세요.</p>

<hr />

<p>마지막으로 JPA 구현체를 설정하겠습니다. Hibernate를 사용할 것이므로 이에 대한 프로퍼티를 설정하면 됩니다.</p>

<table>
  <thead>
    <tr>
      <th>프로퍼티</th>
      <th>의미</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>hibernate.show_sql</td>
      <td>하이버네이트에서 생성한 SQL을 콘솔에 출력</td>
    </tr>
    <tr>
      <td>hibernate.format_sql</td>
      <td>SQL을 출력할 때 특정 포맷으로 출력</td>
    </tr>
    <tr>
      <td>hibernate.use_sql_comments</td>
      <td>SQL에 포함된 주석을 포함하여 출력</td>
    </tr>
    <tr>
      <td>hibernate.id.new_generator_mapping</td>
      <td>키(key) 생성전략 사용 여부</td>
    </tr>
    <tr>
      <td>hibernate.hbm2ddl.auto</td>
      <td>DDL 자동 실행 여부</td>
    </tr>
  </tbody>
</table>

<p>여기에서 <code class="language-plaintext highlighter-rouge">hibernate.hbm2ddl.auto</code>는 SessionFactory가 생성될 때 실행될 DDL을 정의합니다.</p>

<table>
  <thead>
    <tr>
      <th>옵션</th>
      <th>의미</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>create</td>
      <td>기존 테이블을 삭제하고 다시 생성 (DROP + CREATE)</td>
    </tr>
    <tr>
      <td>create-drop</td>
      <td>SessionFactory가 종료되면 테이블을 삭제</td>
    </tr>
    <tr>
      <td>update</td>
      <td>변경된 부분에만 UPDATE 적용</td>
    </tr>
    <tr>
      <td>validate</td>
      <td>Entity와 테이블이 정상적으로 매핑되었는지 확인</td>
    </tr>
    <tr>
      <td>none</td>
      <td>(default) 아무것도 하지 않음</td>
    </tr>
  </tbody>
</table>

<p>주의할 점은 개발 단계나 테스트 단계에서만 사용하며, 운영서버에서는 validate나 none으로 설정해야 합니다.</p>

<h2 id="entity-매핑-설정">Entity 매핑 설정</h2>

<p>JPA는 어노테이션(annotation)만 적절히 설정한다면 Entity를 통해 데이터를 쉽게 관리할 수 있습니다.</p>

<h6 id="boardjava-2">Board.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.annotations.ColumnDefault</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.DynamicInsert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.DynamicUpdate</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
<span class="nd">@DynamicInsert</span>
<span class="nd">@DynamicUpdate</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
    
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">seq</span><span class="o">;</span>

    <span class="nd">@Setter</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">40</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">writer</span><span class="o">;</span>

    <span class="nd">@Setter</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"varchar(100) default 'No Contents'"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">DATE</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">createDate</span><span class="o">;</span>

    <span class="nd">@ColumnDefault</span><span class="o">(</span><span class="s">"0"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">cnt</span><span class="o">;</span>

    <span class="nd">@PrePersist</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">createDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 class="no-toc">@Entity</h3>

<p>클래스를 JPA가 관리하는 Entity로 인식하도록 합니다.</p>

<h3 class="no-toc">@DynamicInsert</h3>

<p>null이 아닌 필드만 사용하여 동적인 INSERT Query를 생성합니다.</p>

<h3 class="no-toc">@DynamicUpdate</h3>

<p>변경된 필드만 사용하여 동적인 UPDATE Query를 생성합니다.</p>

<h3 class="no-toc">@Id</h3>

<p>다른 객체와 식별할 수 있는 고유값을 가지는 필드로, 테이블의 기본키(Primary key)와 매핑됩니다.</p>

<h3 class="no-toc">@GeneratedValue</h3>

<p>식별자값을 자동으로 증가시키며, 다음과 같은 속성을 줄 수 있습니다.</p>

<h6 id="generatedvalue">@GeneratedValue</h6>

<table>
  <thead>
    <tr>
      <th>속성</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>strategy</td>
      <td>기본키 자동 생성 전략 선택</td>
    </tr>
    <tr>
      <td>generator</td>
      <td>이미 생성된 키 생성기 참조</td>
    </tr>
  </tbody>
</table>

<p>기본키를 생성하는 전략은 다음과 같습니다.</p>

<h6 id="기본키-생성-전략">기본키 생성 전략</h6>

<table>
  <thead>
    <tr>
      <th>strategy</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GenerationType.TABLE</td>
      <td>테이블을 사용하여 기본키 생성 (기본키를 생성하는 별도의 테이블 필요)</td>
    </tr>
    <tr>
      <td>GenerationType.SEQUENCE</td>
      <td>시퀀스를 이용하여 기본키 생성 (시퀀스를 지원하는 DB에서 사용 가능)</td>
    </tr>
    <tr>
      <td>GenerationType.IDENTITY</td>
      <td>auto_increment 또는 IDENTITY를 이용하여 기본키 생성</td>
    </tr>
    <tr>
      <td>GenerationType.AUTO</td>
      <td>(기본값) Hibernate가 DB에 맞는 전략을 자동으로 선택</td>
    </tr>
  </tbody>
</table>

<h3 class="no-toc">@Table</h3>

<p>Entity를 테이블과 매핑할 때 사용하며, 다음과 같은 속성을 줄 수 있습니다.</p>

<h6 id="table">@Table</h6>

<table>
  <thead>
    <tr>
      <th>속성</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>name</td>
      <td>테이블 이름 지정</td>
    </tr>
    <tr>
      <td>catalog</td>
      <td>DB 카탈로그 지정</td>
    </tr>
    <tr>
      <td>schema</td>
      <td>DB 스키마 지정</td>
    </tr>
    <tr>
      <td>uniqueConstraints</td>
      <td>결합 unique 제약조건을 지정</td>
    </tr>
  </tbody>
</table>

<h3 class="no-toc">@Column</h3>

<p>Entity 필드와 테이블 column을 매핑할 때 사용하며, 다음과 같은 속성을 줄 수 있습니다.</p>

<h6 id="column">@Column</h6>

<table>
  <thead>
    <tr>
      <th>속성</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>name</td>
      <td>column 이름 지정 (생략시 프로퍼티명과 동일)</td>
    </tr>
    <tr>
      <td>unique</td>
      <td>제약조건 추가 (기본값: false)</td>
    </tr>
    <tr>
      <td>nullable</td>
      <td>null 허용 여부 (기본값: true)</td>
    </tr>
    <tr>
      <td>insertable</td>
      <td>INSERT 가능 여부 (기본값: true)</td>
    </tr>
    <tr>
      <td>updatable</td>
      <td>UPDATE 가능 여부 (기본값: true)</td>
    </tr>
    <tr>
      <td>columnDefinition</td>
      <td>column에 대한 DDL을 직접 기술</td>
    </tr>
    <tr>
      <td>length</td>
      <td>문자열 타입 column 길이 지정 (기본값: 255)</td>
    </tr>
    <tr>
      <td>precision</td>
      <td>숫자 타입의 자리수 지정 (기본값: 0)</td>
    </tr>
    <tr>
      <td>scale</td>
      <td>숫자 타입의 소수점 자리수 지정 (기본값: 0)</td>
    </tr>
  </tbody>
</table>

<h3 class="no-toc">@ColumnDefault</h3>

<p>스키마 생성시 필드의 기본값을 설정합니다.</p>

<h3 class="no-toc">@Transient</h3>

<p>Entity 필드를 매핑에서 제외할 때 사용합니다.</p>

<h3 class="no-toc">@Temporal</h3>

<p>java.util.Date 타입의 날짜 데이터를 매핑할 때 사용하며, 다음과 같은 값을 가집니다.</p>

<h6 id="temporal">@Temporal</h6>

<table>
  <thead>
    <tr>
      <th>값</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>TemporalType.DATE</td>
      <td>날짜만 출력</td>
    </tr>
    <tr>
      <td>TemporalType.TIME</td>
      <td>시간만 출력</td>
    </tr>
    <tr>
      <td>TemporalType.STAMP</td>
      <td>날짜와 시간 모두 출력</td>
    </tr>
  </tbody>
</table>

<h3 class="no-toc">@PrePersist</h3>

<p>Entity가 persist 되기 전에 호출됩니다.</p>

<h3 class="no-toc">@PreUpdate</h3>

<p>Entity가 update 되기 전에 호출됩니다.</p>

<h1 id="jpa-이해">JPA 이해</h1>

<p>JPA를 이용하여 CRUD 프로그램을 구현하기에 앞서 영속성 컨텍스트와 Entity의 생명주기(Lifecycle)에 대해 알아보도록 하겠습니다.</p>

<h2 id="영속성-컨텍스트persistence-context">영속성 컨텍스트(Persistence Context)</h2>

<p>영속성 유닛을 설정할 때 잠깐 언급했지만 영속성 컨텍스트는 <strong><u>데이터가 영속성을 부여받는 환경</u></strong>을 말합니다. 영속성을 부여받았다고 해서 완전히 사라지지 않는 것은 의미하지는 않습니다. 앞서 말했지만 영속성 컨텍스트에 저장된 데이터는 프로그램이 종료되면 컨텍스트와 함께 메모리에서 사라져 버립니다.</p>

<p>영속성 컨텍스트는 EntityManager가 가지고 있습니다. EntityManager는 영속성 컨텍스트를 통해 CRUD를 수행할 수 있습니다.</p>

<p>영속성 컨텍스트는 크게 <code class="language-plaintext highlighter-rouge">1차 캐시 저장소</code>와 <code class="language-plaintext highlighter-rouge">SQL 저장소</code>로 구분됩니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-12.png" alt="img12" /></p>

<p><code class="language-plaintext highlighter-rouge">1차 캐시 저장소</code>에는 Entity 정보를 저장합니다. 이 상태를 <code class="language-plaintext highlighter-rouge">영속 상태</code>라고 합니다.</p>

<p><code class="language-plaintext highlighter-rouge">SQL 저장소</code>에는 SQL Query를 저장합니다. 저장된 쿼리는 EntityManager의 <code class="language-plaintext highlighter-rouge">flush()</code> 메소드에 의하여 DB에 반영됩니다.</p>

<h2 id="entity-생명주기lifecycle">Entity 생명주기(Lifecycle)</h2>

<p>Entity는 EntityManager가 제공하는 메소드를 통해 관리되며, 다음과 같이 4가지 상태로 존재합니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-08.png" alt="img08" /></p>

<h3 class="no-toc">비영속 상태(New)</h3>

<p>비영속 상태는 Entity 객체만 생성하고 아직 Entity를 영속성 컨텍스트에 저장하지 않은 상태입니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-09.png" alt="img09" /></p>

<h6 id="비영속-상태">비영속 상태</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">"테이블 제목"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="s">"Rubisco"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="s">"첫번째 글입니다."</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>

<h3 class="no-toc">영속 상태(Managed)</h3>

<p>영속 상태는 Entity 객체가 영속성 컨텍스트에 저장된 상태입니다. Id를 키(key)로 하여 Entity가 1차 캐시 저장소에 저장됨과 동시에 SQL 저장소에는 INSERT Query가 저장됩니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-10.png" alt="img10" /></p>

<p>이 상태에서는 Entity를 영속성 컨텍스트가 관리하는 상태이므로 객체의 상태변경을 자동으로 감지합니다. 이것을 <code class="language-plaintext highlighter-rouge">Dirty Checking</code>이라고 합니다.</p>

<p>영속 상태가 되기 위해서는 EntityManager의 <code class="language-plaintext highlighter-rouge">persist()</code> 메소드를 사용합니다.</p>

<h6 id="entitymanagerpersist">EntityManager.persist()</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"practice"</span><span class="o">);</span>
<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>

<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">persist()</code> 메소드를 통해 Entity가 영속화 되어도 <code class="language-plaintext highlighter-rouge">flush()</code> 메소드가 호출되기 전까지는 DB에 쿼리가 전달되지 않고 SQL 저장소에 쌓입니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-13.png" alt="img13" /></p>

<p>EntityManager의 <code class="language-plaintext highlighter-rouge">flush()</code> 메소드가 호출되면 SQL 저장소의 모든 쿼리가 DB에 반영됩니다. flush를 하더라도 Entity는 영속성 컨텍스트에 계속 저장되어 있습니다. 단지 영속성 컨텍스트와 DB를 동기화(Synchronize)할 뿐입니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-14.png" alt="img14" /></p>

<p>EntityManager의 <code class="language-plaintext highlighter-rouge">find()</code> 메소드를 통해서도 DB의 데이터를 통해 Entity 객체를 만들어 영속성 컨텍스트에 저장함으로써 영속 상태가 될 수 있습니다.</p>

<h6 id="entitymanagerfind">EntityManager.find()</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Board</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2L</span><span class="o">);</span>
</code></pre></div></div>

<p align="center"><img src="/assets/images/jpa/jpa-img-11.png" alt="img11" /></p>

<p>만약 같은 Entity를 조회한다면 JPA는 1차 캐시 저장소에 있는 Entity를 반환하게 되므로 성능상 큰 이점을 얻을 수 있습니다.</p>

<p>아래 코드를 실행시켜보면 영속화된 <code class="language-plaintext highlighter-rouge">board</code> 객체와 find()로 호출한 <code class="language-plaintext highlighter-rouge">findBoard</code> 객체는 동일한 객체라는 것을 확인할 수 있습니다.</p>
<h6 id="jpaclientjava">JPAClient.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityManagerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityTransaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Persistence</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JPAClient</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"practice"</span><span class="o">);</span>
        <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
        <span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

            <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">"테이블 제목"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="s">"Rubisco"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="s">"첫번째 글입니다."</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

            <span class="nc">Board</span> <span class="n">findBoard</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Board</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"동일성 여부 : "</span> <span class="o">+</span> <span class="o">(</span><span class="n">board</span> <span class="o">==</span> <span class="n">findBoard</span><span class="o">));</span> <span class="c1">// true 출력</span>
            
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 class="no-toc">준영속 상태(Detatched)</h3>

<p>EntityManager의 <code class="language-plaintext highlighter-rouge">detach()</code> 메소드 또는 <code class="language-plaintext highlighter-rouge">clear()</code>, <code class="language-plaintext highlighter-rouge">close()</code> 메소드가 호출된 경우 Entity는 준영속 상태가 됩니다.</p>

<p><code class="language-plaintext highlighter-rouge">detach()</code> 메소드는 특정 Entity를 준영속 상태로 전환합니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-15.png" alt="img15" /></p>

<h6 id="entitymanagerdetach">EntityManager.detach()</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">em</span><span class="o">.</span><span class="na">detach</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">clear()</code> 메소드는 영속성 컨텍스트 안의 모든 Entity를 준영속 상태로 만듭니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-16.png" alt="img16" /></p>

<p><code class="language-plaintext highlighter-rouge">close()</code> 메소드는 EntityManager를 닫아 영속성 컨텍스트를 종료하고 영속성 컨텍스트 안의 모든 Entity를 준영속 상태로 만듭니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-17.png" alt="img17" /></p>

<p>준영속 상태가 된 Entity는 EntityManager의 관리를 벗어나기 때문에 Dirty Checking을 하지 않습니다. 하지만 완전히 메모리에서 사라진 것은 아니기 때문에 EntityManager의 <code class="language-plaintext highlighter-rouge">merge()</code> 메소드를 통해 다시 영속상태로 전환될 수 있습니다.</p>

<h6 id="entitymanagermerge">EntityManager.merge()</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
</code></pre></div></div>

<p>여기에서 중요한 것은 board 객체 자체가 다시 영속상태가 되는 것이 아니라는 것입니다. merge라는 말처럼 새로운 Entity에 board 객체의 모든 필드를 합병하고 새로운 객체를 1차 캐시 저장소에 저장합니다. 즉, merge는 UPDATE 기능을 수행합니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-18.png" alt="img18" /></p>

<p>EntityManager로부터 merge 메소드가 호출되면 우선 DB에서 Id 필드와 같은 동일한 기본키를 조회합니다. 동일한 기본키가 없다면 새로운 Entity에 board Entity를 합병하고 합병된 Entity를 반환합니다. 이때 SQL 저장소에는 INSERT Query가 저장됩니다.</p>

<p>동일한 기본키가 있다면 해당 Entity를 영속화하여 board Entity를 합병합니다. 이때 SQL 저장소에는 UPDATE Query가 저장됩니다.</p>

<p>실제 아래 코드를 통해 1차 캐시 저장소에 저장된 객체는 board가 아닌 <code class="language-plaintext highlighter-rouge">mergedBoard</code>라는 것을 확인할 수 있습니다.</p>

<h6 id="jpaclientjava-1">JPAClient.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityManagerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityTransaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Persistence</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JPAClient</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"practice"</span><span class="o">);</span>
        <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
        <span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

            <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">"테이블 제목"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="s">"Rubisco"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="s">"첫번째 글입니다."</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="nc">Board</span> <span class="n">mergedBoard</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
            <span class="n">em</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

            <span class="nc">Board</span> <span class="n">findBoard</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Board</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"동일성 여부 : "</span> <span class="o">+</span> <span class="o">(</span><span class="n">findBoard</span> <span class="o">==</span> <span class="n">mergedBoard</span><span class="o">));</span> <span class="c1">// true 출력</span>
            
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>사실 1차 캐시 저장소에는 entity 자체가 저장되는 것이 아니라 Entity의 Reference와 Snapsot을 저장하고 있습니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-19.png" alt="img19" /></p>

<p>flush가 호출되고 실행되기 전에 EntityManager는 실제 Entity와 Snapshot을 비교하여 변경을 감지할 수 있습니다. 내용이 변경되었다면 UPDATE Query를 생성하여 DB를 update 할 수 있습니다.</p>

<p>주의할 것은 Entity의 모든 필드가 교체되므로 값이 null이 될 가능성이 있다는 것을 숙지해야합니다.</p>

<h6 id="jpaclientjava-2">JPAClient.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityManagerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityTransaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Persistence</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JPAClient</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"practice"</span><span class="o">);</span>
        <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
        <span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

            <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">"테이블 제목"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="s">"Rubisco"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="s">"첫번째 글입니다."</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
            <span class="n">em</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">em</span><span class="o">.</span><span class="na">detach</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
            <span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">board</span><span class="o">);</span> <span class="c1">// board의 cnt는 null이므로 cnt가 null로 갱신</span>
            <span class="n">em</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위에 코드를 실행하고 DB를 확인하면 cnt 값이 null이라는 것을 확인할 수 있습니다.</p>

<h3 class="no-toc">삭제 상태(Removed)</h3>

<p>EntityManger의 remove() 메소드로 Entity를 삭제하면 해당 Entity는 영속성 컨텍스트에서 제외되고 DELETE Query가 SQL 저장소에 저장됩니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-20.png" alt="img20" /></p>

<h6 id="entitymanagerremove">EntityManager.remove()</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Board</span> <span class="n">removeBoard</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Board</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2L</span><span class="o">);</span>
<span class="n">em</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">removeBoard</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="jpqljava-persistence-query-language">JPQL(Java Persistence Query Language)</h2>

<p>특정 데이터의 조회는 EntityManager의 find() 메소드를 사용하면 되지만, 목록을 조회하려면 JPQL 이라는 JPA에서 제공하는 별도의 쿼리 명령어를 사용해야 합니다. SQL문과 유사한 문법을 사용하므로 해석에는 특별한 어려움이 없지만 중요한 것은 검색 대상이 테이블이 아니라 Entity라는 점입니다.</p>

<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityManagerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityTransaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Persistence</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JPAClient</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"practice"</span><span class="o">);</span>
        <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
        <span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>

            <span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">"테이블 제목"</span> <span class="o">+</span> <span class="n">i</span><span class="o">)</span>
                <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="s">"Rubisco"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">"번째 글입니다."</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
                <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
            <span class="o">}</span>
            
            <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>

            <span class="nc">String</span> <span class="n">jpql</span> <span class="o">=</span> <span class="s">"select b from Board b order by b.seq desc"</span><span class="o">;</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="nc">BoardList</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">jpql</span><span class="o">,</span> <span class="nc">Board</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="nc">Board</span> <span class="n">brd</span> <span class="o">:</span> <span class="nc">BoardList</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---&gt; "</span> <span class="o">+</span> <span class="n">brd</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="spring-data-jpa">Spring Data JPA</h1>

<p><code class="language-plaintext highlighter-rouge">Spring Data JPA</code>는 JPA를 쉽게 사용하기 위해 Spring에서 제공하는 프레임워크 이며, JPA의 인터페이스 입니다. JPA는 아니지만 보통 JPA라고 하면 Spring Data JPA를 뜻합니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-03.png" alt="img03" /></p>

<p>Spring Data JPA, Spring Data MongoDB, Spring Data Redis등 Spring Data의 하위 프로젝트들은 동일한 인터페이스를 가지고 있어서 Repository를 교체해도 기본적인 기능이 변하지 않습니다.</p>

<h3 class="no-toc">프로젝트 생성</h3>

<p>빌드 도구를 Gradle로 하여 프로젝트를 만들겠습니다. 의존성 패키지로 <code class="language-plaintext highlighter-rouge">spring-boot-starter-data-jpa</code>를 추가합니다.</p>

<div data-lang="GRADLE" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>implementation <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
</code></pre></div></div>

<p>전체 코드는 다음과 같습니다.</p>

<h6 id="buildgradle-1">build.gradle</h6>
<div data-lang="GRADLE" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plugins <span class="o">{</span>
	<span class="nb">id</span> <span class="s1">'org.springframework.boot'</span> version <span class="s1">'2.7.2'</span>
	<span class="nb">id</span> <span class="s1">'io.spring.dependency-management'</span> version <span class="s1">'1.0.12.RELEASE'</span>
	<span class="nb">id</span> <span class="s1">'java'</span>
<span class="o">}</span>

group <span class="o">=</span> <span class="s1">'com.example'</span>
version <span class="o">=</span> <span class="s1">'0.0.1-SNAPSHOT'</span>
sourceCompatibility <span class="o">=</span> <span class="s1">'17'</span>

configurations <span class="o">{</span>
	compileOnly <span class="o">{</span>
		extendsFrom annotationProcessor
	<span class="o">}</span>
<span class="o">}</span>

repositories <span class="o">{</span>
	mavenCentral<span class="o">()</span>
<span class="o">}</span>

dependencies <span class="o">{</span>

	implementation <span class="s1">'org.springframework.boot:spring-boot-starter'</span>
	implementation <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
	testImplementation <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>
	testImplementation <span class="s1">'junit:junit'</span>

	compileOnly <span class="s1">'org.projectlombok:lombok'</span>
	annotationProcessor <span class="s1">'org.projectlombok:lombok'</span>

	// 오라클DB 접근
	runtimeOnly <span class="s1">'com.oracle.database.jdbc:ojdbc8'</span>
	implementation <span class="s1">'com.oracle.database.security:oraclepki'</span>
	implementation <span class="s1">'com.oracle.database.security:osdt_core'</span>
	implementation <span class="s1">'com.oracle.database.security:osdt_cert'</span>
	
<span class="o">}</span>

tasks.named<span class="o">(</span><span class="s1">'test'</span><span class="o">)</span> <span class="o">{</span>
	useJUnitPlatform<span class="o">()</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 class="no-toc">프로퍼티 설정</h3>

<p>스프링 데이터 JPA는 persistence.xml 파일에 작성한 설정과 동일하게 application.properties 파일을 작성하면 됩니다. 아래와 같이 작성합시다.</p>

<div data-lang="PROPERTIES" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># DataSource Setting</span>
spring.datasource.driver-class-name<span class="o">=</span>oracle.jdbc.OracleDriver
spring.datasource.url<span class="o">=</span>DB 주소
spring.datasource.username<span class="o">=</span>DB 아이디
spring.datasource.password<span class="o">=</span>DB 암호

<span class="c"># JPA Setting</span>
spring.jpa.hibernate.ddl-auto<span class="o">=</span>create
spring.jpa.hibernate.use-new-id-generator-mappings<span class="o">=</span><span class="nb">false
</span>spring.jpa.generate-ddl<span class="o">=</span><span class="nb">false
</span>spring.jpa.show-sql<span class="o">=</span><span class="nb">true
</span>spring.jpa.database<span class="o">=</span>oracle
spring.jpa.database-platform<span class="o">=</span>org.hibernate.dialect.OracleDialect
spring.jpa.properties.hibernate.format_sql<span class="o">=</span><span class="nb">true
</span>spring.jpa.properties.hibernate.use_sql_comments<span class="o">=</span><span class="nb">false</span>

<span class="c"># Logging Setting</span>
logging.level.org.hibernate<span class="o">=</span>info
</code></pre></div></div>

<h3 class="no-toc">Entity 설정</h3>

<p>Entity 매핑을 설정합니다. 위에 작성한 Board 클래스와 동일합니다.</p>

<h6 id="boardjava-3">Board.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.annotations.ColumnDefault</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.DynamicInsert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.DynamicUpdate</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
<span class="nd">@DynamicInsert</span>
<span class="nd">@DynamicUpdate</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
    
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">seq</span><span class="o">;</span>

    <span class="nd">@Setter</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">40</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">writer</span><span class="o">;</span>

    <span class="nd">@Setter</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"varchar(100) default 'No Contents'"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">DATE</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">createDate</span><span class="o">;</span>

    <span class="nd">@ColumnDefault</span><span class="o">(</span><span class="s">"0"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">cnt</span><span class="o">;</span>

    <span class="nd">@PrePersist</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">createDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">spring.jpa.hibernate.ddl-auto</code> 속성값을 create로 설정했기 때문에 Entity를 기준으로 테이블이 자동생성됩니다. 메인 클래스를 하나 만들어 다음과 같은 코드를 작성해주세요.</p>

<h6 id="springdatajpaapplicationjava">SpringDataJpaApplication.java</h6>

<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.WebApplicationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringDataJpaApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span> <span class="n">application</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SpringApplication</span><span class="o">(</span><span class="nc">SpringDataJpaApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">application</span><span class="o">.</span><span class="na">setWebApplicationType</span><span class="o">(</span><span class="nc">WebApplicationType</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
		<span class="n">application</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>

	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">WebApplicationType</code>을 NONE으로 설정하여 내장 톰캣을 껐습니다. 메인 클래스를 실행하면 다음과 같은 내용이 콘솔창에 출력됩니다.</p>

<div data-lang="BASH" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate: 
    
    drop table board cascade constraints
Hibernate: 
    
    drop sequence hibernate_sequence
Hibernate: create sequence hibernate_sequence start with 1 increment by 1
Hibernate: 
    
    create table board <span class="o">(</span>
       <span class="nb">seq </span>number<span class="o">(</span>19,0<span class="o">)</span> not null,
        cnt number<span class="o">(</span>19,0<span class="o">)</span> default 0,
        content varchar<span class="o">(</span>100<span class="o">)</span> default <span class="s1">'No Contents'</span>,
        create_date <span class="nb">date</span>,
        title varchar2<span class="o">(</span>255<span class="o">)</span> not null,
        writer varchar2<span class="o">(</span>40<span class="o">)</span> not null,
        primary key <span class="o">(</span><span class="nb">seq</span><span class="o">)</span>
    <span class="o">)</span>
</code></pre></div></div>

<p>시퀀스와 테이블이 자동으로 생성되었으며, createData 필드가 스네이크 표기법으로 바뀌었습니다. (create_data)</p>

<p>ddl-auto가 create 이므로 테이블이 삭제되고 다시 생성됨을 확인할 수 있습니다.</p>

<h2 id="repository-인터페이스-작성">Repository 인터페이스 작성</h2>

<p>Entity의 CRUD 기능을 처리하기 위한 Repository 인터페이스를 작성하겠습니다. Repository는 위에서 설명했듯이 기존 DAO와 동일한 개념으로, 비즈니스 로직층에서는 Repository를 통해 DB 연동을 처리합니다. 스프링에서 제공하는 Repository 중 하나를 상속하여 작성하면 됩니다.</p>

<p align="center"><img src="/assets/images/jpa/jpa-img-21.png" alt="img21" /></p>

<p>일반적으로 <code class="language-plaintext highlighter-rouge">CrudRepository</code>를 사용하며, 이름에서 알 수 있듯이 CRUD 기능을 제공합니다.</p>

<p>만약 검색 기능이 필요하고 페이징 처리를 하고자 한다면 <code class="language-plaintext highlighter-rouge">PagingAndSortingRepository</code>를 사용하고, Spring Data JPA에서 추가한 기능을 사용하고 싶으면 <code class="language-plaintext highlighter-rouge">JpaRepository</code>를 사용하면 됩니다.</p>

<p>CrudRepository는 다음과 같이 T, ID 2개의 제네릭 타입을 지정해야 합니다.</p>

<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>T는 Entity 클래스, ID는 식별자(Id)의 타입을 지정합니다.</p>

<h6 id="boardrepositoryjava">BoardRepository.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.data.repository.CrudRepository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BoardRepository</span> <span class="kd">extends</span> <span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    
<span class="o">}</span>
</code></pre></div></div>

<h2 id="crud-기능-테스트">CRUD 기능 테스트</h2>

<p>CrudRepository 인터페이스가 제공하는 메소드는 다음과 같습니다.</p>

<table>
  <thead>
    <tr>
      <th>메소드</th>
      <th>반환형</th>
      <th>기능</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>count()</td>
      <td>long</td>
      <td>모든 Entity 개수 리턴</td>
    </tr>
    <tr>
      <td>delete(ID)</td>
      <td>void</td>
      <td>식별키 삭제</td>
    </tr>
    <tr>
      <td>delete(Iterable&lt;?Extends T&gt;)</td>
      <td>void</td>
      <td>주어진 모든 Entity 삭제</td>
    </tr>
    <tr>
      <td>deleteAll()</td>
      <td>void</td>
      <td>모든 Entity 삭제</td>
    </tr>
    <tr>
      <td>exists(ID)</td>
      <td>boolean</td>
      <td>식별키를 가진 Entity 존재 확인</td>
    </tr>
    <tr>
      <td>findAllById(ID)</td>
      <td>Iterable&lt;T&gt;</td>
      <td>모든 Entity 목록 리턴</td>
    </tr>
    <tr>
      <td>findAll(Iterable&lt;ID&gt;)</td>
      <td>Iterable&lt;T&gt;</td>
      <td>해당 식별키를 가진 Entity 목록 리턴</td>
    </tr>
    <tr>
      <td>findById(ID)</td>
      <td>Optional&lt;T&gt;</td>
      <td>해당 식별키에 해당하는 Entity 리턴</td>
    </tr>
    <tr>
      <td>saveAll&lt;Iterable&gt;</td>
      <td>&lt;S extends T&gt;Iterable&lt;S&gt;</td>
      <td>여러 Entity들을 한 번에 등록, 수정</td>
    </tr>
    <tr>
      <td>save&lt;S entity&gt;</td>
      <td>&lt;S extends T&gt;S</td>
      <td>하나의 Entity를 등록, 수정</td>
    </tr>
  </tbody>
</table>

<p>CRUD 기능 테스트를 하기 전에 <code class="language-plaintext highlighter-rouge">application.properties</code>에서 <code class="language-plaintext highlighter-rouge">spring.jpa.hibernate.ddl-auto</code>를 <code class="language-plaintext highlighter-rouge">update</code>로 바꿔주세요.</p>

<div data-lang="PROPERTIES" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.jpa.hibernate.ddl-auto<span class="o">=</span>update
</code></pre></div></div>

<h3 class="no-toc">등록(Create)</h3>

<p><code class="language-plaintext highlighter-rouge">src/test/java</code> 폴더에 Junit 기반의 <code class="language-plaintext highlighter-rouge">BoardRepositoryTest</code>라는 테스트 케이스를 작성합니다.</p>

<h6 id="boardrepositorytestjava">BoardRepositoryTest.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardRepositoryTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">BoardRepository</span> <span class="n">boardRepo</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testInsertBoard</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">"테이블 제목"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="s">"Rubisco"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="s">"첫번째 글입니다."</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        
        <span class="n">boardRepo</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>JPA에서는 persist() 메소드로 INSERT를 했지만, CrudRepository 인터페이스는 save() 메소드를 통해 INSERT를 합니다.</p>

<div data-lang="BASH" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate: 
    <span class="k">select
        </span>hibernate_sequence.nextval 
    from
        dual
Hibernate: 
    insert 
    into
        board
        <span class="o">(</span>content, create_date, title, writer, <span class="nb">seq</span><span class="o">)</span> 
</code></pre></div></div>

<p>시퀀스를 하나 증가시킨 후 INSERT 쿼리가 실행됨을 확인할 수 있습니다.</p>

<h3 class="no-toc">조회(Read)</h3>

<p>조회 기능을 테스트 하기 위해 <code class="language-plaintext highlighter-rouge">testGetBoard</code>라는 메소드를 작성합니다.</p>

<h6 id="boardrepositorytestjava-1">BoardRepositoryTest.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetBoard</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="n">boardRepo</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">board</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p>데이터 하나를 조회하기 위해서는 <code class="language-plaintext highlighter-rouge">findById()</code> 메소드를 사용합니다. 그러면 <code class="language-plaintext highlighter-rouge">Optional</code> 타입의 객체가 리턴되며, <code class="language-plaintext highlighter-rouge">get()</code> 메소드를 통해 영속성 컨텍스트에 저장된 Board 객체를 받을 수 있습니다.</p>

<div data-lang="BASH" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate: 
    <span class="k">select
        </span>board0_.seq as seq1_0_0_,
        board0_.cnt as cnt2_0_0_,
        board0_.content as content3_0_0_,
        board0_.create_date as create_d4_0_0_,
        board0_.title as title5_0_0_,
        board0_.writer as writer6_0_0_ 
    from
        board board0_ 
    where
        board0_.seq<span class="o">=</span>?
Board<span class="o">(</span><span class="nb">seq</span><span class="o">=</span>1, <span class="nv">title</span><span class="o">=</span>제목 수정, <span class="nv">writer</span><span class="o">=</span>Rubisco, <span class="nv">content</span><span class="o">=</span>첫번째 글입니다., <span class="nv">createDate</span><span class="o">=</span>2022-08-08, <span class="nv">cnt</span><span class="o">=</span>0<span class="o">)</span>
</code></pre></div></div>

<p>테스트 케이스를 실행하면 SELECT 쿼리가 실행되고, 터미널에 seq=1인 Entity의 속성이 출력되는 것을 확인할 수 있습니다.</p>

<h3 class="no-toc">수정(Update)</h3>

<p>수정 기능을 테스트 하기 위해 <code class="language-plaintext highlighter-rouge">testUpdateBoard</code> 라는 메소드를 작성합니다.</p>

<h6 id="boardrepositorytestjava-2">BoardRepositoryTest.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUpdateBoard</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="n">boardRepo</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
    <span class="n">board</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"제목 수정"</span><span class="o">);</span>
    <span class="n">boardRepo</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>JPA에서는 <code class="language-plaintext highlighter-rouge">merge()</code> 메소드를 사용했지만, CrudRepository는 INSERT 할때와 동일하게 <code class="language-plaintext highlighter-rouge">save()</code> 메소드를 사용합니다.</p>

<div data-lang="BASH" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate: 
    <span class="k">select
        </span>board0_.seq as seq1_0_0_,
        board0_.cnt as cnt2_0_0_,
        board0_.content as content3_0_0_,
        board0_.create_date as create_d4_0_0_,
        board0_.title as title5_0_0_,
        board0_.writer as writer6_0_0_ 
    from
        board board0_ 
where
        board0_.seq<span class="o">=</span>?
Hibernate: 
    <span class="k">select
        </span>board0_.seq as seq1_0_0_,
        board0_.cnt as cnt2_0_0_,
        board0_.content as content3_0_0_,
        board0_.create_date as create_d4_0_0_,
        board0_.title as title5_0_0_,
        board0_.writer as writer6_0_0_ 
    from
        board board0_ 
    where
        board0_.seq<span class="o">=</span>?
Hibernate: 
    update
        board 
    <span class="nb">set
        </span><span class="nv">title</span><span class="o">=</span>? 
    where
        <span class="nb">seq</span><span class="o">=</span>?
</code></pre></div></div>

<p>수정할 Entity를 영속성 컨텍스트에 저장하기 위해 처음 SELECT 구문을 실행했으며, 수정하기 직전 다시 한번 수정할 Entity를 영속성 컨텍스트에 저장하고 수정 작업이 이루어지기 때문에 2번의 SELECT와 1번의 UPDATE 쿼리가 실행되었음을 확인할 수 있습니다.</p>

<h3 class="no-toc">삭제(Delete)</h3>

<p>삭제 기능을 테스트 하기 위해 <code class="language-plaintext highlighter-rouge">testDeleteBoard</code> 라는 메소드를 작성합니다.</p>

<h6 id="boardrepositorytestjava-3">BoardRepositoryTest.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDeleteBoard</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">boardRepo</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>단 한줄입니다.. JPA도 구문이 간단하다고 느꼈는데 Spring Data JPA는 더욱 단순화 되고 직관적입니다.</p>

<div data-lang="BASH" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate: 
    <span class="k">select
        </span>board0_.seq as seq1_0_0_,
        board0_.cnt as cnt2_0_0_,
        board0_.content as content3_0_0_,
        board0_.create_date as create_d4_0_0_,
        board0_.title as title5_0_0_,
        board0_.writer as writer6_0_0_ 
    from
        board board0_ 
    where
        board0_.seq<span class="o">=</span>?
Hibernate: 
    delete 
    from
        board 
    where
        <span class="nb">seq</span><span class="o">=</span>?
</code></pre></div></div>

<p>수정과 마찬가지로 SELECT 쿼리를 통해 Entity를 영속성 컨텍스트에 저장한 후 DELETE 쿼리가 실행됨을 확인할 수 있습니다.</p>

<hr />

<p>Hibernate로 CRUD를 만들때는 EntityManagerFactory를 짓고 EntityManager를 생성하여 EntityManager를 통해 Entity의 CRUD를 처리했습니다.</p>

<p>반면 Spring Data JPA로 CRUD를 만들때는 EntityManager가 등장하지 않았습니다. EntityManager는 Repository에 포함되어있어 직접 작성하지 않아도 내부에서 자동적으로 호출되는 모양새 입니다.</p>

<p>아직 완전히 이해하진 못했지만 Spring Data JPA를 사용하면 효율적인 개발이 될 것임은 확실해 보입니다.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Rubisco's Programming Note</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- utterances -->
            <div id="comment">
                <script src="https://utteranc.es/client.js"
                repo="huimang2/huimang2.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async></script>
            </div>
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/M31_starspike.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Rubisco's Programming Note &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/java/">Java</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring_boot">스프링 부트로 게시판 만들기</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/java/spring">스프링 프레임워크(Spring Framework)</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/design-pattern/creational/singleton-pattern">싱글톤 패턴(Singleton Pattern)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/java/">
                                
                                    See all 4 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/etc/ubuntu-dev-env">
                <div class="post-card-image" style="background-image: url(/assets/images/ubuntu_dev_env/ubuntu_dev_env_img01.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/etc/ubuntu-dev-env">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">원격 코드 개발환경 구축</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>우분투 20.04 LTS 환경인 원격 컴퓨터에 코딩환경을 구축하고, VSCode를 통해 원격 환경에서 코드 개발을 해보도록 하겠습니다.

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      6 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/design-pattern/mvc-pattern">
                <div class="post-card-image" style="background-image: url(/assets/images/mvc/mvc-img-06.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/design-pattern/mvc-pattern">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">MVC 패턴</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>MVC 패턴이란?

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://huimang2.github.io/">
            
            <span>Rubisco's Programming Note</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">JPA(Java Persistence API)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=JPA%28Java+Persistence+API%29&amp;url=java/jpa"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=java/jpa"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://huimang2.github.io/">Rubisco's Programming Note</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search Rubisco's Programming Note</h1>
            <p class="subscribe-overlay-description">
            lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>


    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    /* toc ---------------------------------------------------------------------*/

    var tocTitle = document.getElementsByClassName("post-full-title")[0];
    var tocTitleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var tocArticle = document.getElementsByClassName("post-full-content")[0];
    var tocArticleY = window.pageYOffset + tocArticle.getBoundingClientRect().top;
  
    var toc = document.getElementById("toc");
    var tocHeaderNodes = getHeaderNodes(tocArticle);
    var tocNodes = getTOCNodes(toc);
  
    var tocBefore = undefined;

    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3" && !elem.classList.contains('no-toc');
        });
        return headerNodes;
    }

    tocNodes.forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    document.querySelector('.post-full-content').querySelectorAll('p a[href^="#"]').forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    /*--------------------------------------------------------------------------*/

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 30;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
            toc.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
            toc.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;

        // toc
        var tocCurrent = tocHeaderNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 90;
        });
  
        if (tocCurrent.length > 0) {
            tocCurrent = tocCurrent[tocCurrent.length-1];
  
            var tocCurrentA = tocNodes.filter(function(tocNode) {
                return tocNode.getElementsByTagName("span")[0].innerHTML == tocCurrent.innerHTML;
            })
            
            tocCurrentA = tocCurrentA[0];

            if (tocCurrentA) {
                if (tocBefore == undefined) tocBefore = tocCurrentA;
    
                if (tocBefore != tocCurrentA) {
                    tocBefore.classList.remove("toc-active");
                    tocBefore = tocCurrentA;
                }
    
                tocCurrentA.classList.add("toc-active");
            }
            else {
                if (tocBefore) 
                    tocBefore.classList.remove("toc-active");
            }
        }
        else {
            if (tocBefore) 
                tocBefore.classList.remove("toc-active");
        }
        
        if(toc && tocArticle.getBoundingClientRect().bottom <= 0) {
            toc.classList.add('toc-hidden');
        } else {
            toc.classList.remove('toc-hidden');
        }
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
