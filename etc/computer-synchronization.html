<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>프로세스 동기화</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- 웹 폰트 설정 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
    

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- syntax.css -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="프로그래밍 노트" />
    <link rel="shortcut icon" href="https://huimang2.github.io/assets/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://huimang2.github.io/etc/computer-synchronization" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Rubisco's Programming Note" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="프로세스 동기화" />
    <meta property="og:description" content="프로세스 동기화(Synchronization)란? 프로세스 동기화란 프로세스의 실행 순서를 제어하고 동시에 접근할 수 없는 자원에 하나의 프로세스만 접근하게 하여 데이터의 일관성을 유지하는 과정을 말합니다. 프로세스는 동시에 실행되면서 서로 영향을 주고 받는데, 이 과정에서 자원의 일관성이 보장되어야 합니다. 일관성이란 자원의 상태가 동일함을 의미합니다. 예를 들어 1번지에 저장되어 있는 데이터와 2번지에 저장되어 있는 데이터를" />
    <meta property="og:url" content="https://huimang2.github.io/etc/computer-synchronization" />
    <meta property="og:image" content="https://huimang2.github.io/assets/images/computer-logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2023-06-25T01:00:00+09:00" />
    <meta property="article:modified_time" content="2023-06-25T01:00:00+09:00" />
    <meta property="article:tag" content="Etc" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="프로세스 동기화" />
    <meta name="twitter:description" content="프로세스 동기화(Synchronization)란? 프로세스 동기화란 프로세스의 실행 순서를 제어하고 동시에 접근할 수 없는 자원에 하나의 프로세스만 접근하게 하여 데이터의 일관성을 유지하는 과정을 말합니다. 프로세스는 동시에 실행되면서 서로 영향을 주고 받는데, 이 과정에서 자원의 일관성이 보장되어야 합니다. 일관성이란 자원의 상태가 동일함을 의미합니다. 예를 들어 1번지에 저장되어 있는 데이터와 2번지에 저장되어 있는 데이터를" />
    <meta name="twitter:url" content="https://huimang2.github.io/" />
    <meta name="twitter:image" content="https://huimang2.github.io/assets/images/computer-logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rubisco's Programming Note" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Etc" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Rubisco's Programming Note",
        "logo": "https://huimang2.github.io/"
    },
    "url": "https://huimang2.github.io/etc/computer-synchronization",
    "image": {
        "@type": "ImageObject",
        "url": "https://huimang2.github.io/assets/images/computer-logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://huimang2.github.io/etc/computer-synchronization"
    },
    "description": "프로세스 동기화(Synchronization)란? 프로세스 동기화란 프로세스의 실행 순서를 제어하고 동시에 접근할 수 없는 자원에 하나의 프로세스만 접근하게 하여 데이터의 일관성을 유지하는 과정을 말합니다. 프로세스는 동시에 실행되면서 서로 영향을 주고 받는데, 이 과정에서 자원의 일관성이 보장되어야 합니다. 일관성이란 자원의 상태가 동일함을 의미합니다. 예를 들어 1번지에 저장되어 있는 데이터와 2번지에 저장되어 있는 데이터를"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="프로세스 동기화" href="/feed.xml" />


    <!-- MathJax -->
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: {
        equationNumbers: {
          autoNumber: "AMS"
        },
        extensions: ["color.js"]
      },
      tex2jax: {
        inlineMath: [ ['$', '$'] ],
        displayMath: [ ['$$', '$$'] ],
        processEscapes: true,
      },
      displayAlign: "left"
    });
    MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
          alert("Math Processing Error: "+message[1]);
        });
    MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
          alert("Math Processing Error: "+message[1]);
        });
    </script>
    <script type="text/javascript" async
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://huimang2.github.io/">Rubisco's Programming Note</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-java" role="menuitem"><a href="/tag/java/">JAVA</a></li>
    <li class="nav-typescript" role="menuitem"><a href="/tag/typescript/">Typescript</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/algorithm/">Algorithm</a></li>
    <li class="nav-python" role="menuitem"><a href="/archive.html">All Posts</a></li>
    <li class="nav-python" role="menuitem"><a href="/author_archive.html">Tag별 Posts</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-etc post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="25 June 2023">25 June 2023</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                                
                                <a href='/tag/etc/'>#기타</a>
                                
                            
                        
                    
                </section>
                <h1 class="post-full-title">프로세스 동기화</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/images/computer-logo.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <div id="toc">
                        <ul><li><a href="#프로세스-동기화synchronization란"><span>프로세스 동기화(Synchronization)란?</span></a></li><li><a href="#임계-구역critical-section"><span>임계 구역(Critical Section)</span></a></li><li><a href="#동기화-방법"><span>동기화 방법</span></a><ul><li><a href="#뮤텍스-락mutex-lock"><span>뮤텍스 락(Mutex Lock)</span></a></li><li><a href="#세마포어semaphore"><span>세마포어(Semaphore)</span></a></li><li><a href="#모니터monitor"><span>모니터(Monitor)</span></a></li></ul></li></ul>

                    </div>
                    <h1 id="프로세스-동기화synchronization란">프로세스 동기화(Synchronization)란?</h1>

<p>프로세스 동기화란 프로세스의 실행 순서를 제어하고 동시에 접근할 수 없는 자원에 하나의 프로세스만 접근하게 하여 데이터의 일관성을 유지하는 과정을 말합니다.</p>

<p>프로세스는 동시에 실행되면서 서로 영향을 주고 받는데, 이 과정에서 자원의 일관성이 보장되어야 합니다. 일관성이란 자원의 상태가 동일함을 의미합니다. 예를 들어 1번지에 저장되어 있는 데이터와 2번지에 저장되어 있는 데이터를 더한다고 할 때, 1번지와 2번지에 저장되어 있는 데이터는 연산이 종료될 때까지 값이 변하면 안됩니다.</p>

<p>여러 프로세스들이 동시에 자원에 접근하는 상황에서는 명려어 실행 순서에 따라 결과값이 달라질 수 있는데, 이 상황을 <code class="language-plaintext highlighter-rouge">경쟁 상태(Race Condition)</code>라고 합니다. 경쟁 상태가 발생하면 자원의 일관성이 깨질 수 있습니다.</p>

<p>예를 들어 <code class="language-plaintext highlighter-rouge">생산자-소비자 문제(Producer Consumer Problem)</code>가 있습니다.</p>

<h6 id="생산자-소비자-문제producer-consumer-problem">생산자-소비자 문제(Producer Consumer Problem)</h6>
<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;pthread.h&gt;
</span>
<span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">++</span><span class="p">;</span>
  <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">consumer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">--</span><span class="p">;</span>
  <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pthread_t</span> <span class="n">producer_tid</span><span class="p">,</span> <span class="n">consumer_tid</span><span class="p">;</span>

  <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">producer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">producer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">consumer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">pthread_join</span><span class="p">(</span><span class="n">producer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">pthread_join</span><span class="p">(</span><span class="n">consumer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"sum: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>자원을 공유하기 위해 프로세스 대신에 스레드를 생성했습니다. 스레드는 차후 설명하겠습니다.</p>

<p>producer 스레드는 10만번 더하고, consumer 스레드는 10만번 뺍니다. sum의 결과는 0이 예상되지만 동기화가 되지 않았기 때문에 일관성이 깨져 0이 출력되지 않는 것을 확인할 수 있습니다.</p>

<h6 id="출력-결과">출력 결과</h6>
<p style="margin-top: 0"><img src="/assets/images/computer/img132.png" alt="img132" /></p>

<p>각 스레드는 한줄의 코드 일지라도 sum의 값을 읽어 MBR에 저장하고 ALU에서 연산 후 sum에 연산값을 저장하는 등 여러 명령어로 구성되어 있습니다. producer가 공유 자원인 sum에 연산값을 저장하기도 전에 문맥 교환이 발생하여 consumer가 실행된다면 데이터의 일관성은 깨져버립니다. 이는 <code class="language-plaintext highlighter-rouge">은행계좌 문제(Bank Account Problem)</code>에서 명확히 확인할 수 있습니다.</p>

<h6 id="은행계좌-문제bank-account-problem">은행계좌 문제(Bank Account Problem)</h6>

<table>
  <thead>
    <tr>
      <th>프로세스A</th>
      <th>프로세스B</th>
      <th style="text-align: center">잔액</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>잔액 읽기</td>
      <td> </td>
      <td style="text-align: center">100만원</td>
    </tr>
    <tr>
      <td>10만원 더하기</td>
      <td> </td>
      <td style="text-align: center">100만원</td>
    </tr>
    <tr>
      <td><font color="orangered">문맥교환</font></td>
      <td> </td>
      <td style="text-align: center">100만원</td>
    </tr>
    <tr>
      <td> </td>
      <td>잔액 읽기</td>
      <td style="text-align: center">100만원</td>
    </tr>
    <tr>
      <td> </td>
      <td>20만원 더하기</td>
      <td style="text-align: center">100만원</td>
    </tr>
    <tr>
      <td> </td>
      <td><font color="orangered">문맥교환</font></td>
      <td style="text-align: center">100만원</td>
    </tr>
    <tr>
      <td>잔액 저장</td>
      <td> </td>
      <td style="text-align: center">110만원</td>
    </tr>
    <tr>
      <td> </td>
      <td>잔액 저장</td>
      <td style="text-align: center"><font color="orangered">120만원</font></td>
    </tr>
  </tbody>
</table>

<p>프로세스A는 10만원을 더하고 프로세스B는 20만원을 더하므로 최종 잔액은 130만원이 되어야 하지만, 프로세스A에서 10만원을 더한 값을 저장하기도 전에 프로세스B가 실행되어 잔액의 일관성이 깨져버렸습니다.</p>

<h1 id="임계-구역critical-section">임계 구역(Critical Section)</h1>

<p>이처럼 공유 자원에 접근하는 코드 중 동시에 실행되면 문제가 발생하는 코드 영역을 <code class="language-plaintext highlighter-rouge">임계 구역(Critical Section)</code>이라고 합니다. 프로세스가 임계구역에 동시에 접근하면 경쟁 상태가 되어 자원의 일관성은 깨져버립니다.</p>

<p>임계 구역 문제를 해결하기 위해 운영체제는 다음과 같은 조건을 만족해야 합니다.</p>

<ol>
  <li><code class="language-plaintext bgcolor blue highlighter-rouge" style="color:royalblue">상호 배제(Mutual Exclusion)</code>: 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없습니다.</li>
  <li><code class="language-plaintext bgcolor blue highlighter-rouge" style="color:royalblue">유한 대기(Bounded Waiting)</code>: 어떠한 프로세스도 무한 대기해서는 안됩니다.</li>
  <li><code class="language-plaintext bgcolor blue highlighter-rouge" style="color:royalblue">진행의 융통성(Progress)</code>: 임계 구역에 어떠한 프로세스도 진입하지 않았다면 진입하고자 하는 프로세스의 진행을 방해해서는 안됩니다.</li>
</ol>

<h1 id="동기화-방법">동기화 방법</h1>

<h2 id="뮤텍스-락mutex-lock">뮤텍스 락(Mutex Lock)</h2>

<p>뮤텍스 락은 상호 배제를 위한 동기화 메커니즘 입니다. 공유 자원인 lock이 하나 존재하며, acquire 함수를 통해 임계구역을 잠그고 release 함수를 통해 임계 구역의 잠금을 해제할 수 있습니다.</p>

<h6 id="뮤텍스-락">뮤텍스 락</h6>
<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">global</span> <span class="n">bool</span> <span class="n">lock</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="n">acquire</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">lock</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">lock</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">release</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">lock</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">acquire</span><span class="p">();</span>
<span class="c1">// 임계 구역</span>
<span class="n">release</span><span class="p">();</span>
</code></pre></div></div>

<p>프로세스가 임계 구역에 진입하기 전에 acquire 함수가 호출합니다. 임계 구역이 잠겨 있다면(lock = true) 임계 구역이 열릴 때까지 임계 구역을 반복적으로 확인하는데, 이를 <code class="language-plaintext highlighter-rouge">바쁜 대기(busy waiting)</code> 이라고 합니다.</p>

<p>임계 구역이 열려 있다면 임계 구역을 잠근 후(lock = true) 임계 구역에 진입하고, 임계 구역의 작업이 끝난다면 release 함수를 호출하여 임계 구역의 잠금을 해제하고(lock = false) 임계 구역을 빠져나오게 합니다.</p>

<h6 id="뮤텍스-락-예제">뮤텍스 락 예제</h6>
<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;pthread.h&gt;
#include &lt;stdbool.h&gt;
</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">volatile</span> <span class="n">bool</span> <span class="n">lock</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">acquire</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">lock</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">lock</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">release</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">lock</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">acquire</span><span class="p">();</span> <span class="c1">// 뮤텍스 락 잠금</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">++</span><span class="p">;</span> <span class="c1">// 임계 구역</span>
  <span class="n">release</span><span class="p">();</span> <span class="c1">// 뮤텍스 락 열림</span>
  <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">consumer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">acquire</span><span class="p">();</span> <span class="c1">// 뮤텍스 락 잠금</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">--</span><span class="p">;</span> <span class="c1">// 임계 구역</span>
  <span class="n">release</span><span class="p">();</span> <span class="c1">// 뮤텍스 락 열림</span>
  <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pthread_t</span> <span class="n">producer_tid</span><span class="p">,</span> <span class="n">consumer_tid</span><span class="p">;</span>

  <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">producer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">producer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">consumer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">pthread_join</span><span class="p">(</span><span class="n">producer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">pthread_join</span><span class="p">(</span><span class="n">consumer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"sum: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h6 id="출력-결과-1">출력 결과</h6>
<p style="margin-top: 0"><img src="/assets/images/computer/img133.png" alt="img133" /></p>

<p>뮤텍스 락은 프로그래밍 언어에서 지원되는 경우가 많기 때문에 직접 구현할 일은 많지 않습니다.</p>

<h6 id="c언어-뮤텍스락-예제">C언어 뮤텍스락 예제</h6>
<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;pthread.h&gt;
</span>
<span class="n">pthread_mutex_t</span> <span class="n">lock</span> <span class="o">=</span> <span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>

<span class="k">volatile</span> <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">producer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span> <span class="c1">// 뮤텍스 락 잠금</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">++</span><span class="p">;</span> <span class="c1">// 임계 구역</span>
  <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span> <span class="c1">// 뮤텍스 락 열림</span>
  <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">consumer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span> <span class="c1">// 뮤텍스 락 잠금</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">--</span><span class="p">;</span> <span class="c1">// 임계 구역</span>
  <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span> <span class="c1">// 뮤텍스 락 열림</span>
  <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pthread_t</span> <span class="n">producer_tid</span><span class="p">,</span> <span class="n">consumer_tid</span><span class="p">;</span>

  <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">producer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">producer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">consumer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">pthread_join</span><span class="p">(</span><span class="n">producer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">pthread_join</span><span class="p">(</span><span class="n">consumer_tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"sum: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="세마포어semaphore">세마포어(Semaphore)</h2>

<p>세마포어는 철도의 수신호를 의미하는 용어입니다. 철도의 수신호가 기차의 진행을 제어하듯이 세마포어도 프로세스의 임계구역 진입 여부를 제어합니다. 한번에 하나의 프로세스만 임계 구역에 들어갈 수 있는 뮤텍스 락과 달리 여러 프로세스가 임계구역에 들어가도록 할 수 있습니다.</p>

<p>세마포어는 임계 구역에 진입할 수 있는 프로세스의 개수를 나타내는 전역 변수 S와 임계 구역의 진입 가능 여부를 알려주는 wait 함수, 대기 상태인 프로세스에게 임계 구역에 진입 가능하다는 신호를 주는 signal 함수로 구현할 수 있습니다.</p>

<h6 id="세마포어">세마포어</h6>
<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">global</span> <span class="kt">int</span> <span class="n">S</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="n">wait</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">S</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">S</span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">signal</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">S</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wait</span><span class="p">();</span>
<span class="c1">// 임계 구역</span>
<span class="n">signal</span><span class="p">();</span>
</code></pre></div></div>

<p>프로세스가 wait 함수를 호출할 때마다 임계구역에 진입할 수 있는 프로세스의 수인 S를 확인하고, S가 0이라면 S가 증가할 때까지 반복해서 확인합니다. S가 0보다 크다면 S를 1 감소시키고 임계구역에 진입합니다. 임계구역의 코드가 실행된 후 signal 함수를 호출하여 S를 1 증가시켜 줍니다.</p>

<p>wait 함수를 보면 뮤텍스 락과 같이 바쁜 대기 상태인데, 이는 CPU 성능을 저하시키는 요인이 될 수 있습니다. 이를 해결하기 위해서 wait 함수에서 임계 구역에 진입하지 못하면 프로세스를 대기 상태로 만들고, signal 함수가 호출될 때 대기 상태에 있는 프로세스를 준비 상태로 만들어주면 됩니다. 대기 상태에 있는 프로세스는 CPU 자원을 사용하지 않기 때문에 작업 사이클의 낭비를 막을 수 있습니다.</p>

<h6 id="바쁜-대기-상태-해결">바쁜 대기 상태 해결</h6>
<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">global</span> <span class="kt">int</span> <span class="n">S</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="n">wait</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">S</span><span class="o">--</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">S</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 현재 프로세스의 PCB를 대기 큐에 삽입</span>
    <span class="n">sleep</span><span class="p">();</span> <span class="c1">// 현재 프로세스를 대기 상태로 전환</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">signal</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">S</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">S</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 대기 큐에 있는 p 프로세스의 PCB 제거</span>
    <span class="n">wakeup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// p 프로세스를 준비 상태로 전환</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div data-lang="C" class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wait</span><span class="p">();</span>
<span class="c1">// 임계 구역</span>
<span class="n">signal</span><span class="p">();</span>
</code></pre></div></div>

<p>세마포어 역시 뮤텍스 락과 마찬가지로 프로그래밍 언어에서 지원되는 경우가 많기 때문에 직접 구현할 일은 많지 않습니다.</p>

<h2 id="모니터monitor">모니터(Monitor)</h2>

<p>세마포어는 임계구역 앞뒤로 wait와 signal 함수를 직접 호출해야 하므로 사용자가 사용하기에 조금 불편한 점이 있습니다. 가령 프로그램 규모가 커지면 실수로 함수를 호출하지 않거나 잘못된 순서로 함수를 호출하여 예기치 않은 결과가 발생할 수 있습니다.</p>

<p>모니터는 공유자원과 인터페이스를 하나로 묶어 관리함으로써 이러한 불편함을 해소한 동기화 도구 입니다. 뮤텍스 락이나 세마포어가 저수준 레벨의 언어에서 사용하기 적합한 도구라면 모니터는 고수준 레벨의 언어를 위한 도구입니다. 모니터를 사용하는 대표적인 언어는 자바가 있습니다.</p>

<p>공유자원에 접근하고자 하는 프로세스는 특정 인터페이스를 위한 큐에 쌓이며, 하나의 인터페이스를 통해서만 공유자원에 접근할 수 있게 함으로써 상호배제 동기화가 가능합니다.</p>

<p><img src="/assets/images/computer/img134.png" alt="img134" /></p>

<p>실행 순서를 제어하기 위해서는 모니터 내부의 조건 변수를 사용합니다. 모니터 내부에는 조건 변수에 대한 큐가 존재하며, 공유자원과 인터페이스, 조건 변수를 캡슐화하여 추상화된 데이터 형(Abstract Data Type, ADT)을 형성합니다.</p>

<p>모니터는 wait 함수를 통해 프로세스를 대기 상태로 전환하여 조건 변수 큐에 삽입합니다.</p>

<p><img src="/assets/images/computer/img135.png" alt="img135" /></p>

<p>조건 변수에서 대기 상태인 프로세스는 signal 함수를 통해 실행 상태로 전환되어 인터페이스를 통해 공유자원에 접근할 수 있습니다.</p>

<p><img src="/assets/images/computer/img136.png" alt="img136" /></p>

<p>자바에서는 모든 객체가 모니터를 가지고 있습니다. 임계구역은 <code class="language-plaintext highlighter-rouge">synchronized</code> 키워드를 통해 설정할 수 있으며, 모니터를 가지는 스레드는 해당 객체에 락을 걸어 다른 스레드가 해당 객체에 접근할 수 없게 됩니다.</p>

<p>예제 코드를 작성해보겠습니다.</p>

<h6 id="bankaccountjava">BankAccount.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="o">{</span>

  <span class="kt">int</span> <span class="n">money</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deposit</span><span class="o">(</span><span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">money</span> <span class="o">+=</span> <span class="n">amount</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withdraw</span><span class="o">(</span><span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">money</span> <span class="o">-=</span> <span class="n">amount</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="consumerjava">Consumer.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>

  <span class="nc">BankAccount</span> <span class="n">bankAccount</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">amount</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Consumer</span><span class="o">(</span><span class="nc">BankAccount</span> <span class="n">bankAccount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">bankAccount</span> <span class="o">=</span> <span class="n">bankAccount</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">bankAccount</span><span class="o">.</span><span class="na">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"잔액: "</span> <span class="o">+</span> <span class="n">bankAccount</span><span class="o">.</span><span class="na">money</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="producerjava">Producer.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>

  <span class="nc">BankAccount</span> <span class="n">bankAccount</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">amount</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Producer</span><span class="o">(</span><span class="nc">BankAccount</span> <span class="n">bankAccount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">bankAccount</span> <span class="o">=</span> <span class="n">bankAccount</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">bankAccount</span><span class="o">.</span><span class="na">deposit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"잔액: "</span> <span class="o">+</span> <span class="n">bankAccount</span><span class="o">.</span><span class="na">money</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="examplejava">Example.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

    <span class="nc">BankAccount</span> <span class="n">bankAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BankAccount</span><span class="o">();</span>

    <span class="nc">Producer</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Producer</span><span class="o">(</span><span class="n">bankAccount</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
    <span class="nc">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Consumer</span><span class="o">(</span><span class="n">bankAccount</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>

    <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">producer</span><span class="o">);</span>
    <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">consumer</span><span class="o">);</span>

    <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

    <span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
    <span class="n">t2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"--------------"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"잔액: "</span> <span class="o">+</span> <span class="n">bankAccount</span><span class="o">.</span><span class="na">money</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>실행시켜보면 동기화가 되지 않아 최종 잔액이 0원이 아닙니다.</p>

<h6 id="실행-결과">실행 결과</h6>
<p style="margin-top: 0"><img src="/assets/images/computer/img137.png" alt="img137" /></p>

<p>다음과 같이 BankAccount에 <code class="language-plaintext highlighter-rouge">syncronized</code> 키워드를 통해 임계영역을 설정할 수 있습니다.</p>

<h6 id="bankaccountjava-1">BankAccount.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="o">{</span>

  <span class="kt">int</span> <span class="n">money</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

  <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deposit</span><span class="o">(</span><span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">money</span> <span class="o">+=</span> <span class="n">amount</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withdraw</span><span class="o">(</span><span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">money</span> <span class="o">-=</span> <span class="n">amount</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="실행-결과-1">실행 결과</h6>
<p style="margin-top: 0"><img src="/assets/images/computer/img138.png" alt="img138" /></p>

<p>최종 잔액이 0원이 되었지만 중간과정에 잔액이 마이너스가 됩니다. 이때 실행 순서를 제어하기 위해 <code class="language-plaintext highlighter-rouge">wait()</code>와 <code class="language-plaintext highlighter-rouge">notify()</code>를 사용할 수 있습니다.</p>

<h6 id="bankaccountjava-2">BankAccount.java</h6>
<div data-lang="JAVA" class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="o">{</span>

  <span class="kt">int</span> <span class="n">money</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

  <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deposit</span><span class="o">(</span><span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="n">money</span> <span class="o">+=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="n">notifyAll</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">synchronized</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withdraw</span><span class="o">(</span><span class="kt">int</span> <span class="n">amount</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">money</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">wait</span><span class="o">();</span>
    <span class="n">money</span> <span class="o">-=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="n">notifyAll</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="실행-결과-2">실행 결과</h6>
<p style="margin-top: 0"><img src="/assets/images/computer/img139.png" alt="img139" /></p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Rubisco's Programming Note</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- utterances -->
            <div id="comment">
                <script src="https://utteranc.es/client.js"
                repo="huimang2/huimang2.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async></script>
            </div>
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/M31_starspike.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Rubisco's Programming Note &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/etc/">Etc</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/etc/computer-deadlock">교착상태</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/etc/computer-scheduling">CPU 스케줄링</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/etc/computer-process">프로세스</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/etc/">
                                
                                    See all 15 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/etc/computer-deadlock">
                <div class="post-card-image" style="background-image: url(/assets/images/computer-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/etc/computer-deadlock">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">교착상태</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>교착상태(Deadlack)란?

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      4 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/etc/computer-scheduling">
                <div class="post-card-image" style="background-image: url(/assets/images/computer-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/etc/computer-scheduling">
                <header class="post-card-header">
                    
                        <div class="post-card-tags-container">
                            
                        </div>
                    

                    <h2 class="post-card-title">CPU 스케줄링</h2>
                </header>
                <!-- <section class="post-card-excerpt">
                    
                        <p>CPU 스케줄링(CPU Scheduling)

</p>
                    
                </section> -->
            </a>
            <footer class="post-card-meta">
                
                    
                
                <span class="reading-time">
                    
                    
                      4 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://huimang2.github.io/">
            
            <span>Rubisco's Programming Note</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">프로세스 동기화</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4+%EB%8F%99%EA%B8%B0%ED%99%94&amp;url=etc/computer-synchronization"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=etc/computer-synchronization"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>



        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://huimang2.github.io/">Rubisco's Programming Note</a> &copy; 2023</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search Rubisco's Programming Note</h1>
            <p class="subscribe-overlay-description">
            lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>


    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    /* toc ---------------------------------------------------------------------*/

    var tocTitle = document.getElementsByClassName("post-full-title")[0];
    var tocTitleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var tocArticle = document.getElementsByClassName("post-full-content")[0];
    var tocArticleY = window.pageYOffset + tocArticle.getBoundingClientRect().top;
  
    var toc = document.getElementById("toc");
    var tocHeaderNodes = getHeaderNodes(tocArticle);
    var tocNodes = getTOCNodes(toc);
  
    var tocBefore = undefined;

    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3" && !elem.classList.contains('no-toc');
        });
        return headerNodes;
    }

    tocNodes.forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    document.querySelector('.post-full-content').querySelectorAll('p a[href^="#"]').forEach(el => {
        el.addEventListener('click', function(e){
            e.preventDefault();
            let id = this.getAttribute('href').slice(1);
            window.scrollTo(window.scrollX, window.scrollY + document.getElementById(id).getBoundingClientRect().top - 80);
        });
    });

    /*--------------------------------------------------------------------------*/

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 30;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
            toc.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
            toc.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;

        // toc
        var tocCurrent = tocHeaderNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 90;
        });
  
        if (tocCurrent.length > 0) {
            tocCurrent = tocCurrent[tocCurrent.length-1];
  
            var tocCurrentA = tocNodes.filter(function(tocNode) {
                return tocNode.getElementsByTagName("span")[0].innerHTML == tocCurrent.innerHTML;
            })
            
            tocCurrentA = tocCurrentA[0];

            if (tocCurrentA) {
                if (tocBefore == undefined) tocBefore = tocCurrentA;
    
                if (tocBefore != tocCurrentA) {
                    tocBefore.classList.remove("toc-active");
                    tocBefore = tocCurrentA;
                }
    
                tocCurrentA.classList.add("toc-active");
            }
            else {
                if (tocBefore) 
                    tocBefore.classList.remove("toc-active");
            }
        }
        else {
            if (tocBefore) 
                tocBefore.classList.remove("toc-active");
        }
        
        if(toc && tocArticle.getBoundingClientRect().bottom <= 0) {
            toc.classList.add('toc-hidden');
        } else {
            toc.classList.remove('toc-hidden');
        }
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
